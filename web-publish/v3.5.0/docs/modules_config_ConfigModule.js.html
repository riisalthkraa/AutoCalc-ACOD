

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> modules/config/ConfigModule.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Modules</h3><ul><li><a href="module-AboutModule.html">AboutModule</a></li><li><a href="module-AuthModule.html">AuthModule</a></li><li><a href="module-BackupModule.html">BackupModule</a></li><li><a href="module-ClientsModule.html">ClientsModule</a></li><li><a href="module-ConfigModule.html">ConfigModule</a></li><li><a href="module-DashboardModule.html">DashboardModule</a></li><li><a href="module-DataCache.html">DataCache</a></li><li><a href="module-ExportModule.html">ExportModule</a></li><li><a href="module-FECModule.html">FECModule</a></li><li><a href="module-FollowUpModule.html">FollowUpModule</a></li><li><a href="module-ImportModule.html">ImportModule</a></li><li><a href="module-InvoicesModule.html">InvoicesModule</a></li><li><a href="module-KeyboardShortcutsModule.html">KeyboardShortcutsModule</a></li><li><a href="module-Logger.html">Logger</a></li><li><a href="module-MLService.html">MLService</a></li><li><a href="module-MaterialsModule.html">MaterialsModule</a></li><li><a href="module-NotificationSystem.html">NotificationSystem</a></li><li><a href="module-NotificationSystemV2.html">NotificationSystemV2</a></li><li><a href="module-PDFModule.html">PDFModule</a></li><li><a href="module-QuickAddModule.html">QuickAddModule</a></li><li><a href="module-QuoteBuilderModule.html">QuoteBuilderModule</a></li><li><a href="module-QuotesModule.html">QuotesModule</a></li><li><a href="module-RevenueModule.html">RevenueModule</a></li><li><a href="module-ScannerModule.html">ScannerModule</a></li><li><a href="module-SuppliersModule.html">SuppliersModule</a></li><li><a href="module-TemplatesModule.html">TemplatesModule</a></li><li><a href="module-TourModule.html">TourModule</a></li><li><a href="module-UtilitiesModule.html">UtilitiesModule</a></li><li><a href="module-calculations.html">calculations</a></li><li><a href="module-constants.html">constants</a></li><li><a href="module-formatters.html">formatters</a></li><li><a href="module-helpers.html">helpers</a></li></ul><h3>Classes</h3><ul><li><a href="BaseModule.html">BaseModule</a></li><li><a href="BulkActionsManager.html">BulkActionsManager</a></li><li><a href="CacheKeys.html">CacheKeys</a></li><li><a href="EventBus.html">EventBus</a></li><li><a href="LoadingStateManager.html">LoadingStateManager</a></li><li><a href="ModalHelper.html">ModalHelper</a></li><li><a href="PaginationManager.html">PaginationManager</a></li><li><a href="ServerValidator.html">ServerValidator</a></li><li><a href="StateManager.html">StateManager</a></li><li><a href="TabRefreshManager.html">TabRefreshManager</a></li><li><a href="UndoRedoManager.html">UndoRedoManager</a></li><li><a href="module-AboutModule-AboutModule.html">AboutModule</a></li><li><a href="module-AuthModule-AuthModule.html">AuthModule</a></li><li><a href="module-BackupModule-BackupModule.html">BackupModule</a></li><li><a href="module-ClientsModule-ClientsModule.html">ClientsModule</a></li><li><a href="module-ConfigModule-ConfigModule.html">ConfigModule</a></li><li><a href="module-DashboardModule-DashboardModule.html">DashboardModule</a></li><li><a href="module-ExportModule-ExportModule.html">ExportModule</a></li><li><a href="module-FECModule-FECModule.html">FECModule</a></li><li><a href="module-ImportModule-ImportModule.html">ImportModule</a></li><li><a href="module-InvoicesModule-InvoicesModule.html">InvoicesModule</a></li><li><a href="module-Logger-Logger.html">Logger</a></li><li><a href="module-Logger-ModuleLogger.html">ModuleLogger</a></li><li><a href="module-MaterialsModule-MaterialsModule.html">MaterialsModule</a></li><li><a href="module-PDFModule-PDFModule.html">PDFModule</a></li><li><a href="module-QuickAddModule-QuickAddModule.html">QuickAddModule</a></li><li><a href="module-QuoteBuilderModule-QuoteBuilderModule.html">QuoteBuilderModule</a></li><li><a href="module-QuotesModule-QuotesModule.html">QuotesModule</a></li><li><a href="module-RevenueModule-RevenueModule.html">RevenueModule</a></li><li><a href="module-ScannerModule-ScannerModule.html">ScannerModule</a></li><li><a href="module-SuppliersModule-SuppliersModule.html">SuppliersModule</a></li><li><a href="module-TemplatesModule-TemplatesModule.html">TemplatesModule</a></li><li><a href="module-UtilitiesModule-UtilitiesModule.html">UtilitiesModule</a></li></ul><h3>Global</h3><ul><li><a href="global.html#clear">clear</a></li><li><a href="global.html#crypto">crypto</a></li><li><a href="global.html#emit">emit</a></li><li><a href="global.html#emitSync">emitSync</a></li><li><a href="global.html#off">off</a></li><li><a href="global.html#on">on</a></li><li><a href="global.html#once">once</a></li><li><a href="global.html#validateBeforeAddToQuote">validateBeforeAddToQuote</a></li><li><a href="global.html#validateBeforeExport">validateBeforeExport</a></li><li><a href="global.html#validateBeforeSaveMaterial">validateBeforeSaveMaterial</a></li><li><a href="global.html#validateBeforeSendEmail">validateBeforeSendEmail</a></li><li><a href="global.html#validateHeaderConfig">validateHeaderConfig</a></li><li><a href="global.html#validatePasswordChange">validatePasswordChange</a></li><li><a href="global.html#validateSMTPConfig">validateSMTPConfig</a></li><li><a href="global.html#waitFor">waitFor</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>modules/config/ConfigModule.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * ========================================
 * CONFIG MODULE - Gestion de la configuration
 * ========================================
 *
 * Module de gestion centralisée de toutes les configurations de l'application
 * AutoCalc OptiDevis. Gère les paramètres SMTP, en-têtes PDF, thèmes visuels
 * et mots de passe avec sauvegarde automatique et validation.
 *
 * Architecture :
 * Le module gère 4 domaines de configuration distincts :
 * - **SMTP** : Configuration email pour envoi de devis/factures
 * - **PDF Headers** : En-têtes personnalisés pour documents PDF
 * - **Thèmes** : Apparence visuelle de l'application
 * - **Mot de passe** : Gestion du mot de passe administrateur
 *
 * ==========================================
 * CONFIGURATION SMTP (Email)
 * ==========================================
 *
 * Fonctionnalités :
 * - Sélection du service SMTP (Gmail, Outlook, Yahoo, etc.)
 * - Configuration authentification (email + mot de passe app)
 * - Test de connexion SMTP avant sauvegarde
 * - Validation des champs (email valide, champs requis)
 * - Sauvegarde sécurisée dans app-config.json
 *
 * Workflow de configuration :
 * 1. Utilisateur saisit service + email + mot de passe
 * 2. Validation des champs (validateSMTPConfig)
 * 3. Test optionnel de connexion (testSmtpConfig)
 * 4. Sauvegarde si test réussi (saveSMTPConfig)
 * 5. Événement 'smtp-updated' émis
 *
 * IPC Channel : set-config, test-email-config
 * Fichier : app-config.json
 *
 * ==========================================
 * CONFIGURATION EN-TÊTES PDF
 * ==========================================
 *
 * Données d'en-tête :
 * - Informations entreprise (nom, adresse, téléphone, email)
 * - Identifiants légaux (SIRET, TVA intracommunautaire)
 * - Statut juridique (SARL, SAS, Auto-entrepreneur, etc.)
 * - Conditions de paiement (30 jours, 60 jours, etc.)
 * - Conditions additionnelles (CGV personnalisées)
 * - Mentions légales
 * - Logo entreprise (base64)
 * - Design PDF (elegant, modern, compact)
 *
 * Auto-sauvegarde du design PDF :
 * - Listener sur #pdf-design-select (change event)
 * - Sauvegarde automatique lors du changement
 * - Indicateur visuel ✓ sur design sélectionné
 * - Notification de succès
 *
 * Validation :
 * - Nom entreprise obligatoire
 * - Email valide si fourni
 * - Autres champs optionnels
 *
 * IPC Channel : get-header-config, set-header-config
 * Fichier : header-config.json
 *
 * ==========================================
 * GESTION DES THÈMES
 * ==========================================
 *
 * Système de thèmes :
 * - Chargement depuis themes.json
 * - Organisation par catégories (Clairs, Sombres, Colorés, etc.)
 * - Select avec optgroups
 * - Application en temps réel (&lt;link id="theme-link">)
 * - Sauvegarde automatique du choix
 *
 * Workflow :
 * 1. loadThemes() charge themes.json via fetch
 * 2. Génération d'un &lt;select> avec &lt;optgroup> par catégorie
 * 3. Application du thème sauvegardé ou défaut (assets/styles.css)
 * 4. Change listener sur select
 * 5. applyTheme() met à jour &lt;link id="theme-link" href="...">
 * 6. Sauvegarde dans app-config.json
 * 7. Événement 'theme-changed' émis
 *
 * Fichiers :
 * - themes.json : Liste des thèmes disponibles
 * - app-config.json : Thème sélectionné
 * - app/shared/ui/themes/*.css : Fichiers CSS des thèmes
 *
 * ==========================================
 * GESTION DU MOT DE PASSE
 * ==========================================
 *
 * Changement du mot de passe administrateur :
 * - Champs : nouveau mot de passe + confirmation
 * - Validation (validatePasswordChange externe)
 * - Hashage sécurisé par backend (bcrypt)
 * - Réinitialisation des champs après succès
 * - Réinitialisation de la validation
 *
 * Sécurité :
 * - Authentification requise (authToken)
 * - Validation côté client (longueur, correspondance)
 * - Hashage côté serveur (bcrypt)
 * - Stockage sécurisé (auth.json)
 *
 * IPC Channel : set-password
 *
 * ==========================================
 * AUTO-SAUVEGARDE
 * ==========================================
 *
 * Comportements auto-save :
 * - **Design PDF** : Sauvegarde automatique au changement du select
 * - **Thème** : Sauvegarde automatique au changement du select
 * - **Autres configs** : Sauvegarde manuelle via boutons
 *
 * Protection contre duplication :
 * - Variable globale window.pdfDesignAutoSaveSetup
 * - Évite l'ajout multiple de listeners
 *
 * ==========================================
 * VALIDATION
 * ==========================================
 *
 * Fonctions de validation :
 * - **validateSMTPConfig()** : Service + email + mot de passe
 * - **validateHeaderConfig()** : Nom entreprise + email si fourni
 * - **validatePasswordChange()** : Externe (via window)
 *
 * Retour standard :
 * ```javascript
 * {
 *   valid: boolean,
 *   errors: string[]
 * }
 * ```
 *
 * ==========================================
 * SYNCHRONISATION AVEC SCOPE GLOBAL
 * ==========================================
 *
 * Variables synchronisées :
 * - window.appConfig ↔ this.appConfig (config générale)
 * - window.headerConfig ↔ this.headerConfig (en-têtes PDF)
 * - window.companyLogoBase64 : Logo entreprise (lecture seule)
 *
 * Fonctions exposées :
 * - testSmtpConfig, saveSMTPConfig, populateSmtpConfigForm, validateSMTPConfig
 * - loadHeaderConfig, saveHeaderConfig, populateHeaderConfigForm, validateHeaderConfig
 * - setupPdfDesignAutoSave, updatePdfDesignIndicator
 * - loadThemes, applyTheme, loadConfig
 * - changePassword
 *
 * ==========================================
 * INTÉGRATIONS
 * ==========================================
 *
 * - **StateManager** : Stockage de auth.token
 * - **NotificationSystem** : Feedback utilisateur
 * - **IPC Channels** : Communication avec Electron main process
 * - **ValidationSystem** : Validation externe des champs
 *
 * @module ConfigModule
 * @extends BaseModule
 * @version 2.0.0
 * @author AutoCalc OptiDevis
 */

import BaseModule from '../../core/BaseModule.js';
import NotificationSystem from '../../shared/ui/NotificationSystem.js';

class ConfigModule extends BaseModule {
  /**
   * Crée une instance du module Config.
   *
   * @param {StateManager} state - Gestionnaire d'état global
   * @param {EventBus} eventBus - Bus d'événements pour communication inter-modules
   */
  constructor(state, eventBus) {
    super('config', state, eventBus);

    /**
     * Configuration générale de l'application.
     * Contient les paramètres SMTP et le thème sélectionné.
     * Chargé depuis app-config.json au démarrage.
     *
     * @type {Object}
     * @private
     * @property {Object} smtp - Configuration SMTP {service, auth: {user, pass}}
     * @property {string} theme - Chemin du thème CSS actif (ex: "assets/styles.css")
     */
    this.appConfig = {};

    /**
     * Configuration des en-têtes PDF.
     * Contient toutes les informations d'entreprise pour génération PDF.
     * Chargé depuis header-config.json au démarrage.
     *
     * @type {Object}
     * @private
     * @property {Object} company - Infos entreprise (name, address, phone, email, siret, vatNumber, status, paymentTerms, additionalTerms, mentionslegales)
     * @property {string} logo - Logo en base64
     * @property {string} pdfDesign - Design sélectionné ("elegant", "modern", "compact")
     */
    this.headerConfig = {};

    /**
     * Liste des thèmes disponibles chargés depuis themes.json.
     * Actuellement non utilisé (chargement direct dans select).
     *
     * @type {Array&lt;Object>}
     * @private
     */
    this.themes = [];

    /**
     * Chemin du thème CSS actuellement appliqué.
     *
     * @type {string}
     * @private
     */
    this.currentTheme = '';

    /**
     * Timer pour auto-sauvegarde des en-têtes PDF (non utilisé actuellement).
     *
     * @type {number|null}
     * @private
     */
    this.headerAutoSaveTimer = null;

    this.log('ConfigModule instantiated');
  }

  /**
   * Initialise le module Config.
   * Charge toutes les configurations (app, headers, thèmes) et expose les fonctions.
   *
   * @async
   * @returns {Promise&lt;void>}
   * @throws {Error} Si erreur pendant l'initialisation
   */
  async init() {
    try {
      this.log('Initializing ConfigModule...');

      // Charger les configurations
      await this.loadConfig();
      await this.loadHeaderConfig();
      await this.loadThemes();

      // Exposer les fonctions au scope global
      this.exposeToGlobal({
        // Configuration SMTP
        testSmtpConfig: this.testSmtpConfig,
        saveSMTPConfig: this.saveSMTPConfig,
        populateSmtpConfigForm: this.populateSmtpConfigForm,
        validateSMTPConfig: this.validateSMTPConfig,

        // Configuration en-têtes PDF
        loadHeaderConfig: this.loadHeaderConfig,
        saveHeaderConfig: this.saveHeaderConfig,
        populateHeaderConfigForm: this.populateHeaderConfigForm,
        validateHeaderConfig: this.validateHeaderConfig,
        setupPdfDesignAutoSave: this.setupPdfDesignAutoSave,
        updatePdfDesignIndicator: this.updatePdfDesignIndicator,

        // Gestion des thèmes
        loadThemes: this.loadThemes,
        applyTheme: this.applyTheme,
        loadConfig: this.loadConfig,

        // Gestion du mot de passe
        changePassword: this.changePassword
      });

      // Exposer les variables au scope global
      this.syncGlobalVariables();

      // Attacher les event listeners
      this.attachEventListeners();

      this.initialized = true;
      this.log('ConfigModule initialized successfully');

    } catch (error) {
      this.error('Error initializing ConfigModule:', error);
      throw error;
    }
  }

  /**
   * Attache tous les event listeners pour les boutons de configuration.
   *
   * Boutons gérés :
   * - save-header-btn : Sauvegarde de l'en-tête
   * - change-password-btn : Changement du mot de passe
   * - test-smtp-btn : Test de la connexion SMTP
   * - save-smtp-btn : Sauvegarde de la configuration SMTP
   * - pdf-design-select : Auto-sauvegarde du design PDF
   * - company-logo : Upload du logo
   *
   * @private
   * @returns {void}
   */
  attachEventListeners() {
    this.log('Attaching event listeners...');

    // Bouton sauvegarde en-tête
    const saveHeaderBtn = this.getElement('#save-header-btn');
    if (saveHeaderBtn) {
      saveHeaderBtn.addEventListener('click', () => {
        this.log('Save header button clicked');
        this.saveHeaderConfig();
      });
      this.log('✓ save-header-btn attached');
    } else {
      this.warn('save-header-btn not found');
    }

    // Bouton changement de mot de passe
    const changePasswordBtn = this.getElement('#change-password-btn');
    if (changePasswordBtn) {
      changePasswordBtn.addEventListener('click', () => {
        this.log('Change password button clicked');
        this.changePassword();
      });
      this.log('✓ change-password-btn attached');
    } else {
      this.warn('change-password-btn not found');
    }

    // Bouton test SMTP
    const testSmtpBtn = this.getElement('#test-smtp-btn');
    if (testSmtpBtn) {
      testSmtpBtn.addEventListener('click', () => {
        this.log('Test SMTP button clicked');
        this.testSmtpConfig();
      });
      this.log('✓ test-smtp-btn attached');
    } else {
      this.warn('test-smtp-btn not found');
    }

    // Bouton sauvegarde SMTP
    const saveSmtpBtn = this.getElement('#save-smtp-btn');
    if (saveSmtpBtn) {
      saveSmtpBtn.addEventListener('click', () => {
        this.log('Save SMTP button clicked');
        this.saveSMTPConfig();
      });
      this.log('✓ save-smtp-btn attached');
    } else {
      this.warn('save-smtp-btn not found');
    }

    // Select design PDF - auto-save
    const pdfDesignSelect = this.getElement('#pdf-design-select');
    if (pdfDesignSelect) {
      pdfDesignSelect.addEventListener('change', () => {
        this.log('PDF design changed');
        this.setupPdfDesignAutoSave();
      });
      this.log('✓ pdf-design-select attached');
    } else {
      this.warn('pdf-design-select not found');
    }

    // Upload logo
    const companyLogo = this.getElement('#company-logo');
    if (companyLogo) {
      companyLogo.addEventListener('change', (e) => {
        this.log('Logo file selected');
        this.handleLogoUpload(e);
      });
      this.log('✓ company-logo attached');
    } else {
      this.warn('company-logo not found');
    }

    this.log('Event listeners attached successfully');
  }

  /**
   * Gère l'upload du logo d'entreprise.
   * Convertit l'image en base64 et la stocke dans window.companyLogoBase64.
   *
   * @private
   * @param {Event} event - Event de changement du input file
   * @returns {void}
   */
  handleLogoUpload(event) {
    const file = event.target.files[0];
    if (!file) {
      this.warn('No file selected');
      return;
    }

    // Vérifier que c'est bien une image
    if (!file.type.startsWith('image/')) {
      NotificationSystem.error('Le fichier doit être une image');
      return;
    }

    // Vérifier la taille (max 2MB)
    if (file.size > 2 * 1024 * 1024) {
      NotificationSystem.error('Le logo ne doit pas dépasser 2 MB');
      return;
    }

    const reader = new FileReader();
    reader.onload = (e) => {
      window.companyLogoBase64 = e.target.result;
      this.log('Logo loaded successfully');
      NotificationSystem.success('Logo chargé. Cliquez sur "Valider l\'en-tête" pour sauvegarder.');
    };
    reader.onerror = () => {
      this.error('Error reading logo file');
      NotificationSystem.error('Erreur lors du chargement du logo');
    };
    reader.readAsDataURL(file);
  }

  // ==========================================
  // CONFIGURATION GÉNÉRALE
  // ==========================================

  /**
   * Charge la configuration générale (SMTP + thème) depuis app-config.json via IPC.
   * Peuple le formulaire SMTP et émet l'événement 'loaded'.
   *
   * @public
   * @async
   * @returns {Promise&lt;void>}
   * @fires EventBus#loaded
   */
  loadConfig = async () => {
    try {
      this.log('Chargement de la configuration...');

      const result = await window.electron.invoke('get-config');
      if (result.success) {
        this.appConfig = result.data || {};
        this.log('Configuration chargée:', this.appConfig);
        this.populateSmtpConfigForm();
        this.emitEvent('loaded', this.appConfig);
      } else {
        throw new Error(result.message || 'Échec du chargement de la configuration');
      }
    } catch (error) {
      console.error('Erreur lors du chargement de la configuration:', error);
      window.ErrorHandler?.showError(`Erreur: ${error.message}`);
    }
  }

  // ==========================================
  // CONFIGURATION SMTP
  // ==========================================

  /**
   * Peuple le formulaire SMTP avec les valeurs de this.appConfig.smtp.
   *
   * @public
   * @returns {void}
   */
  populateSmtpConfigForm = () => {
    this.log('Remplissage du formulaire SMTP...');
    const smtpService = document.getElementById('smtp-service');
    const smtpUser = document.getElementById('smtp-user');
    const smtpPass = document.getElementById('smtp-pass');

    if (smtpService &amp;&amp; smtpUser &amp;&amp; smtpPass) {
      smtpService.value = this.appConfig.smtp?.service || 'gmail';
      smtpUser.value = this.appConfig.smtp?.auth?.user || '';
      smtpPass.value = this.appConfig.smtp?.auth?.pass || '';
    } else {
      console.error('Champs SMTP non trouvés');
      window.ErrorHandler?.showError('Champs SMTP non trouvés');
    }
  }

  /**
   * Valide la configuration SMTP (service, email, password requis).
   *
   * @public
   * @returns {Object} {valid: boolean, errors: string[]}
   */
  validateSMTPConfig() {
    const errors = [];

    const service = this.getElement('#smtp-service')?.value;
    const user = this.getElement('#smtp-user')?.value;
    const pass = this.getElement('#smtp-pass')?.value;

    if (!service) {
      errors.push('Le service SMTP est requis');
    }

    if (!user) {
      errors.push('L\'adresse email est requise');
    } else if (!user.includes('@')) {
      errors.push('L\'adresse email est invalide');
    }

    if (!pass) {
      errors.push('Le mot de passe est requis');
    }

    return {
      valid: errors.length === 0,
      errors
    };
  }

  /**
   * Teste la connexion SMTP avec la configuration saisie.
   *
   * Effectue les opérations suivantes :
   * 1. Validation de la configuration via validateSMTPConfig()
   * 2. Vérification de l'authentification (authToken requis)
   * 3. Récupération des valeurs du formulaire SMTP
   * 4. Envoi d'un email de test via IPC 'test-email-config'
   * 5. Affichage du résultat (succès ou erreur)
   *
   * @public
   * @async
   * @returns {Promise&lt;void>}
   * @fires NotificationSystem#success Si le test réussit
   * @fires NotificationSystem#error Si le test échoue ou si non authentifié
   *
   * @example
   * // Utilisateur clique sur "Tester la connexion SMTP"
   * await this.testSmtpConfig();
   * // → Validation OK → Email test envoyé → Notification résultat
   */
  testSmtpConfig = async () => {
    try {
      this.log('Test SMTP appelé');

      // Validation avant test SMTP
      if (!window.validateSMTPConfig || !window.validateSMTPConfig()) {
        return;
      }

      const authToken = window.getAuthToken ? window.getAuthToken() : this.state.get('auth.token');
      if (!authToken) {
        NotificationSystem.error('Vous devez être connecté pour tester la configuration SMTP');
        return;
      }

      const smtpService = document.getElementById('smtp-service')?.value;
      const smtpUser = document.getElementById('smtp-user')?.value;
      const smtpPass = document.getElementById('smtp-pass')?.value;

      const result = await window.electron.invoke('test-email-config', authToken, {
        service: smtpService,
        auth: { user: smtpUser, pass: smtpPass }
      });

      if (result.success) {
        NotificationSystem.success(result.message);
      } else {
        NotificationSystem.error(result.message);
      }
    } catch (error) {
      console.error('Erreur test SMTP:', error);
      NotificationSystem.error(`Erreur lors du test SMTP: ${error.message}`);
    }
  }

  /**
   * Sauvegarde la configuration SMTP dans app-config.json.
   *
   * Workflow :
   * 1. Validation de la configuration via validateSMTPConfig()
   * 2. Vérification de l'authentification (authToken requis)
   * 3. Récupération des valeurs du formulaire SMTP
   * 4. Création de l'objet configuration {smtp: {service, auth: {user, pass}}}
   * 5. Sauvegarde via IPC 'set-config'
   * 6. Mise à jour de this.appConfig
   * 7. Émission de l'événement 'smtp-updated'
   * 8. Notification de succès
   *
   * @public
   * @async
   * @returns {Promise&lt;void>}
   * @fires EventBus#smtp-updated Avec la nouvelle configuration SMTP
   * @fires NotificationSystem#success Si sauvegarde réussie
   * @fires NotificationSystem#error Si sauvegarde échouée ou non authentifié
   *
   * @example
   * // Utilisateur clique sur "Enregistrer configuration SMTP"
   * await this.saveSMTPConfig();
   * // → Validation OK → Sauvegarde → Événement émis → Notification
   */
  saveSMTPConfig = async () => {
    try {
      this.log('Enregistrement SMTP...');

      // Validation avant sauvegarde SMTP
      if (!window.validateSMTPConfig || !window.validateSMTPConfig()) {
        return;
      }

      const authToken = window.getAuthToken ? window.getAuthToken() : this.state.get('auth.token');
      if (!authToken) {
        NotificationSystem.error('Vous devez être connecté pour sauvegarder la configuration SMTP');
        return;
      }

      const smtpService = document.getElementById('smtp-service')?.value;
      const smtpUser = document.getElementById('smtp-user')?.value;
      const smtpPass = document.getElementById('smtp-pass')?.value;

      // Validation: email format
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (smtpUser &amp;&amp; !emailRegex.test(smtpUser)) {
        NotificationSystem.error('Format d\'email invalide');
        return;
      }

      // Validation: champs requis
      if (!smtpService || !smtpUser || !smtpPass) {
        NotificationSystem.error('Tous les champs SMTP sont requis');
        return;
      }

      const newConfig = {
        smtp: {
          service: smtpService,
          auth: { user: smtpUser, pass: smtpPass }
        }
      };

      const result = await window.electron.invoke('set-config', authToken, newConfig);
      if (result.success) {
        this.appConfig = newConfig;
        NotificationSystem.success('Configuration SMTP enregistrée');
        this.emitEvent('smtp-updated', newConfig.smtp);
      } else {
        NotificationSystem.error(result.message || 'Erreur lors de l\'enregistrement SMTP');
      }
    } catch (error) {
      console.error('Erreur sauvegarde SMTP:', error);
      NotificationSystem.error(`Erreur: ${error.message}`);
    }
  }

  // ==========================================
  // CONFIGURATION EN-TÊTES PDF
  // ==========================================

  /**
   * Charge la configuration des en-têtes PDF depuis header-config.json.
   *
   * Effectue les opérations suivantes :
   * 1. Récupération de la config via IPC 'get-header-config'
   * 2. Stockage dans this.headerConfig
   * 3. Peuplement du formulaire HTML
   * 4. Configuration de l'auto-sauvegarde du design PDF
   * 5. Émission de l'événement 'header-loaded'
   *
   * @public
   * @async
   * @returns {Promise&lt;void>}
   * @fires EventBus#header-loaded Avec la configuration chargée
   * @throws {Error} Si échec du chargement
   *
   * @example
   * // Appelé automatiquement par init()
   * await this.loadHeaderConfig();
   * // → Formulaire rempli avec infos entreprise + logo + design PDF
   */
  loadHeaderConfig = async () => {
    try {
      this.log('Chargement de la configuration de l\'en-tête...');

      const result = await window.electron.invoke('get-header-config');
      if (result.success) {
        this.headerConfig = result.data || {};
        this.log('Configuration de l\'en-tête chargée:', this.headerConfig);
        this.populateHeaderConfigForm();
        this.setupPdfDesignAutoSave(); // Activer l'auto-sauvegarde du PDF design
        this.emitEvent('header-loaded', this.headerConfig);
      } else {
        throw new Error(result.message || 'Échec du chargement de la configuration de l\'en-tête');
      }
    } catch (error) {
      console.error('Erreur lors du chargement de la configuration de l\'en-tête:', error);
      window.ErrorHandler?.showError(`Erreur: ${error.message}`);
    }
  }

  /**
   * Peuple le formulaire de configuration des en-têtes PDF avec this.headerConfig.
   *
   * Remplit 10 champs du formulaire :
   * - Informations entreprise (nom, adresse, téléphone, email)
   * - Identifiants légaux (SIRET, TVA)
   * - Statut juridique
   * - Conditions de paiement
   * - Conditions additionnelles
   * - Mentions légales
   * - Design PDF sélectionné
   * - Logo (si disponible → window.companyLogoBase64)
   *
   * @public
   * @returns {void}
   *
   * @example
   * // Appelé après chargement de la config
   * this.populateHeaderConfigForm();
   * // → Tous les champs du formulaire sont remplis
   */
  populateHeaderConfigForm = () => {
    this.log('Remplissage du formulaire de configuration de l\'en-tête...');
    const fields = {
      'company-name': this.headerConfig.company?.name,
      'company-address': this.headerConfig.company?.address,
      'company-phone': this.headerConfig.company?.phone,
      'company-email': this.headerConfig.company?.email,
      'company-siret': this.headerConfig.company?.siret,
      'company-vat': this.headerConfig.company?.vatNumber,
      'company-status': this.headerConfig.company?.status,
      'company-payment-terms': this.headerConfig.company?.paymentTerms,
      'company-additional-terms': this.headerConfig.company?.additionalTerms,
      'company-mentions-legales': this.headerConfig.company?.mentionslegales
    };

    Object.entries(fields).forEach(([id, value]) => {
      const element = document.getElementById(id);
      if (element) element.value = value || '';
    });

    // Charger le design PDF sélectionné
    const pdfDesignSelect = document.getElementById('pdf-design-select');
    if (pdfDesignSelect) {
      pdfDesignSelect.value = this.headerConfig.pdfDesign || 'elegant';
    }

    // Charger le logo si disponible
    if (this.headerConfig.logo) {
      window.companyLogoBase64 = this.headerConfig.logo;
    }
  }

  /**
   * Valide la configuration des en-têtes PDF.
   *
   * Règles de validation :
   * - Nom de l'entreprise obligatoire
   * - Email valide si fourni (doit contenir @)
   * - Tous les autres champs sont optionnels
   *
   * @public
   * @returns {Object} Résultat de validation
   * @returns {boolean} return.valid - true si validation réussie
   * @returns {string[]} return.errors - Liste des erreurs
   *
   * @example
   * const validation = this.validateHeaderConfig();
   * if (!validation.valid) {
   *   console.error(validation.errors);
   * }
   */
  validateHeaderConfig() {
    const errors = [];

    const companyName = this.getElement('#header-companyName')?.value;
    if (!companyName) {
      errors.push('Le nom de l\'entreprise est requis');
    }

    // Validation optionnelle des autres champs
    const email = this.getElement('#header-companyEmail')?.value;
    if (email &amp;&amp; !email.includes('@')) {
      errors.push('L\'adresse email est invalide');
    }

    return {
      valid: errors.length === 0,
      errors
    };
  }

  /**
   * Sauvegarde la configuration des en-têtes PDF dans header-config.json.
   *
   * Workflow :
   * 1. Validation via validateHeaderConfig()
   * 2. Vérification authentification (authToken requis)
   * 3. Récupération de tous les champs du formulaire
   * 4. Conservation du design PDF existant
   * 5. Création de l'objet configuration {company: {...}, logo, pdfDesign}
   * 6. Sauvegarde via IPC 'set-header-config'
   * 7. Mise à jour de this.headerConfig
   * 8. Émission de l'événement 'header-updated'
   * 9. Notification de succès
   *
   * @public
   * @async
   * @returns {Promise&lt;void>}
   * @fires EventBus#header-updated Avec la nouvelle configuration
   * @fires NotificationSystem#success Si sauvegarde réussie
   * @fires NotificationSystem#error Si erreur ou non authentifié
   *
   * @example
   * // Utilisateur clique sur "Enregistrer en-tête"
   * await this.saveHeaderConfig();
   * // → Validation OK → Sauvegarde → Événement → Notification
   */
  saveHeaderConfig = async () => {
    try {
      // Validation avant sauvegarde en-tête
      if (!window.validateHeaderConfig || !window.validateHeaderConfig()) {
        return;
      }

      const authToken = window.getAuthToken ? window.getAuthToken() : this.state.get('auth.token');
      if (!authToken) {
        NotificationSystem.error('Vous devez être connecté pour sauvegarder la configuration de l\'en-tête');
        return;
      }

      const companyName = document.getElementById('company-name')?.value;
      const companyAddress = document.getElementById('company-address')?.value;
      const companyPhone = document.getElementById('company-phone')?.value;
      const companyEmail = document.getElementById('company-email')?.value;
      const companySiret = document.getElementById('company-siret')?.value;
      const companyVat = document.getElementById('company-vat')?.value;
      const companyStatus = document.getElementById('company-status')?.value;
      const companyPaymentTerms = document.getElementById('company-payment-terms')?.value;
      const companyAdditionalTerms = document.getElementById('company-additional-terms')?.value;
      const companymentionslegales = document.getElementById('company-mentions-legales')?.value;

      // Validation: nom d'entreprise requis
      if (!companyName || companyName.trim() === '') {
        NotificationSystem.error('Le nom de l\'entreprise est requis');
        return;
      }

      // Validation: email format (optionnel mais doit être valide si fourni)
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (companyEmail &amp;&amp; companyEmail.trim() !== '' &amp;&amp; !emailRegex.test(companyEmail)) {
        NotificationSystem.error('Format d\'email invalide');
        return;
      }

      // Conserver le design PDF existant (géré séparément par auto-save)
      const pdfDesign = this.headerConfig.pdfDesign || 'elegant';

      const newHeaderConfig = {
        company: {
          name: companyName,
          address: companyAddress,
          phone: companyPhone,
          email: companyEmail,
          siret: companySiret,
          vatNumber: companyVat,
          status: companyStatus,
          paymentTerms: companyPaymentTerms,
          additionalTerms: companyAdditionalTerms,
          mentionslegales: companymentionslegales,
        },
        logo: window.companyLogoBase64,
        pdfDesign: pdfDesign
      };

      const result = await window.electron.invoke('set-header-config', authToken, newHeaderConfig);
      if (result.success) {
        this.headerConfig = newHeaderConfig;

        // Vérification: Afficher la config enregistrée
        console.log('[ConfigModule] En-tête enregistré avec succès:');
        console.log('  - Nom entreprise:', newHeaderConfig.company?.name);
        console.log('  - Logo présent:', !!newHeaderConfig.logo);
        console.log('  - Design PDF:', newHeaderConfig.pdfDesign);
        console.log('  - window.headerConfig synchronisé:', window.headerConfig === this.headerConfig);
        console.log('  - window.companyLogoBase64 présent:', !!window.companyLogoBase64);

        NotificationSystem.success("En-tête personnalisé enregistré !");
        this.emitEvent('header-updated', newHeaderConfig);
      } else {
        NotificationSystem.error(result.message || "Erreur lors de la sauvegarde de l'en-tête.");
      }
    } catch (error) {
      this.error('Error saving header config:', error);
      NotificationSystem.error('Erreur lors de la sauvegarde des en-têtes');
    }
  }

  /**
   * Met à jour l'indicateur visuel ✓ sur l'option du design PDF sélectionné.
   *
   * Retire tous les ✓ existants puis ajoute un ✓ à l'option sélectionnée
   * dans le &lt;select id="pdf-design-select">.
   *
   * @public
   * @param {string} selectedDesign - ID du design sélectionné ("elegant", "modern", "compact")
   * @returns {void}
   *
   * @example
   * this.updatePdfDesignIndicator("modern");
   * // → Option "Modern" affiche : "Modern ✓"
   */
  updatePdfDesignIndicator = (selectedDesign) => {
    const pdfDesignSelect = document.getElementById('pdf-design-select');
    if (!pdfDesignSelect) return;

    // Retirer tous les indicateurs existants
    Array.from(pdfDesignSelect.options).forEach(option => {
      option.text = option.text.replace(/\s*✓\s*$/, '').replace(/^\s*✓\s*/, '');
    });

    // Ajouter l'indicateur à l'option sélectionnée
    const selectedOption = Array.from(pdfDesignSelect.options).find(opt => opt.value === selectedDesign);
    if (selectedOption &amp;&amp; !selectedOption.text.includes('✓')) {
      selectedOption.text = selectedOption.text + ' ✓';
    }
  }

  /**
   * Configure l'auto-sauvegarde du design PDF lors du changement de sélection.
   *
   * Workflow :
   * 1. Vérification qu'auto-save n'est pas déjà configuré (window.pdfDesignAutoSaveSetup)
   * 2. Chargement du design actuel depuis this.headerConfig
   * 3. Ajout d'un listener 'change' sur #pdf-design-select
   * 4. À chaque changement :
   *    - Vérification authentification
   *    - Mise à jour de l'indicateur visuel ✓
   *    - Mise à jour de this.headerConfig.pdfDesign
   *    - Conservation du logo
   *    - Sauvegarde automatique via IPC 'set-header-config'
   *    - Notification de succès
   * 5. Marquage comme configuré (window.pdfDesignAutoSaveSetup = true)
   *
   * Protection : Utilise une variable globale pour éviter d'ajouter plusieurs fois
   * le même listener si la fonction est appelée plusieurs fois.
   *
   * @public
   * @returns {void}
   *
   * @example
   * // Appelé automatiquement par loadHeaderConfig()
   * this.setupPdfDesignAutoSave();
   * // → Listener configuré → Changements de design sauvegardés automatiquement
   */
  setupPdfDesignAutoSave = () => {
    // Variable globale pour éviter l'ajout multiple du listener
    if (window.pdfDesignAutoSaveSetup) {
      this.log('Design PDF auto-save déjà configuré');
      return;
    }

    const pdfDesignSelect = document.getElementById('pdf-design-select');
    if (!pdfDesignSelect) {
      this.warn('pdf-design-select non trouvé');
      return;
    }

    // Charger le design actuel depuis headerConfig
    if (this.headerConfig &amp;&amp; this.headerConfig.pdfDesign) {
      pdfDesignSelect.value = this.headerConfig.pdfDesign;
      this.updatePdfDesignIndicator(this.headerConfig.pdfDesign);
    }

    pdfDesignSelect.addEventListener('change', async (e) => {
      const authToken = window.getAuthToken ? window.getAuthToken() : this.state.get('auth.token');
      if (!authToken) {
        NotificationSystem.error('Vous devez être connecté pour sauvegarder le design PDF');
        return;
      }

      const selectedDesign = e.target.value;
      this.updatePdfDesignIndicator(selectedDesign);

      // Mettre à jour headerConfig avec le nouveau design
      if (!this.headerConfig) {
        this.headerConfig = {};
      }
      this.headerConfig.pdfDesign = selectedDesign;

      // S'assurer que le logo actuel est inclus
      if (window.companyLogoBase64) {
        this.headerConfig.logo = window.companyLogoBase64;
      }

      try {
        const result = await window.electron.invoke('set-header-config', authToken, this.headerConfig);
        if (result.success) {
          NotificationSystem.success('Design PDF enregistré automatiquement');
          this.log('Design PDF sauvegardé:', selectedDesign);
        } else {
          NotificationSystem.error(result.message || 'Erreur lors de la sauvegarde du design PDF');
        }
      } catch (error) {
        console.error('Erreur lors de la sauvegarde du design PDF:', error);
        NotificationSystem.error('Erreur lors de la sauvegarde du design PDF');
      }
    });

    // Marquer comme configuré
    window.pdfDesignAutoSaveSetup = true;
    this.log('Design PDF auto-save configuré avec succès');
  }

  // ==========================================
  // GESTION DES THÈMES
  // ==========================================

  /**
   * Charge la liste des thèmes disponibles depuis themes.json et configure le sélecteur.
   *
   * Workflow :
   * 1. Fetch de app/shared/ui/themes/themes.json
   * 2. Groupement des thèmes par catégorie
   * 3. Génération du HTML du &lt;select> avec &lt;optgroup> par catégorie
   * 4. Application du thème sauvegardé ou défaut (assets/styles.css)
   * 5. Ajout d'un listener 'change' pour auto-sauvegarde :
   *    - Application immédiate du thème via applyTheme()
   *    - Vérification authentification
   *    - Sauvegarde dans app-config.json via IPC
   *    - Notification de succès
   * 6. Émission de l'événement 'themes-loaded'
   *
   * @public
   * @async
   * @returns {Promise&lt;void>}
   * @fires EventBus#themes-loaded Avec la liste des thèmes
   * @throws {Error} Si échec du chargement de themes.json
   *
   * @example
   * // Appelé automatiquement par init()
   * await this.loadThemes();
   * // → Select peuplé avec thèmes groupés par catégorie
   * // → Thème sauvegardé appliqué automatiquement
   */
  loadThemes = async () => {
    try {
      this.log('Chargement des thèmes...');

      // Charger themes.json (nouveau chemin organisé)
      const response = await fetch('app/shared/ui/themes/themes.json');
      const themesData = await response.json();

      // Grouper les thèmes par catégorie
      const themesByCategory = {};
      themesData.themes.forEach(theme => {
        if (!themesByCategory[theme.category]) {
          themesByCategory[theme.category] = [];
        }
        themesByCategory[theme.category].push(theme);
      });

      // Générer les options dans le select
      const themeSelect = document.getElementById('theme-select');
      if (!themeSelect) {
        console.error('Select theme-select non trouvé');
        return;
      }

      // Vider le select
      themeSelect.innerHTML = '';

      // Créer les optgroup et options
      for (const category in themesByCategory) {
        const optgroup = document.createElement('optgroup');
        optgroup.label = category;

        themesByCategory[category].forEach(theme => {
          const option = document.createElement('option');
          option.value = theme.id;
          option.textContent = theme.name;
          optgroup.appendChild(option);
        });

        themeSelect.appendChild(optgroup);
      }

      // Appliquer le thème sauvegardé ou le défaut
      const savedTheme = this.appConfig.theme || 'assets/styles.css';
      themeSelect.value = savedTheme;
      this.applyTheme(savedTheme);

      // Ajouter l'event listener pour le changement de thème
      themeSelect.addEventListener('change', async (e) => {
        const selectedTheme = e.target.value;
        this.applyTheme(selectedTheme);

        // Vérifier l'authentification avant de sauvegarder
        const authToken = window.getAuthToken ? window.getAuthToken() : this.state.get('auth.token');
        if (!authToken) {
          NotificationSystem.error('Vous devez être connecté pour sauvegarder le thème');
          return;
        }

        // Sauvegarder dans app-config.json
        if (!this.appConfig) {
          this.appConfig = {};
        }
        this.appConfig.theme = selectedTheme;
        try {
          const result = await window.electron.invoke('set-config', authToken, this.appConfig);
          if (result.success) {
            NotificationSystem.success('Thème enregistré automatiquement');
            this.log('Thème sauvegardé:', selectedTheme);
          } else {
            console.error('Erreur lors de la sauvegarde du thème:', result.message);
            NotificationSystem.error('Erreur lors de la sauvegarde du thème');
          }
        } catch (error) {
          console.error('Erreur lors de la sauvegarde du thème:', error);
          NotificationSystem.error('Erreur lors de la sauvegarde du thème');
        }
      });

      this.log('Thèmes chargés avec succès');
      this.emitEvent('themes-loaded', themesData.themes);

    } catch (error) {
      console.error('Erreur lors du chargement des thèmes:', error);
      window.ErrorHandler?.showError(`Erreur lors du chargement des thèmes: ${error.message}`);
    }
  }

  /**
   * Applique un thème en modifiant l'attribut href du &lt;link id="theme-link">.
   *
   * Met à jour immédiatement l'apparence de l'application en changeant
   * la feuille de style CSS chargée.
   *
   * @public
   * @param {string} themePath - Chemin vers le fichier CSS du thème (ex: "app/shared/ui/themes/dark.css")
   * @returns {void}
   * @fires EventBus#theme-changed Avec le chemin du nouveau thème
   *
   * @example
   * this.applyTheme("app/shared/ui/themes/dark.css");
   * // → Thème sombre appliqué immédiatement
   * // → this.currentTheme = "app/shared/ui/themes/dark.css"
   */
  applyTheme = (themePath) => {
    const themeLink = document.getElementById('theme-link');
    if (themeLink) {
      themeLink.href = themePath;
      this.currentTheme = themePath;
      this.log('Thème appliqué:', themePath);
      this.emitEvent('theme-changed', themePath);
    } else {
      console.error('Élément theme-link non trouvé');
    }
  }

  // ==========================================
  // GESTION DU MOT DE PASSE
  // ==========================================

  /**
   * Change le mot de passe administrateur de l'application.
   *
   * Workflow :
   * 1. Validation via validatePasswordChange() (externe)
   * 2. Vérification authentification (authToken requis)
   * 3. Récupération nouveau mot de passe + confirmation
   * 4. Envoi via IPC 'set-password' (hashage bcrypt côté serveur)
   * 5. Si succès :
   *    - Réinitialisation des champs du formulaire
   *    - Réinitialisation de la validation (ValidationSystem)
   *    - Notification de succès
   * 6. Si échec : Notification d'erreur
   *
   * Sécurité :
   * - Validation côté client (longueur, correspondance)
   * - Hashage côté serveur avec bcrypt
   * - Stockage sécurisé dans auth.json
   *
   * @public
   * @async
   * @returns {Promise&lt;void>}
   * @fires NotificationSystem#success Si changement réussi
   * @fires NotificationSystem#error Si échec ou non authentifié
   *
   * @example
   * // Utilisateur clique sur "Changer mot de passe"
   * await this.changePassword();
   * // → Validation OK → Envoi IPC → Hash bcrypt → Sauvegarde
   * // → Champs réinitialisés → Notification
   */
  changePassword = async () => {
    try {
      this.log('Changement de mot de passe...');

      // Validation avant changement mot de passe
      if (!window.validatePasswordChange || !window.validatePasswordChange()) {
        return;
      }

      const authToken = window.getAuthToken ? window.getAuthToken() : this.state.get('auth.token');
      if (!authToken) {
        NotificationSystem.error('Vous devez être connecté pour changer le mot de passe');
        return;
      }

      const newPassword = document.getElementById('admin-password')?.value;
      const confirmPassword = document.getElementById('admin-password-confirm')?.value;

      const result = await window.electron.invoke('set-password', authToken, newPassword);
      if (result.success) {
        NotificationSystem.success('Mot de passe changé avec succès');
        document.getElementById('admin-password').value = '';
        document.getElementById('admin-password-confirm').value = '';

        // Réinitialiser la validation si disponible
        if (window.ValidationSystem) {
          window.ValidationSystem.resetField('admin-password');
          window.ValidationSystem.resetField('admin-password-confirm');
        }
      } else {
        NotificationSystem.error(result.message);
      }
    } catch (error) {
      console.error('Erreur changement mot de passe:', error);
      NotificationSystem.error(`Erreur: ${error.message}`);
    }
  }

  // ==========================================
  // SYNCHRONISATION AVEC SCOPE GLOBAL
  // ==========================================

  /**
   * Configure la synchronisation bidirectionnelle entre les propriétés du module
   * et les variables globales window.* pour compatibilité avec le code legacy.
   *
   * Utilise Object.defineProperty() pour créer des getters/setters ES6 qui
   * assurent une synchronisation automatique et transparente.
   *
   * Variables synchronisées :
   * - window.appConfig ↔ this.appConfig (configuration SMTP + thème)
   * - window.headerConfig ↔ this.headerConfig (en-têtes PDF + logo + design)
   *
   * Cette approche permet de maintenir la compatibilité avec le code existant
   * qui accède directement aux variables globales, tout en utilisant des propriétés
   * d'instance modernes dans le module.
   *
   * @private
   * @returns {void}
   *
   * @example
   * // Le code legacy peut toujours utiliser :
   * window.appConfig.smtp = newSmtpConfig;
   * // → Automatiquement synchronisé avec this.appConfig.smtp
   *
   * @example
   * // Le module utilise :
   * this.headerConfig.logo = base64Image;
   * // → Automatiquement synchronisé avec window.headerConfig.logo
   */
  syncGlobalVariables() {
    // Créer des getters/setters pour synchroniser automatiquement
    Object.defineProperty(window, 'appConfig', {
      get: () => this.appConfig,
      set: (value) => {
        this.appConfig = value;
      }
    });

    Object.defineProperty(window, 'headerConfig', {
      get: () => this.headerConfig,
      set: (value) => {
        this.headerConfig = value;
      }
    });
  }

  // ==========================================
  // CLEANUP
  // ==========================================

  /**
   * Nettoie les ressources du module avant destruction.
   *
   * Opérations de nettoyage :
   * - Arrête le timer d'auto-sauvegarde des en-têtes (si actif)
   * - Appelle le destroy() de BaseModule pour nettoyage standard
   *
   * @public
   * @returns {void}
   *
   * @example
   * // Appelé automatiquement lors de la fermeture de l'application
   * module.destroy();
   * // → Timers arrêtés → Ressources libérées
   */
  destroy() {
    // Nettoyer les timers
    if (this.headerAutoSaveTimer) {
      clearTimeout(this.headerAutoSaveTimer);
    }

    super.destroy();
  }
}

export default ConfigModule;
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
