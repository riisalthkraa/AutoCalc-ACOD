

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> modules/utilities/UtilitiesModule.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Modules</h3><ul><li><a href="module-AboutModule.html">AboutModule</a></li><li><a href="module-AuthModule.html">AuthModule</a></li><li><a href="module-BackupModule.html">BackupModule</a></li><li><a href="module-ClientsModule.html">ClientsModule</a></li><li><a href="module-ConfigModule.html">ConfigModule</a></li><li><a href="module-DashboardModule.html">DashboardModule</a></li><li><a href="module-DataCache.html">DataCache</a></li><li><a href="module-ExportModule.html">ExportModule</a></li><li><a href="module-FECModule.html">FECModule</a></li><li><a href="module-FollowUpModule.html">FollowUpModule</a></li><li><a href="module-ImportModule.html">ImportModule</a></li><li><a href="module-InvoicesModule.html">InvoicesModule</a></li><li><a href="module-KeyboardShortcutsModule.html">KeyboardShortcutsModule</a></li><li><a href="module-Logger.html">Logger</a></li><li><a href="module-MLService.html">MLService</a></li><li><a href="module-MaterialsModule.html">MaterialsModule</a></li><li><a href="module-NotificationSystem.html">NotificationSystem</a></li><li><a href="module-NotificationSystemV2.html">NotificationSystemV2</a></li><li><a href="module-PDFModule.html">PDFModule</a></li><li><a href="module-QuickAddModule.html">QuickAddModule</a></li><li><a href="module-QuoteBuilderModule.html">QuoteBuilderModule</a></li><li><a href="module-QuotesModule.html">QuotesModule</a></li><li><a href="module-RevenueModule.html">RevenueModule</a></li><li><a href="module-ScannerModule.html">ScannerModule</a></li><li><a href="module-SuppliersModule.html">SuppliersModule</a></li><li><a href="module-TemplatesModule.html">TemplatesModule</a></li><li><a href="module-TourModule.html">TourModule</a></li><li><a href="module-UtilitiesModule.html">UtilitiesModule</a></li><li><a href="module-calculations.html">calculations</a></li><li><a href="module-constants.html">constants</a></li><li><a href="module-formatters.html">formatters</a></li><li><a href="module-helpers.html">helpers</a></li></ul><h3>Classes</h3><ul><li><a href="BaseModule.html">BaseModule</a></li><li><a href="BulkActionsManager.html">BulkActionsManager</a></li><li><a href="CacheKeys.html">CacheKeys</a></li><li><a href="EventBus.html">EventBus</a></li><li><a href="LoadingStateManager.html">LoadingStateManager</a></li><li><a href="ModalHelper.html">ModalHelper</a></li><li><a href="PaginationManager.html">PaginationManager</a></li><li><a href="ServerValidator.html">ServerValidator</a></li><li><a href="StateManager.html">StateManager</a></li><li><a href="TabRefreshManager.html">TabRefreshManager</a></li><li><a href="UndoRedoManager.html">UndoRedoManager</a></li><li><a href="module-AboutModule-AboutModule.html">AboutModule</a></li><li><a href="module-AuthModule-AuthModule.html">AuthModule</a></li><li><a href="module-BackupModule-BackupModule.html">BackupModule</a></li><li><a href="module-ClientsModule-ClientsModule.html">ClientsModule</a></li><li><a href="module-ConfigModule-ConfigModule.html">ConfigModule</a></li><li><a href="module-DashboardModule-DashboardModule.html">DashboardModule</a></li><li><a href="module-ExportModule-ExportModule.html">ExportModule</a></li><li><a href="module-FECModule-FECModule.html">FECModule</a></li><li><a href="module-ImportModule-ImportModule.html">ImportModule</a></li><li><a href="module-InvoicesModule-InvoicesModule.html">InvoicesModule</a></li><li><a href="module-Logger-Logger.html">Logger</a></li><li><a href="module-Logger-ModuleLogger.html">ModuleLogger</a></li><li><a href="module-MaterialsModule-MaterialsModule.html">MaterialsModule</a></li><li><a href="module-PDFModule-PDFModule.html">PDFModule</a></li><li><a href="module-QuickAddModule-QuickAddModule.html">QuickAddModule</a></li><li><a href="module-QuoteBuilderModule-QuoteBuilderModule.html">QuoteBuilderModule</a></li><li><a href="module-QuotesModule-QuotesModule.html">QuotesModule</a></li><li><a href="module-RevenueModule-RevenueModule.html">RevenueModule</a></li><li><a href="module-ScannerModule-ScannerModule.html">ScannerModule</a></li><li><a href="module-SuppliersModule-SuppliersModule.html">SuppliersModule</a></li><li><a href="module-TemplatesModule-TemplatesModule.html">TemplatesModule</a></li><li><a href="module-UtilitiesModule-UtilitiesModule.html">UtilitiesModule</a></li></ul><h3>Global</h3><ul><li><a href="global.html#clear">clear</a></li><li><a href="global.html#crypto">crypto</a></li><li><a href="global.html#emit">emit</a></li><li><a href="global.html#emitSync">emitSync</a></li><li><a href="global.html#off">off</a></li><li><a href="global.html#on">on</a></li><li><a href="global.html#once">once</a></li><li><a href="global.html#validateBeforeAddToQuote">validateBeforeAddToQuote</a></li><li><a href="global.html#validateBeforeExport">validateBeforeExport</a></li><li><a href="global.html#validateBeforeSaveMaterial">validateBeforeSaveMaterial</a></li><li><a href="global.html#validateBeforeSendEmail">validateBeforeSendEmail</a></li><li><a href="global.html#validateHeaderConfig">validateHeaderConfig</a></li><li><a href="global.html#validatePasswordChange">validatePasswordChange</a></li><li><a href="global.html#validateSMTPConfig">validateSMTPConfig</a></li><li><a href="global.html#waitFor">waitFor</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>modules/utilities/UtilitiesModule.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * ========================================
 * UTILITIES MODULE - Protection anti-double-clic
 * ========================================
 *
 * Module utilitaire pour AutoCalc OptiDevis qui prot√®ge tous les boutons de l'application
 * contre les clics multiples accidentels (double-clic, triple-clic, spam).
 *
 * Architecture :
 * Le module g√®re une protection globale des boutons avec :
 * - **Protection automatique** : Tous les boutons sont prot√©g√©s au chargement
 * - **MutationObserver** : D√©tection et protection des boutons ajout√©s dynamiquement
 * - **Cooldowns configurables** : Temps d'attente adapt√© au type de bouton
 * - **Phase de capture** : Interception des clics avant propagation (event.stopImmediatePropagation)
 * - **Attributs data-*** : Gestion d'√©tat avec data-protected, data-clicking, data-no-protect
 *
 * ==========================================
 * PROBL√àME R√âSOLU
 * ==========================================
 *
 * **Probl√®me** : Double-clic accidentel des utilisateurs
 * - Utilisateur clique "Sauvegarder" 2 fois rapidement ‚Üí 2 sauvegardes
 * - Utilisateur clique "Supprimer" 2 fois ‚Üí Suppression en double
 * - Utilisateur impatient clique "Cr√©er PDF" 3 fois ‚Üí 3 PDFs g√©n√©r√©s
 *
 * **Solution** : Protection automatique avec cooldown
 * - Premier clic : Ex√©cut√© normalement
 * - Clics suivants pendant cooldown : Bloqu√©s (preventDefault + stopImmediatePropagation)
 * - Apr√®s cooldown : Bouton r√©activ√©
 *
 * **Avantages** :
 * - Pas de modifications des autres modules (protection transparente)
 * - Pas besoin de g√©rer manuellement dans chaque fonction
 * - Fonctionne automatiquement pour les boutons dynamiques
 * - UX am√©lior√©e (√©vite erreurs, doublons, consommation API)
 *
 * ==========================================
 * COOLDOWNS PAR TYPE DE BOUTON
 * ==========================================
 *
 * **Boutons de suppression** : 1500ms (1,5 seconde)
 * - D√©tection : button.id.includes('delete') OU button.classList.contains('btn-danger')
 * - Exemples : #delete-material-btn, .btn-danger
 * - Raison : √âviter suppression accidentelle, action irr√©versible
 *
 * **Boutons de sauvegarde** : 1200ms (1,2 seconde)
 * - D√©tection : button.id.includes('save') OU button.classList.contains('btn-success')
 * - Exemples : #save-quote-btn, .btn-success
 * - Raison : √âviter doublons de donn√©es (quotes, invoices, materials)
 *
 * **Boutons standard** : 1000ms (1 seconde)
 * - Tous les autres boutons
 * - Exemples : #create-pdf-btn, #search-btn, etc.
 * - Raison : Protection g√©n√©rale suffisante
 *
 * ==========================================
 * FONCTIONNEMENT DE LA PROTECTION
 * ==========================================
 *
 * **Phase 1 : Protection initiale** (protectAllButtons)
 * 1. Au chargement du module (DOMContentLoaded ou readyState !== 'loading')
 * 2. S√©lection de tous les boutons : document.querySelectorAll('button:not([data-no-protect])')
 * 3. Pour chaque bouton :
 *    a. D√©termination du cooldown selon type (1000ms, 1200ms ou 1500ms)
 *    b. Appel protectButton(button, cooldown)
 * 4. Log : "üõ°Ô∏è Protection appliqu√©e √† X boutons"
 *
 * **Phase 2 : Protection d'un bouton** (protectButton)
 * 1. V√©rification : Si d√©j√† prot√©g√© (data-protected='true') ‚Üí return
 * 2. Marquage : button.dataset.protected = 'true'
 * 3. Ajout listener click en phase de capture (addEventListener(..., true))
 * 4. Callback click :
 *    a. Si button.disabled OU data-clicking='true' :
 *       - e.preventDefault() : Annule action par d√©faut
 *       - e.stopImmediatePropagation() : Bloque tous les autres listeners
 *       - return false
 *    b. Sinon (premier clic) :
 *       - button.dataset.clicking = 'true'
 *       - button.disabled = true (d√©sactive visuellement le bouton)
 *       - setTimeout(cooldown) : R√©active apr√®s d√©lai
 *
 * **Phase 3 : Observation dynamique** (observeNewButtons)
 * 1. Cr√©ation MutationObserver sur document.body
 * 2. Configuration : { childList: true, subtree: true } (√©coute tous les ajouts DOM)
 * 3. Callback mutation.addedNodes :
 *    a. Si node.tagName === 'BUTTON' ‚Üí protectButton(node)
 *    b. Si node contient des boutons enfants ‚Üí node.querySelectorAll('button') ‚Üí protectButton()
 * 4. Protection automatique des boutons ajout√©s par JavaScript (modals, tableaux, etc.)
 *
 * ==========================================
 * PHASE DE CAPTURE (CAPTURE PHASE)
 * ==========================================
 *
 * **Pourquoi addEventListener(..., true) ?**
 * - Event propagation : Capture ‚Üí Target ‚Üí Bubbling
 * - true = Phase de capture (avant que l'√©v√©nement atteigne le bouton)
 * - false = Phase de bubbling (apr√®s le bouton, par d√©faut)
 *
 * **Avantage phase de capture** :
 * - Le listener de protection s'ex√©cute EN PREMIER
 * - Peut bloquer TOUS les autres listeners avec stopImmediatePropagation()
 * - M√™me les listeners ajout√©s directement sur le bouton (onclick) sont bloqu√©s
 *
 * **Ordre d'ex√©cution** :
 * 1. Listener de protection (phase capture) ‚Üê NOTRE PROTECTION
 * 2. Listeners sur le bouton (phase target)
 * 3. Listeners sur les parents (phase bubbling)
 *
 * Si protection bloque (preventDefault + stopImmediatePropagation) :
 * ‚Üí √âtapes 2 et 3 ne s'ex√©cutent JAMAIS
 *
 * ==========================================
 * ATTRIBUTS DATA-*** UTILIS√âS
 * ==========================================
 *
 * **data-protected="true"** :
 * - Indique que le bouton a d√©j√† √©t√© prot√©g√©
 * - √âvite de prot√©ger 2 fois le m√™me bouton (double listener)
 * - Ajout√© par protectButton()
 *
 * **data-clicking="true"** :
 * - Indique qu'un clic est en cours de traitement (cooldown actif)
 * - Utilis√© pour bloquer les clics suivants
 * - true pendant le cooldown, false apr√®s
 *
 * **data-no-protect** :
 * - Attribut optionnel pour exclure un bouton de la protection
 * - Usage : &lt;button data-no-protect>Bouton sans protection&lt;/button>
 * - Cas d'usage : Boutons n√©cessitant clics multiples rapides (rare)
 *
 * ==========================================
 * MUTATIONOBSERVER
 * ==========================================
 *
 * **Qu'est-ce que MutationObserver ?**
 * - API native JavaScript pour observer les changements du DOM
 * - Appel√© automatiquement lors d'ajout/suppression d'√©l√©ments
 * - Performance : Meilleur que setInterval pour surveiller le DOM
 *
 * **Configuration** :
 * - target : document.body (observe tout le document)
 * - childList : true (d√©tecte ajouts/suppressions de n≈ìuds enfants)
 * - subtree : true (observe r√©cursivement tous les descendants)
 *
 * **Cas d'usage dans l'application** :
 * - Modals Bootstrap : Boutons cr√©√©s dynamiquement lors de l'ouverture
 * - Tableaux : Boutons "Modifier" / "Supprimer" g√©n√©r√©s via innerHTML
 * - Notifications : Boutons de toast g√©n√©r√©s dynamiquement
 * - Templates : Boutons ajout√©s apr√®s chargement d'un template
 *
 * Sans MutationObserver ‚Üí Ces boutons ne seraient PAS prot√©g√©s !
 *
 * ==========================================
 * INT√âGRATIONS
 * ==========================================
 *
 * - **Tous les modules** : Protection automatique de tous les boutons HTML
 * - **Bootstrap 5.3.3** : Compatible avec modals, dropdowns, boutons Bootstrap
 * - **NotificationSystem** : Protection des boutons de toast
 * - **Tous les tableaux** : Protection des boutons d'action (Modifier, Supprimer)
 *
 * ==========================================
 * PERFORMANCE
 * ==========================================
 *
 * **MutationObserver** :
 * - Tr√®s performant (API native optimis√©e)
 * - Ne bloque pas le thread principal
 * - Overhead n√©gligeable (&lt; 1ms par mutation)
 *
 * **Event listeners** :
 * - Phase de capture : Aucun impact performance
 * - setTimeout() : Non-bloquant (asynchrone)
 * - Pas de fuite m√©moire (listeners nettoy√©s dans destroy())
 *
 * ==========================================
 * S√âCURIT√â &amp; BONNES PRATIQUES
 * ==========================================
 *
 * **Cleanup** :
 * - destroy() d√©connecte MutationObserver (√©vite fuite m√©moire)
 * - super.destroy() nettoie les listeners (BaseModule)
 *
 * **Exclusions** :
 * - data-no-protect permet d'exclure certains boutons si n√©cessaire
 * - Recommand√© seulement pour cas tr√®s sp√©cifiques
 *
 * **Disabled state** :
 * - button.disabled = true fournit feedback visuel (curseur interdit, opacit√©)
 * - Bootstrap applique automatiquement le style .disabled
 *
 * @module UtilitiesModule
 * @extends BaseModule
 * @version 2.0.0
 * @author AutoCalc OptiDevis
 */

import BaseModule from '../../core/BaseModule.js';

class UtilitiesModule extends BaseModule {
  /**
   * Cooldown par d√©faut pour les boutons standard (ms).
   * √âvite les clics multiples accidentels sur les boutons g√©n√©riques.
   *
   * @constant {number}
   * @static
   */
  static COOLDOWN_DEFAULT = 1000;

  /**
   * Cooldown pour les boutons de sauvegarde (ms).
   * Plus long que le d√©faut pour √©viter les doublons de donn√©es.
   *
   * @constant {number}
   * @static
   */
  static COOLDOWN_SAVE = 1200;

  /**
   * Cooldown pour les boutons de suppression (ms).
   * Le plus long pour √©viter les suppressions accidentelles (action irr√©versible).
   *
   * @constant {number}
   * @static
   */
  static COOLDOWN_DELETE = 1500;

  /**
   * Cr√©e une instance du module Utilities.
   *
   * @param {StateManager} state - Gestionnaire d'√©tat global
   * @param {EventBus} eventBus - Bus d'√©v√©nements
   */
  constructor(state, eventBus) {
    super('utilities', state, eventBus);

    /**
     * Instance de MutationObserver pour d√©tecter les boutons ajout√©s dynamiquement.
     * Observe document.body avec { childList: true, subtree: true }.
     * Null jusqu'√† l'appel de observeNewButtons().
     *
     * @type {MutationObserver|null}
     * @private
     */
    this.observer = null;

    this.log('UtilitiesModule instantiated');
  }

  /**
   * Initialise le module Utilities.
   * Prot√®ge tous les boutons existants et d√©marre l'observation des nouveaux boutons.
   *
   * @async
   * @returns {Promise&lt;void>}
   * @throws {Error} Si l'initialisation √©choue
   *
   * @example
   * const utilitiesModule = new UtilitiesModule(state, eventBus);
   * await utilitiesModule.init();
   * // ‚Üí Tous les boutons prot√©g√©s
   * // ‚Üí MutationObserver actif
   */
  async init() {
    try {
      this.log('Initializing UtilitiesModule...');

      // Exposer les fonctions au scope global
      this.exposeToGlobal({
        protectButton: this.protectButton,
        protectAllButtons: this.protectAllButtons,
        observeNewButtons: this.observeNewButtons
      });

      // Attendre que le DOM soit pr√™t avant de prot√©ger les boutons
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          this.protectAllButtons();
          this.observeNewButtons();
        });
      } else {
        // DOM d√©j√† charg√©
        this.protectAllButtons();
        this.observeNewButtons();
      }

      this.initialized = true;
      this.log('UtilitiesModule initialized successfully');

    } catch (error) {
      this.error('Error initializing UtilitiesModule:', error);
      throw error;
    }
  }

  // ==========================================
  // PROTECTION DES BOUTONS
  // ==========================================

  /**
   * Prot√®ge un bouton unique contre les clics multiples avec un cooldown configurable.
   * Ajoute un listener en phase de capture qui bloque les clics pendant le cooldown.
   *
   * M√©canisme de protection :
   * 1. V√©rifie si d√©j√† prot√©g√© (data-protected='true') ‚Üí return
   * 2. Marque comme prot√©g√© (data-protected='true')
   * 3. Ajoute event listener en phase de capture (addEventListener(..., true))
   * 4. Au premier clic :
   *    - Si disabled OU clicking='true' ‚Üí preventDefault + stopImmediatePropagation + return
   *    - Sinon : clicking='true', disabled=true, setTimeout(cooldown) pour r√©activer
   *
   * Phase de capture :
   * - S'ex√©cute AVANT tous les autres listeners (m√™me onclick)
   * - stopImmediatePropagation() bloque TOUS les listeners suivants
   * - Protection inviolable
   *
   * @public
   * @param {HTMLButtonElement} button - √âl√©ment bouton HTML √† prot√©ger
   * @param {number} [cooldown=1000] - Dur√©e du cooldown en millisecondes (par d√©faut 1000ms)
   * @returns {void}
   *
   * @example
   * // Protection manuelle d'un bouton avec cooldown de 2 secondes
   * const myButton = document.getElementById('my-btn');
   * protectButton(myButton, 2000);
   * // ‚Üí Premier clic : Ex√©cut√© normalement
   * // ‚Üí Clics dans les 2s suivantes : Bloqu√©s
   * // ‚Üí Apr√®s 2s : Bouton r√©activ√©
   *
   * @example
   * // Protection automatique appel√©e par protectAllButtons
   * const deleteBtn = document.getElementById('delete-material-btn');
   * protectButton(deleteBtn, 1500); // 1,5s pour boutons danger
   */
  protectButton = (button, cooldown = 1000) => {
    if (!button || button.dataset.protected === 'true') {
      return;
    }

    // Marquer le bouton comme prot√©g√©
    button.dataset.protected = 'true';

    // Ajouter l'√©couteur d'√©v√©nement en phase de capture
    button.addEventListener('click', function(e) {
      // Si le bouton est d√©sactiv√© ou en cours de clic, bloquer
      if (this.disabled || this.dataset.clicking === 'true') {
        e.preventDefault();
        e.stopImmediatePropagation();
        return false;
      }

      // Marquer comme en cours de clic et d√©sactiver
      this.dataset.clicking = 'true';
      this.disabled = true;

      // R√©activer apr√®s le cooldown
      setTimeout(() => {
        this.disabled = false;
        this.dataset.clicking = 'false';
      }, cooldown);
    }, true); // true = phase de capture
  }

  /**
   * Applique la protection anti-double-clic √† tous les boutons existants de la page.
   * D√©termine automatiquement le cooldown selon le type de bouton et applique la protection.
   *
   * Workflow :
   * 1. S√©lectionne tous les boutons : document.querySelectorAll('button:not([data-no-protect])')
   * 2. Pour chaque bouton :
   *    a. D√©termine cooldown selon type :
   *       - ID contient 'delete' OU classe 'btn-danger' ‚Üí 1500ms
   *       - ID contient 'save' OU classe 'btn-success' ‚Üí 1200ms
   *       - Autres ‚Üí 1000ms (d√©faut)
   *    b. Appelle protectButton(button, cooldown)
   * 3. Log : "üõ°Ô∏è Protection appliqu√©e √† X boutons"
   *
   * Exclusions :
   * - Boutons avec attribut data-no-protect sont ignor√©s (querySelectorAll filtre)
   * - Utile pour boutons n√©cessitant clics multiples rapides
   *
   * Appel√© :
   * - Au chargement initial du module (DOMContentLoaded)
   * - Peut √™tre appel√© manuellement si nouveaux boutons ajout√©s en masse
   *
   * @public
   * @returns {void}
   *
   * @example
   * // Au chargement de l'application
   * protectAllButtons();
   * // ‚Üí "üõ°Ô∏è Protection appliqu√©e √† 45 boutons"
   * // ‚Üí Tous les boutons HTML de la page sont prot√©g√©s
   *
   * @example
   * // Apr√®s ajout de nouveaux boutons non d√©tect√©s par MutationObserver
   * // (Rare, MutationObserver couvre 99% des cas)
   * loadNewModuleWithButtons();
   * protectAllButtons(); // Re-protection manuelle
   */
  protectAllButtons = () => {
    try {
      // S√©lectionner tous les boutons sauf ceux marqu√©s "data-no-protect"
      const buttons = document.querySelectorAll('button:not([data-no-protect])');


      buttons.forEach(button => {
        // D√©terminer le cooldown selon le type de bouton
        let cooldown = UtilitiesModule.COOLDOWN_DEFAULT;

        // Boutons de suppression : cooldown plus long (action irr√©versible)
        if (button.id.includes('delete') || button.classList.contains('btn-danger')) {
          cooldown = UtilitiesModule.COOLDOWN_DELETE;
        }

        // Boutons de sauvegarde : cooldown moyen (√©vite doublons)
        if (button.id.includes('save') || button.classList.contains('btn-success')) {
          cooldown = UtilitiesModule.COOLDOWN_SAVE;
        }

        // Prot√©ger le bouton
        this.protectButton(button, cooldown);
      });

      this.log(`üõ°Ô∏è Protection appliqu√©e √† ${buttons.length} boutons`);

    } catch (error) {
      this.error('Error protecting buttons:', error);
    }
  }

  /**
   * D√©marre l'observation des nouveaux boutons ajout√©s dynamiquement au DOM.
   * Utilise MutationObserver pour d√©tecter automatiquement les boutons cr√©√©s apr√®s le chargement.
   *
   * Workflow :
   * 1. Si this.observer existe d√©j√† ‚Üí disconnect() (√©vite multiples observers)
   * 2. Cr√©ation MutationObserver avec callback :
   *    a. Pour chaque mutation.addedNodes :
   *       - Si node est un &lt;button> : protectButton(node, cooldown)
   *       - Si node contient des &lt;button> enfants : querySelectorAll + protectButton()
   *    b. Cooldown d√©termin√© selon type (delete: 1500ms, save: 1200ms, default: 1000ms)
   * 3. D√©marrage observation : observer.observe(document.body, { childList: true, subtree: true })
   * 4. Log : "üëÅÔ∏è Observateur de boutons dynamiques initialis√©"
   *
   * Configuration MutationObserver :
   * - target : document.body (observe tout le document)
   * - childList : true (d√©tecte ajouts/suppressions directs)
   * - subtree : true (d√©tecte changements dans tous les descendants)
   *
   * Cas d'usage :
   * - Modals Bootstrap : Boutons cr√©√©s √† l'ouverture du modal
   * - Tableaux : Boutons "Modifier"/"Supprimer" g√©n√©r√©s via innerHTML
   * - Templates : Boutons ajout√©s apr√®s chargement d'un template
   * - Notifications : Boutons de toast g√©n√©r√©s dynamiquement
   *
   * Performance :
   * - MutationObserver natif optimis√© (&lt; 1ms overhead par mutation)
   * - Non-bloquant (asynchrone)
   * - D√©connect√© proprement dans destroy()
   *
   * @public
   * @returns {void}
   *
   * @example
   * // Au d√©marrage du module
   * observeNewButtons();
   * // ‚Üí MutationObserver actif
   *
   * // Plus tard : Modal Bootstrap s'ouvre avec boutons dynamiques
   * $('#myModal').modal('show');
   * // ‚Üí MutationObserver d√©tecte les nouveaux boutons
   * // ‚Üí Protection appliqu√©e automatiquement
   * // ‚Üí Pas besoin d'intervention manuelle
   */
  observeNewButtons = () => {
    try {
      // Si l'observateur existe d√©j√†, le d√©connecter
      if (this.observer) {
        this.observer.disconnect();
      }

      // Cr√©er un nouveau MutationObserver
      this.observer = new MutationObserver((mutations) => {
        mutations.forEach(mutation => {
          // Pour chaque n≈ìud ajout√©
          mutation.addedNodes.forEach(node => {
            // V√©rifier que c'est un √©l√©ment HTML
            if (node.nodeType === 1) {
              // Si le n≈ìud est un bouton
              if (node.tagName === 'BUTTON' &amp;&amp; !node.dataset.protected) {
                let cooldown = UtilitiesModule.COOLDOWN_DEFAULT;

                // D√©terminer le cooldown selon le type
                if (node.id.includes('delete') || node.classList.contains('btn-danger')) {
                  cooldown = UtilitiesModule.COOLDOWN_DELETE;
                } else if (node.id.includes('save') || node.classList.contains('btn-success')) {
                  cooldown = UtilitiesModule.COOLDOWN_SAVE;
                }

                this.protectButton(node, cooldown);
              }

              // Chercher les boutons enfants
              const buttons = node.querySelectorAll?.('button:not([data-protected]):not([data-no-protect])');
              if (buttons &amp;&amp; buttons.length > 0) {
                buttons.forEach(button => {
                  let cooldown = UtilitiesModule.COOLDOWN_DEFAULT;

                  if (button.id.includes('delete') || button.classList.contains('btn-danger')) {
                    cooldown = UtilitiesModule.COOLDOWN_DELETE;
                  } else if (button.id.includes('save') || button.classList.contains('btn-success')) {
                    cooldown = UtilitiesModule.COOLDOWN_SAVE;
                  }

                  this.protectButton(button, cooldown);
                });
              }
            }
          });
        });
      });

      // D√©marrer l'observation
      this.observer.observe(document.body, {
        childList: true,
        subtree: true
      });

      this.log('üëÅÔ∏è Observateur de boutons dynamiques initialis√©');

    } catch (error) {
      this.error('Error observing new buttons:', error);
    }
  }

  /**
   * D√©truit le module Utilities et nettoie toutes les ressources.
   * D√©connecte le MutationObserver et nettoie les event listeners.
   *
   * Workflow :
   * 1. Si this.observer existe :
   *    - observer.disconnect() : Arr√™te observation DOM
   *    - this.observer = null : Lib√®re r√©f√©rence
   * 2. super.destroy() : Cleanup BaseModule (event listeners)
   *
   * Garantit :
   * - Pas de fuite m√©moire (MutationObserver d√©connect√©)
   * - Pas d'observation fant√¥me en arri√®re-plan
   * - Cleanup complet des ressources
   *
   * Appel√© lors de :
   * - Fermeture de l'application
   * - Destruction du module
   *
   * @public
   * @returns {void}
   *
   * @example
   * // Fermeture de l'application
   * utilitiesModule.destroy();
   * // ‚Üí MutationObserver d√©connect√©
   * // ‚Üí Listeners nettoy√©s
   * // ‚Üí Ressources lib√©r√©es
   */
  destroy() {
    // D√©connecter l'observateur
    if (this.observer) {
      this.observer.disconnect();
      this.observer = null;
      this.log('Button observer disconnected');
    }

    super.destroy();
  }
}

export default UtilitiesModule;
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
