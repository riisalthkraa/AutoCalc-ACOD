

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> modules/shortcuts/KeyboardShortcutsModule.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Modules</h3><ul><li><a href="module-AboutModule.html">AboutModule</a></li><li><a href="module-AuthModule.html">AuthModule</a></li><li><a href="module-BackupModule.html">BackupModule</a></li><li><a href="module-ClientsModule.html">ClientsModule</a></li><li><a href="module-ConfigModule.html">ConfigModule</a></li><li><a href="module-DashboardModule.html">DashboardModule</a></li><li><a href="module-DataCache.html">DataCache</a></li><li><a href="module-ExportModule.html">ExportModule</a></li><li><a href="module-FECModule.html">FECModule</a></li><li><a href="module-FollowUpModule.html">FollowUpModule</a></li><li><a href="module-ImportModule.html">ImportModule</a></li><li><a href="module-InvoicesModule.html">InvoicesModule</a></li><li><a href="module-KeyboardShortcutsModule.html">KeyboardShortcutsModule</a></li><li><a href="module-Logger.html">Logger</a></li><li><a href="module-MLService.html">MLService</a></li><li><a href="module-MaterialsModule.html">MaterialsModule</a></li><li><a href="module-NotificationSystem.html">NotificationSystem</a></li><li><a href="module-NotificationSystemV2.html">NotificationSystemV2</a></li><li><a href="module-PDFModule.html">PDFModule</a></li><li><a href="module-QuickAddModule.html">QuickAddModule</a></li><li><a href="module-QuoteBuilderModule.html">QuoteBuilderModule</a></li><li><a href="module-QuotesModule.html">QuotesModule</a></li><li><a href="module-RevenueModule.html">RevenueModule</a></li><li><a href="module-ScannerModule.html">ScannerModule</a></li><li><a href="module-SuppliersModule.html">SuppliersModule</a></li><li><a href="module-TemplatesModule.html">TemplatesModule</a></li><li><a href="module-TourModule.html">TourModule</a></li><li><a href="module-UtilitiesModule.html">UtilitiesModule</a></li><li><a href="module-calculations.html">calculations</a></li><li><a href="module-constants.html">constants</a></li><li><a href="module-formatters.html">formatters</a></li><li><a href="module-helpers.html">helpers</a></li></ul><h3>Classes</h3><ul><li><a href="BaseModule.html">BaseModule</a></li><li><a href="BulkActionsManager.html">BulkActionsManager</a></li><li><a href="CacheKeys.html">CacheKeys</a></li><li><a href="EventBus.html">EventBus</a></li><li><a href="LoadingStateManager.html">LoadingStateManager</a></li><li><a href="ModalHelper.html">ModalHelper</a></li><li><a href="PaginationManager.html">PaginationManager</a></li><li><a href="ServerValidator.html">ServerValidator</a></li><li><a href="StateManager.html">StateManager</a></li><li><a href="TabRefreshManager.html">TabRefreshManager</a></li><li><a href="UndoRedoManager.html">UndoRedoManager</a></li><li><a href="module-AboutModule-AboutModule.html">AboutModule</a></li><li><a href="module-AuthModule-AuthModule.html">AuthModule</a></li><li><a href="module-BackupModule-BackupModule.html">BackupModule</a></li><li><a href="module-ClientsModule-ClientsModule.html">ClientsModule</a></li><li><a href="module-ConfigModule-ConfigModule.html">ConfigModule</a></li><li><a href="module-DashboardModule-DashboardModule.html">DashboardModule</a></li><li><a href="module-ExportModule-ExportModule.html">ExportModule</a></li><li><a href="module-FECModule-FECModule.html">FECModule</a></li><li><a href="module-ImportModule-ImportModule.html">ImportModule</a></li><li><a href="module-InvoicesModule-InvoicesModule.html">InvoicesModule</a></li><li><a href="module-Logger-Logger.html">Logger</a></li><li><a href="module-Logger-ModuleLogger.html">ModuleLogger</a></li><li><a href="module-MaterialsModule-MaterialsModule.html">MaterialsModule</a></li><li><a href="module-PDFModule-PDFModule.html">PDFModule</a></li><li><a href="module-QuickAddModule-QuickAddModule.html">QuickAddModule</a></li><li><a href="module-QuoteBuilderModule-QuoteBuilderModule.html">QuoteBuilderModule</a></li><li><a href="module-QuotesModule-QuotesModule.html">QuotesModule</a></li><li><a href="module-RevenueModule-RevenueModule.html">RevenueModule</a></li><li><a href="module-ScannerModule-ScannerModule.html">ScannerModule</a></li><li><a href="module-SuppliersModule-SuppliersModule.html">SuppliersModule</a></li><li><a href="module-TemplatesModule-TemplatesModule.html">TemplatesModule</a></li><li><a href="module-UtilitiesModule-UtilitiesModule.html">UtilitiesModule</a></li></ul><h3>Global</h3><ul><li><a href="global.html#clear">clear</a></li><li><a href="global.html#crypto">crypto</a></li><li><a href="global.html#emit">emit</a></li><li><a href="global.html#emitSync">emitSync</a></li><li><a href="global.html#off">off</a></li><li><a href="global.html#on">on</a></li><li><a href="global.html#once">once</a></li><li><a href="global.html#validateBeforeAddToQuote">validateBeforeAddToQuote</a></li><li><a href="global.html#validateBeforeExport">validateBeforeExport</a></li><li><a href="global.html#validateBeforeSaveMaterial">validateBeforeSaveMaterial</a></li><li><a href="global.html#validateBeforeSendEmail">validateBeforeSendEmail</a></li><li><a href="global.html#validateHeaderConfig">validateHeaderConfig</a></li><li><a href="global.html#validatePasswordChange">validatePasswordChange</a></li><li><a href="global.html#validateSMTPConfig">validateSMTPConfig</a></li><li><a href="global.html#waitFor">waitFor</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>modules/shortcuts/KeyboardShortcutsModule.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * ========================================
 * KEYBOARD SHORTCUTS MODULE
 * ========================================
 *
 * Gestion centralis√©e des raccourcis clavier pour AutoCalc OptiDevis.
 * Am√©liore la productivit√© avec des shortcuts intuitifs.
 *
 * Architecture :
 * - Shortcuts globaux (toujours actifs)
 * - Shortcuts contextuels (selon onglet actif)
 * - Pr√©vention conflits (focus dans inputs)
 * - Feedback visuel (notifications)
 *
 * ==========================================
 * RACCOURCIS DISPONIBLES
 * ==========================================
 *
 * **Globaux (toujours actifs) :**
 * - Escape : Fermer modal actif
 * - Ctrl+K : Quick Add (ajout rapide mat√©riaux)
 * - Ctrl+Shift+P : Command Palette (palette de commandes)
 * - F1 : Afficher aide
 * - Ctrl+/ : Afficher liste raccourcis
 *
 * **Contextuels (selon onglet) :**
 * - Ctrl+S : Sauvegarder formulaire actif
 * - Ctrl+N : Nouveau (mat√©riau/fournisseur/devis/facture)
 * - Ctrl+F : Focus recherche
 * - Ctrl+E : Exporter
 *
 * @module KeyboardShortcutsModule
 * @extends BaseModule
 * @version 1.0.0
 * @author AutoCalc OptiDevis
 */

import BaseModule from '../../core/BaseModule.js';
import NotificationSystem from '../../shared/ui/NotificationSystem.js';
import ModalHelper from '../../shared/ui/ModalHelper.js';

class KeyboardShortcutsModule extends BaseModule {
  /**
   * Map des raccourcis actifs.
   * @type {Map&lt;string, Function>}
   * @private
   */
  shortcuts = new Map();

  /**
   * Indique si les shortcuts sont activ√©s.
   * @type {boolean}
   * @private
   */
  enabled = true;

  constructor(state, eventBus) {
    super('shortcuts', state, eventBus);
  }

  /**
   * Initialise le module et enregistre tous les shortcuts.
   */
  async init() {
    this.log('Initializing Keyboard Shortcuts...');

    // Enregistrer les shortcuts globaux
    this.registerGlobalShortcuts();

    // √âcouter les √©v√©nements clavier
    document.addEventListener('keydown', this.handleKeyDown);

    this.log('Keyboard Shortcuts initialized');

    // Exposer fonction pour afficher aide
    this.exposeToGlobal({
      showShortcutsHelp: this.showHelp
    });

    // Afficher notification de bienvenue
    setTimeout(() => {
      NotificationSystem.info('üí° Astuce : Ctrl+/ pour voir les raccourcis clavier');
    }, 3000);
  }

  /**
   * Enregistre tous les raccourcis globaux.
   * @private
   */
  registerGlobalShortcuts() {
    // ========== NAVIGATION ==========

    // Escape : Fermer modal actif
    this.register('Escape', () => {
      ModalHelper.hideAll();
      this.log('All modals closed via Escape');
    });

    // Alt+1 √† Alt+9 : Navigation rapide par onglets
    for (let i = 1; i &lt;= 9; i++) {
      this.register(`Alt+${i}`, () => this.switchToTab(i));
    }

    // Ctrl+Tab : Onglet suivant
    this.register('Ctrl+Tab', () => this.nextTab());

    // Ctrl+Shift+Tab : Onglet pr√©c√©dent
    this.register('Ctrl+Shift+Tab', () => this.prevTab());

    // ========== ACTIONS PRINCIPALES ==========

    // Ctrl+S : Sauvegarder formulaire actif
    this.register('Ctrl+S', () => {
      this.saveActiveForm();
    });

    // Ctrl+N : Nouveau document
    this.register('Ctrl+N', () => {
      this.createNew();
    });

    // Ctrl+D : Dupliquer document actif
    this.register('Ctrl+D', () => {
      this.duplicateActive();
    });

    // Ctrl+Shift+D : Supprimer document actif
    this.register('Ctrl+Shift+D', () => {
      this.deleteActive();
    });

    // Ctrl+P : Imprimer/PDF
    this.register('Ctrl+P', () => {
      this.printActive();
    });

    // Ctrl+E : Exporter
    this.register('Ctrl+E', () => {
      this.exportData();
    });

    // ========== RECHERCHE ET FILTRES ==========

    // Ctrl+F : Focus recherche
    this.register('Ctrl+F', () => {
      this.focusSearch();
    });

    // Ctrl+K : Quick Add (ajout rapide de mat√©riaux)
    this.register('Ctrl+K', () => {
      const quickAddInput = document.getElementById('quickAddInput');
      if (quickAddInput) {
        quickAddInput.focus();
        quickAddInput.select();
        NotificationSystem.success('‚ö° Quick Add activ√© (Ctrl+K)');
      }
    });

    // Ctrl+Shift+P : Command Palette (palette de commandes universelle)
    this.register('Ctrl+Shift+P', () => {
      if (window.CommandPalette) {
        window.CommandPalette.open();
      } else {
        NotificationSystem.info('Command Palette non disponible');
      }
    });

    // Ctrl+Shift+F : Filtres avanc√©s
    this.register('Ctrl+Shift+F', () => {
      this.toggleFilters();
    });

    // ========== √âDITION ==========

    // Ctrl+Z : Annuler (Undo)
    this.register('Ctrl+Z', async () => {
      if (window.UndoRedoManager) {
        await window.UndoRedoManager.undo();
      } else {
        NotificationSystem.info('‚è™ Syst√®me Undo/Redo non disponible');
      }
    });

    // Ctrl+Y : R√©tablir (Redo)
    this.register('Ctrl+Y', async () => {
      if (window.UndoRedoManager) {
        await window.UndoRedoManager.redo();
      } else {
        NotificationSystem.info('‚è© Syst√®me Undo/Redo non disponible');
      }
    });

    // Ctrl+A : Tout s√©lectionner dans tableau actif
    this.register('Ctrl+A', () => {
      this.selectAll();
    });

    // ========== DEVIS/FACTURES ==========

    // Ctrl+Q : Nouveau devis rapide
    this.register('Ctrl+Q', () => {
      if (typeof window.clearQuote === 'function') {
        window.clearQuote();
        NotificationSystem.success('üìÑ Nouveau devis (Ctrl+Q)');
      }
    });

    // Ctrl+I : Nouvelle facture rapide
    this.register('Ctrl+i', () => {
      document.getElementById('invoices-tab')?.click();
      NotificationSystem.success('üí∞ Onglet Factures (Ctrl+I)');
    });

    // Ctrl+B : Basculer devis ‚Üí facture
    this.register('Ctrl+B', () => {
      this.convertQuoteToInvoice();
    });

    // ========== AIDE ET INFOS ==========

    // F1 : Afficher aide
    this.register('F1', () => {
      this.showHelp();
    });

    // Ctrl+/ : Liste raccourcis
    this.register('Ctrl+/', () => {
      this.showHelp();
    });

    // F2 : Lancer le tour guid√©
    this.register('F2', () => {
      const tourModule = window.app?.getModule('tour');
      if (tourModule) {
        tourModule.startTour('general');
        NotificationSystem.success('üéØ Tour guid√© d√©marr√© (F2)');
      }
    });

    // F5 : Rafra√Æchir donn√©es
    this.register('F5', () => {
      this.refreshData();
    });

    // ========== RACCOURCIS RAPIDES ==========

    // Ctrl+&amp; ou Ctrl+Shift+1 : Dashboard (support AZERTY)
    this.register('Ctrl+&amp;', () => {
      document.getElementById('accueil-tab')?.click();
      NotificationSystem.success('üìä Dashboard (Ctrl+&amp;)');
    });
    this.register('Ctrl+Shift+1', () => {
      document.getElementById('accueil-tab')?.click();
      NotificationSystem.success('üìä Dashboard (Ctrl+Shift+1)');
    });

    // Ctrl+√© ou Ctrl+Shift+2 : Recherche (support AZERTY)
    this.register('Ctrl+√©', () => {
      document.getElementById('search-tab')?.click();
      NotificationSystem.success('üîç Recherche (Ctrl+√©)');
    });
    this.register('Ctrl+Shift+2', () => {
      document.getElementById('search-tab')?.click();
      NotificationSystem.success('üîç Recherche (Ctrl+Shift+2)');
    });

    // Ctrl+" ou Ctrl+Shift+3 : Nouveau Devis (support AZERTY)
    this.register('Ctrl+"', () => {
      document.getElementById('new-quote-tab')?.click();
      NotificationSystem.success('üìù Nouveau Devis (Ctrl+")');
    });
    this.register('Ctrl+Shift+3', () => {
      document.getElementById('new-quote-tab')?.click();
      NotificationSystem.success('üìù Nouveau Devis (Ctrl+Shift+3)');
    });

    // Ctrl+' ou Ctrl+Shift+4 : Catalogue (support AZERTY) - ADMIN ONLY
    this.register("Ctrl+'", () => {
      if (window.isGuestMode) {
        NotificationSystem.warning('üîí Acc√®s refus√© - Mode invit√©');
        return;
      }
      document.getElementById('admin-tab')?.click();
      NotificationSystem.success('üì¶ Catalogue (Ctrl+\')');
    });
    this.register('Ctrl+Shift+4', () => {
      if (window.isGuestMode) {
        NotificationSystem.warning('üîí Acc√®s refus√© - Mode invit√©');
        return;
      }
      document.getElementById('admin-tab')?.click();
      NotificationSystem.success('üì¶ Catalogue (Ctrl+Shift+4)');
    });

    // Ctrl+( ou Ctrl+Shift+5 : Configuration (support AZERTY) - ADMIN ONLY
    this.register('Ctrl+(', () => {
      if (window.isGuestMode) {
        NotificationSystem.warning('üîí Acc√®s refus√© - Mode invit√©');
        return;
      }
      document.getElementById('config-tab')?.click();
      NotificationSystem.success('‚öôÔ∏è Configuration (Ctrl+()');
    });
    this.register('Ctrl+Shift+5', () => {
      if (window.isGuestMode) {
        NotificationSystem.warning('üîí Acc√®s refus√© - Mode invit√©');
        return;
      }
      document.getElementById('config-tab')?.click();
      NotificationSystem.success('‚öôÔ∏è Configuration (Ctrl+Shift+5)');
    });
  }

  /**
   * Enregistre un raccourci.
   * @param {string} combo - Combinaison de touches (ex: "Ctrl+S")
   * @param {Function} handler - Fonction √† ex√©cuter
   */
  register(combo, handler) {
    this.shortcuts.set(combo.toLowerCase(), handler);
    this.log(`Registered shortcut: ${combo}`);
  }

  /**
   * G√®re les √©v√©nements keydown.
   * @param {KeyboardEvent} e - √âv√©nement clavier
   */
  handleKeyDown = (e) => {
    if (!this.enabled) return;

    // Ignorer si focus dans input/textarea (sauf shortcuts sp√©ciaux)
    const target = e.target;
    const isInput = target.tagName === 'INPUT' || target.tagName === 'TEXTAREA';

    // Construire la combinaison de touches
    let combo = '';
    if (e.ctrlKey) combo += 'ctrl+';
    if (e.altKey) combo += 'alt+';
    if (e.shiftKey) combo += 'shift+';
    combo += e.key.toLowerCase();

    // V√©rifier si shortcut existe
    const handler = this.shortcuts.get(combo);

    if (handler) {
      // Permettre Escape et F1 m√™me dans inputs
      const allowedInInputs = ['escape', 'f1', 'ctrl+/', 'ctrl+k'];

      if (!isInput || allowedInInputs.includes(combo)) {
        e.preventDefault();
        handler();
      }
    }
  }

  /**
   * Sauvegarde le formulaire actif selon l'onglet.
   */
  saveActiveForm = () => {
    // D√©tecter onglet actif
    const activeTab = document.querySelector('.nav-link.active');
    if (!activeTab) return;

    const tabId = activeTab.getAttribute('data-bs-target');

    // Sauvegarder selon contexte
    if (tabId === '#catalogue' &amp;&amp; typeof window.saveMaterial === 'function') {
      window.saveMaterial();
      NotificationSystem.success('Mat√©riau sauvegard√© (Ctrl+S)');
    } else if (tabId === '#fournisseurs' &amp;&amp; typeof window.saveSupplier === 'function') {
      window.saveSupplier();
      NotificationSystem.success('Fournisseur sauvegard√© (Ctrl+S)');
    } else if (tabId === '#config' &amp;&amp; typeof window.saveHeaderConfig === 'function') {
      window.saveHeaderConfig();
      NotificationSystem.success('Configuration sauvegard√©e (Ctrl+S)');
    } else {
      NotificationSystem.warning('Aucun formulaire actif √† sauvegarder');
    }
  }

  /**
   * Cr√©e un nouveau document selon l'onglet actif.
   */
  createNew = () => {
    const activeTab = document.querySelector('.nav-link.active');
    if (!activeTab) return;

    const tabId = activeTab.getAttribute('data-bs-target');

    if (tabId === '#catalogue' &amp;&amp; typeof window.addMaterial === 'function') {
      window.addMaterial();
      NotificationSystem.success('Nouveau mat√©riau (Ctrl+N)');
    } else if (tabId === '#fournisseurs' &amp;&amp; typeof window.addSupplier === 'function') {
      window.addSupplier();
      NotificationSystem.success('Nouveau fournisseur (Ctrl+N)');
    } else if (tabId === '#devis' &amp;&amp; typeof window.newQuote === 'function') {
      window.newQuote();
      NotificationSystem.success('Nouveau devis (Ctrl+N)');
    } else if (tabId === '#factures' &amp;&amp; typeof window.newInvoice === 'function') {
      window.newInvoice();
      NotificationSystem.success('Nouvelle facture (Ctrl+N)');
    }
  }

  /**
   * Focus le champ de recherche actif.
   */
  focusSearch = () => {
    const activeTab = document.querySelector('.nav-link.active');
    if (!activeTab) return;

    const tabId = activeTab.getAttribute('data-bs-target');
    let searchInput = null;

    if (tabId === '#catalogue') {
      searchInput = document.getElementById('search-materials');
    } else if (tabId === '#fournisseurs') {
      searchInput = document.getElementById('search-suppliers');
    } else if (tabId === '#recherche') {
      searchInput = document.getElementById('material-search-input');
    }

    if (searchInput) {
      searchInput.focus();
      searchInput.select();
      NotificationSystem.success('Recherche activ√©e (Ctrl+F)');
    }
  }

  /**
   * Exporte les donn√©es selon le contexte.
   */
  exportData = () => {
    const activeTab = document.querySelector('.nav-link.active');
    if (!activeTab) return;

    const tabId = activeTab.getAttribute('data-bs-target');

    if (tabId === '#ca-rentabilite' &amp;&amp; typeof window.exportMonthExcel === 'function') {
      NotificationSystem.info('Export Excel (Ctrl+E)');
      // L'utilisateur devra cliquer sur le bouton d'export sp√©cifique
    } else if (tabId === '#fec' &amp;&amp; typeof window.confirmExportFEC === 'function') {
      NotificationSystem.info('Export FEC (Ctrl+E)');
    } else {
      NotificationSystem.warning('Aucun export disponible pour cet onglet');
    }
  }

  /**
   * Duplique le document actif (devis, facture, mat√©riau, etc.)
   * NOUVEAU : Fonction pour Ctrl+D
   */
  duplicateActive = () => {
    const activeTab = document.querySelector('.nav-link.active');
    if (!activeTab) return;

    const tabId = activeTab.getAttribute('data-bs-target');

    // Dupliquer selon contexte
    if (tabId === '#devis') {
      // Dupliquer le devis actuel
      if (window.currentQuoteId) {
        const currentQuote = {
          items: window.quoteItems || [],
          client: window.clientInfo || {},
          discount: document.getElementById('discount')?.value || 0
        };

        // Cr√©er un nouveau devis avec les m√™mes donn√©es
        window.clearQuote?.();
        window.quoteItems = [...currentQuote.items];
        window.clientInfo = { ...currentQuote.client };
        window.updateQuoteTable?.();

        NotificationSystem.success('üìÑ Devis dupliqu√© (Ctrl+D)');
      } else {
        NotificationSystem.warning('Aucun devis √† dupliquer');
      }
    } else if (tabId === '#catalogue') {
      // Dupliquer le mat√©riau s√©lectionn√©
      const selected = window.materials?.find(m => m.selected);
      if (selected) {
        const duplicate = { ...selected, id: Date.now(), name: selected.name + ' (copie)' };
        window.addMaterial?.(duplicate);
        NotificationSystem.success('üì¶ Mat√©riau dupliqu√© (Ctrl+D)');
      }
    } else {
      NotificationSystem.info('Duplication non disponible pour cet onglet');
    }
  }

  /**
   * Supprime l'√©l√©ment actif avec confirmation
   * NOUVEAU : Fonction pour Ctrl+Shift+D
   */
  deleteActive = () => {
    const activeTab = document.querySelector('.nav-link.active');
    if (!activeTab) return;

    const tabId = activeTab.getAttribute('data-bs-target');

    if (tabId === '#devis' &amp;&amp; window.currentQuoteId) {
      if (confirm('Supprimer ce devis ?')) {
        window.deleteQuote?.(window.currentQuoteId);
        NotificationSystem.success('üóëÔ∏è Devis supprim√© (Ctrl+Shift+D)');
      }
    } else {
      NotificationSystem.warning('S√©lectionnez un √©l√©ment √† supprimer');
    }
  }

  /**
   * Imprime ou g√©n√®re PDF du document actif
   * NOUVEAU : Fonction pour Ctrl+P
   */
  printActive = () => {
    const activeTab = document.querySelector('.nav-link.active');
    if (!activeTab) return;

    const tabId = activeTab.getAttribute('data-bs-target');

    if (tabId === '#devis' &amp;&amp; window.exportQuotePDF) {
      window.exportQuotePDF();
      NotificationSystem.success('üìÑ Export PDF (Ctrl+P)');
    } else if (tabId === '#factures' &amp;&amp; window.exportInvoicePDF) {
      window.exportInvoicePDF();
      NotificationSystem.success('üí∞ Export PDF Facture (Ctrl+P)');
    } else {
      NotificationSystem.info('Impression non disponible pour cet onglet');
    }
  }

  /**
   * Navigation vers un onglet sp√©cifique
   * NOUVEAU : Fonction pour Alt+[1-9]
   */
  switchToTab = (index) => {
    const tabs = document.querySelectorAll('.nav-link[data-bs-toggle="tab"]');
    const targetTab = tabs[index - 1];

    if (targetTab) {
      // V√©rifier si l'onglet est restreint en mode invit√©
      const tabId = targetTab.getAttribute('id');
      const restrictedTabs = ['admin-tab', 'config-tab', 'suppliers-tab', 'clients-tab'];

      if (window.isGuestMode &amp;&amp; restrictedTabs.includes(tabId)) {
        NotificationSystem.warning('üîí Acc√®s refus√© - Mode invit√©');
        return;
      }

      targetTab.click();
      NotificationSystem.success(`Onglet ${index} (Alt+${index})`);
    }
  }

  /**
   * Onglet suivant
   * NOUVEAU : Fonction pour Ctrl+Tab
   */
  nextTab = () => {
    const tabs = Array.from(document.querySelectorAll('.nav-link[data-bs-toggle="tab"]'));
    const currentIndex = tabs.findIndex(t => t.classList.contains('active'));
    const restrictedTabs = ['admin-tab', 'config-tab', 'suppliers-tab', 'clients-tab'];

    // En mode invit√©, sauter les onglets restreints
    let nextIndex = (currentIndex + 1) % tabs.length;
    let attempts = 0;

    while (window.isGuestMode &amp;&amp; restrictedTabs.includes(tabs[nextIndex]?.getAttribute('id')) &amp;&amp; attempts &lt; tabs.length) {
      nextIndex = (nextIndex + 1) % tabs.length;
      attempts++;
    }

    if (attempts &lt; tabs.length) {
      tabs[nextIndex].click();
    }
  }

  /**
   * Onglet pr√©c√©dent
   * NOUVEAU : Fonction pour Ctrl+Shift+Tab
   */
  prevTab = () => {
    const tabs = Array.from(document.querySelectorAll('.nav-link[data-bs-toggle="tab"]'));
    const currentIndex = tabs.findIndex(t => t.classList.contains('active'));
    const restrictedTabs = ['admin-tab', 'config-tab', 'suppliers-tab', 'clients-tab'];

    // En mode invit√©, sauter les onglets restreints
    let prevIndex = currentIndex > 0 ? currentIndex - 1 : tabs.length - 1;
    let attempts = 0;

    while (window.isGuestMode &amp;&amp; restrictedTabs.includes(tabs[prevIndex]?.getAttribute('id')) &amp;&amp; attempts &lt; tabs.length) {
      prevIndex = prevIndex > 0 ? prevIndex - 1 : tabs.length - 1;
      attempts++;
    }

    if (attempts &lt; tabs.length) {
      tabs[prevIndex].click();
    }
  }

  /**
   * Active/d√©sactive les filtres
   * NOUVEAU : Fonction pour Ctrl+Shift+F
   */
  toggleFilters = () => {
    const filterSection = document.querySelector('.filters-section');
    if (filterSection) {
      filterSection.style.display = filterSection.style.display === 'none' ? 'block' : 'none';
      NotificationSystem.info('üîç Filtres ' + (filterSection.style.display === 'none' ? 'masqu√©s' : 'affich√©s'));
    }
  }

  /**
   * S√©lectionne tous les √©l√©ments du tableau actif
   * NOUVEAU : Fonction pour Ctrl+A
   */
  selectAll = () => {
    const checkboxes = document.querySelectorAll('.tab-pane.active input[type="checkbox"]');
    checkboxes.forEach(cb => cb.checked = true);
    NotificationSystem.info(`‚úÖ ${checkboxes.length} √©l√©ments s√©lectionn√©s (Ctrl+A)`);
  }

  /**
   * Convertit un devis en facture
   * NOUVEAU : Fonction pour Ctrl+B
   */
  convertQuoteToInvoice = () => {
    if (window.currentQuoteId &amp;&amp; window.convertToInvoice) {
      window.convertToInvoice(window.currentQuoteId);
      NotificationSystem.success('üí∞ Devis converti en facture (Ctrl+B)');
    } else {
      NotificationSystem.warning('Chargez un devis pour le convertir');
    }
  }

  /**
   * Rafra√Æchit les donn√©es
   * NOUVEAU : Fonction pour F5
   */
  refreshData = () => {
    location.reload();
  }

  /**
   * Affiche l'aide des raccourcis clavier.
   */
  showHelp = () => {
    const helpText = `
      &lt;div class="mb-3">
        &lt;div class="p-3 rounded mb-4 border border-info" style="background-color: var(--bs-info-bg-subtle);">
          &lt;p class="mb-0 small">
            &lt;i class="fas fa-info-circle text-info">&lt;/i>
            &lt;strong>Astuce :&lt;/strong> Les raccourcis sont adapt√©s pour clavier AZERTY fran√ßais.
          &lt;/p>
        &lt;/div>

        &lt;h6 class="fw-bold mb-3 border-bottom pb-2" style="color: var(--bs-primary);">üöÄ Navigation entre onglets&lt;/h6>
        &lt;table class="table table-sm table-borderless mb-4">
          &lt;tbody>
            &lt;tr>
              &lt;td class="text-end" style="width: 40%;">
                &lt;kbd>Ctrl&lt;/kbd> + &lt;kbd>&amp;&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3">‚Üí Accueil&lt;/td>
            &lt;/tr>
            &lt;tr>
              &lt;td class="text-end">
                &lt;kbd>Ctrl&lt;/kbd> + &lt;kbd>√©&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3">‚Üí Recherche&lt;/td>
            &lt;/tr>
            &lt;tr>
              &lt;td class="text-end">
                &lt;kbd>Ctrl&lt;/kbd> + &lt;kbd>"&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3">‚Üí Nouveau Devis&lt;/td>
            &lt;/tr>
            &lt;tr>
              &lt;td class="text-end">
                &lt;kbd>Ctrl&lt;/kbd> + &lt;kbd>'&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3">‚Üí Catalogue üîí&lt;/td>
            &lt;/tr>
            &lt;tr>
              &lt;td class="text-end">
                &lt;kbd>Ctrl&lt;/kbd> + &lt;kbd>(&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3">‚Üí Configuration üîí&lt;/td>
            &lt;/tr>
            &lt;tr class="border-top">
              &lt;td class="text-end pt-2">
                &lt;kbd>Alt&lt;/kbd> + &lt;kbd>1-9&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3 pt-2">‚Üí Onglet par position&lt;/td>
            &lt;/tr>
            &lt;tr>
              &lt;td class="text-end">
                &lt;kbd>Ctrl&lt;/kbd> + &lt;kbd>Tab&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3">‚Üí Onglet suivant&lt;/td>
            &lt;/tr>
            &lt;tr>
              &lt;td class="text-end">
                &lt;kbd>Ctrl&lt;/kbd> + &lt;kbd>Shift&lt;/kbd> + &lt;kbd>Tab&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3">‚Üí Onglet pr√©c√©dent&lt;/td>
            &lt;/tr>
          &lt;/tbody>
        &lt;/table>

        &lt;h6 class="fw-bold mb-3 border-bottom pb-2" style="color: var(--bs-primary);">üìù Actions &amp; √âdition&lt;/h6>
        &lt;table class="table table-sm table-borderless mb-4">
          &lt;tbody>
            &lt;tr>
              &lt;td class="text-end" style="width: 40%;">
                &lt;kbd>Ctrl&lt;/kbd> + &lt;kbd>Z&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3">‚Üí &lt;strong>Annuler (Undo)&lt;/strong>&lt;/td>
            &lt;/tr>
            &lt;tr>
              &lt;td class="text-end">
                &lt;kbd>Ctrl&lt;/kbd> + &lt;kbd>Y&lt;/kbd> ou &lt;kbd>Ctrl&lt;/kbd> + &lt;kbd>Shift&lt;/kbd> + &lt;kbd>Z&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3">‚Üí &lt;strong>R√©tablir (Redo)&lt;/strong>&lt;/td>
            &lt;/tr>
            &lt;tr class="border-top">
              &lt;td class="text-end pt-2">
                &lt;kbd>Ctrl&lt;/kbd> + &lt;kbd>S&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3 pt-2">‚Üí Sauvegarder&lt;/td>
            &lt;/tr>
            &lt;tr>
              &lt;td class="text-end">
                &lt;kbd>Ctrl&lt;/kbd> + &lt;kbd>N&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3">‚Üí Nouveau (contextuel)&lt;/td>
            &lt;/tr>
            &lt;tr>
              &lt;td class="text-end">
                &lt;kbd>Ctrl&lt;/kbd> + &lt;kbd>D&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3">‚Üí &lt;strong>Dupliquer&lt;/strong>&lt;/td>
            &lt;/tr>
            &lt;tr>
              &lt;td class="text-end">
                &lt;kbd>Ctrl&lt;/kbd> + &lt;kbd>P&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3">‚Üí Imprimer / G√©n√©rer PDF&lt;/td>
            &lt;/tr>
            &lt;tr>
              &lt;td class="text-end">
                &lt;kbd>Delete&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3">‚Üí Supprimer&lt;/td>
            &lt;/tr>
          &lt;/tbody>
        &lt;/table>

        &lt;h6 class="fw-bold mb-3 border-bottom pb-2" style="color: var(--bs-primary);">üìÑ Devis &amp; Factures&lt;/h6>
        &lt;table class="table table-sm table-borderless mb-4">
          &lt;tbody>
            &lt;tr>
              &lt;td class="text-end" style="width: 40%;">
                &lt;kbd>Ctrl&lt;/kbd> + &lt;kbd>Q&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3">‚Üí Nouveau devis rapide&lt;/td>
            &lt;/tr>
            &lt;tr>
              &lt;td class="text-end">
                &lt;kbd>Ctrl&lt;/kbd> + &lt;kbd>I&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3">‚Üí Aller aux Factures&lt;/td>
            &lt;/tr>
            &lt;tr>
              &lt;td class="text-end">
                &lt;kbd>Ctrl&lt;/kbd> + &lt;kbd>B&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3">‚Üí Convertir en facture&lt;/td>
            &lt;/tr>
          &lt;/tbody>
        &lt;/table>

        &lt;h6 class="fw-bold mb-3 border-bottom pb-2" style="color: var(--bs-primary);">üîç Recherche &amp; Navigation&lt;/h6>
        &lt;table class="table table-sm table-borderless mb-4">
          &lt;tbody>
            &lt;tr>
              &lt;td class="text-end" style="width: 40%;">
                &lt;kbd>Ctrl&lt;/kbd> + &lt;kbd>Shift&lt;/kbd> + &lt;kbd>P&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3">‚Üí &lt;strong>Command Palette&lt;/strong> (acc√®s rapide)&lt;/td>
            &lt;/tr>
            &lt;tr>
              &lt;td class="text-end" style="width: 40%;">
                &lt;kbd>Ctrl&lt;/kbd> + &lt;kbd>K&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3">‚Üí Quick Add (ajout rapide mat√©riaux)&lt;/td>
            &lt;/tr>
            &lt;tr>
              &lt;td class="text-end">
                &lt;kbd>Ctrl&lt;/kbd> + &lt;kbd>F&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3">‚Üí Recherche dans l'onglet&lt;/td>
            &lt;/tr>
          &lt;/tbody>
        &lt;/table>

        &lt;h6 class="fw-bold mb-3 border-bottom pb-2" style="color: var(--bs-primary);">üõ†Ô∏è Utilitaires&lt;/h6>
        &lt;table class="table table-sm table-borderless mb-4">
          &lt;tbody>
            &lt;tr>
              &lt;td class="text-end" style="width: 40%;">
                &lt;kbd>F1&lt;/kbd> ou &lt;kbd>Ctrl&lt;/kbd> + &lt;kbd>/&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3">‚Üí Afficher cette aide&lt;/td>
            &lt;/tr>
            &lt;tr>
              &lt;td class="text-end">
                &lt;kbd>F2&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3">‚Üí &lt;strong>Lancer le tour guid√©&lt;/strong>&lt;/td>
            &lt;/tr>
            &lt;tr>
              &lt;td class="text-end">
                &lt;kbd>F5&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3">‚Üí Rafra√Æchir&lt;/td>
            &lt;/tr>
            &lt;tr>
              &lt;td class="text-end">
                &lt;kbd>Escape&lt;/kbd>
              &lt;/td>
              &lt;td class="ps-3">‚Üí Fermer / Annuler&lt;/td>
            &lt;/tr>
          &lt;/tbody>
        &lt;/table>

        &lt;div class="p-3 rounded border border-warning" style="background-color: var(--bs-warning-bg-subtle);">
          &lt;p class="mb-0 small">
            &lt;i class="fas fa-lock text-warning">&lt;/i>
            &lt;strong>Mode invit√© :&lt;/strong> Certains raccourcis sont restreints (marqu√©s üîí)
          &lt;/p>
        &lt;/div>
      &lt;/div>
    `;

    // Afficher la modal au lieu d'une notification
    const modalElement = document.getElementById('shortcutsModal');
    const modalBody = document.getElementById('shortcutsModalBody');

    if (modalBody &amp;&amp; modalElement) {
      modalBody.innerHTML = helpText;

      // Utiliser getOrCreateInstance pour √©viter les backdrops multiples
      const modal = bootstrap.Modal.getOrCreateInstance(modalElement);
      modal.show();
    } else {
      // Fallback si la modal n'existe pas
      NotificationSystem.info('Ouvrez le menu Aide > Raccourcis clavier pour voir tous les raccourcis');
    }
  }

  /**
   * Active/d√©sactive les shortcuts.
   * @param {boolean} enabled
   */
  setEnabled(enabled) {
    this.enabled = enabled;
    this.log(`Shortcuts ${enabled ? 'enabled' : 'disabled'}`);
  }

  /**
   * Cleanup lors de la destruction.
   */
  destroy() {
    document.removeEventListener('keydown', this.handleKeyDown);
    this.shortcuts.clear();
    super.destroy();
  }
}

export default KeyboardShortcutsModule;
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
