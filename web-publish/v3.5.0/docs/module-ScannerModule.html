<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> ScannerModule</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Modules</h3><ul><li><a href="module-AboutModule.html">AboutModule</a></li><li><a href="module-AuthModule.html">AuthModule</a></li><li><a href="module-BackupModule.html">BackupModule</a></li><li><a href="module-ClientsModule.html">ClientsModule</a></li><li><a href="module-ConfigModule.html">ConfigModule</a></li><li><a href="module-DashboardModule.html">DashboardModule</a></li><li><a href="module-DataCache.html">DataCache</a></li><li><a href="module-ExportModule.html">ExportModule</a></li><li><a href="module-FECModule.html">FECModule</a></li><li><a href="module-FollowUpModule.html">FollowUpModule</a></li><li><a href="module-ImportModule.html">ImportModule</a></li><li><a href="module-InvoicesModule.html">InvoicesModule</a></li><li><a href="module-KeyboardShortcutsModule.html">KeyboardShortcutsModule</a></li><li><a href="module-Logger.html">Logger</a></li><li><a href="module-MLService.html">MLService</a></li><li><a href="module-MaterialsModule.html">MaterialsModule</a></li><li><a href="module-NotificationSystem.html">NotificationSystem</a></li><li><a href="module-NotificationSystemV2.html">NotificationSystemV2</a></li><li><a href="module-PDFModule.html">PDFModule</a></li><li><a href="module-QuickAddModule.html">QuickAddModule</a></li><li><a href="module-QuoteBuilderModule.html">QuoteBuilderModule</a></li><li><a href="module-QuotesModule.html">QuotesModule</a></li><li><a href="module-RevenueModule.html">RevenueModule</a></li><li><a href="module-ScannerModule.html">ScannerModule</a></li><li><a href="module-SuppliersModule.html">SuppliersModule</a></li><li><a href="module-TemplatesModule.html">TemplatesModule</a></li><li><a href="module-TourModule.html">TourModule</a></li><li><a href="module-UtilitiesModule.html">UtilitiesModule</a></li><li><a href="module-calculations.html">calculations</a></li><li><a href="module-constants.html">constants</a></li><li><a href="module-formatters.html">formatters</a></li><li><a href="module-helpers.html">helpers</a></li></ul><h3>Classes</h3><ul><li><a href="BaseModule.html">BaseModule</a></li><li><a href="BulkActionsManager.html">BulkActionsManager</a></li><li><a href="CacheKeys.html">CacheKeys</a></li><li><a href="EventBus.html">EventBus</a></li><li><a href="LoadingStateManager.html">LoadingStateManager</a></li><li><a href="ModalHelper.html">ModalHelper</a></li><li><a href="PaginationManager.html">PaginationManager</a></li><li><a href="ServerValidator.html">ServerValidator</a></li><li><a href="StateManager.html">StateManager</a></li><li><a href="TabRefreshManager.html">TabRefreshManager</a></li><li><a href="UndoRedoManager.html">UndoRedoManager</a></li><li><a href="module-AboutModule-AboutModule.html">AboutModule</a></li><li><a href="module-AuthModule-AuthModule.html">AuthModule</a></li><li><a href="module-BackupModule-BackupModule.html">BackupModule</a></li><li><a href="module-ClientsModule-ClientsModule.html">ClientsModule</a></li><li><a href="module-ConfigModule-ConfigModule.html">ConfigModule</a></li><li><a href="module-DashboardModule-DashboardModule.html">DashboardModule</a></li><li><a href="module-ExportModule-ExportModule.html">ExportModule</a></li><li><a href="module-FECModule-FECModule.html">FECModule</a></li><li><a href="module-ImportModule-ImportModule.html">ImportModule</a></li><li><a href="module-InvoicesModule-InvoicesModule.html">InvoicesModule</a></li><li><a href="module-Logger-Logger.html">Logger</a></li><li><a href="module-Logger-ModuleLogger.html">ModuleLogger</a></li><li><a href="module-MaterialsModule-MaterialsModule.html">MaterialsModule</a></li><li><a href="module-PDFModule-PDFModule.html">PDFModule</a></li><li><a href="module-QuickAddModule-QuickAddModule.html">QuickAddModule</a></li><li><a href="module-QuoteBuilderModule-QuoteBuilderModule.html">QuoteBuilderModule</a></li><li><a href="module-QuotesModule-QuotesModule.html">QuotesModule</a></li><li><a href="module-RevenueModule-RevenueModule.html">RevenueModule</a></li><li><a href="module-ScannerModule-ScannerModule.html">ScannerModule</a></li><li><a href="module-SuppliersModule-SuppliersModule.html">SuppliersModule</a></li><li><a href="module-TemplatesModule-TemplatesModule.html">TemplatesModule</a></li><li><a href="module-UtilitiesModule-UtilitiesModule.html">UtilitiesModule</a></li></ul><h3>Global</h3><ul><li><a href="global.html#clear">clear</a></li><li><a href="global.html#crypto">crypto</a></li><li><a href="global.html#emit">emit</a></li><li><a href="global.html#emitSync">emitSync</a></li><li><a href="global.html#off">off</a></li><li><a href="global.html#on">on</a></li><li><a href="global.html#once">once</a></li><li><a href="global.html#validateBeforeAddToQuote">validateBeforeAddToQuote</a></li><li><a href="global.html#validateBeforeExport">validateBeforeExport</a></li><li><a href="global.html#validateBeforeSaveMaterial">validateBeforeSaveMaterial</a></li><li><a href="global.html#validateBeforeSendEmail">validateBeforeSendEmail</a></li><li><a href="global.html#validateHeaderConfig">validateHeaderConfig</a></li><li><a href="global.html#validatePasswordChange">validatePasswordChange</a></li><li><a href="global.html#validateSMTPConfig">validateSMTPConfig</a></li><li><a href="global.html#waitFor">waitFor</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Module</p>
                    <h1>ScannerModule</h1>
                </header>
                




<section>

<header>
    
        
            
        
    
</header>

<article>
    <div class="container-overview">
    
        
            <div class="description"><h1>========================================
SCANNER MODULE - Scanner de codes-barres</h1>
<p>Module de gestion du scanner de codes-barres pour AutoCalc OptiDevis.
Permet de scanner les codes-barres des matériaux pour accélérer la recherche
et l'ajout de produits au catalogue ou aux devis.</p>
<p>Architecture :
Le module gère un scanner de codes-barres avec :</p>
<ul>
<li><strong>Bibliothèque Quagga</strong> : Scanner JavaScript open-source pour codes-barres</li>
<li><strong>Accès caméra</strong> : navigator.mediaDevices.getUserMedia (WebRTC)</li>
<li><strong>Détection automatique</strong> : Reconnaissance multi-formats (EAN, UPC, Code 39, Code 128)</li>
<li><strong>Intégration recherche</strong> : Remplissage auto du champ de recherche matériaux</li>
<li><strong>Gestion flux vidéo</strong> : Démarrage, arrêt et libération propre des ressources</li>
</ul>
<h1>==========================================
CAS D'USAGE TYPIQUES</h1>
<p><strong>Exemple 1 : Ajout rapide de matériau au devis</strong> :</p>
<ul>
<li>Vendeur clique bouton &quot;Scanner code-barres&quot;</li>
<li>Scanner démarre avec caméra arrière (facingMode: environment)</li>
<li>Vendeur pointe le produit avec code-barres EAN-13</li>
<li>Détection automatique en ~1 seconde</li>
<li>Code-barres rempli dans champ de recherche</li>
<li>Recherche automatique déclenchée</li>
<li>Scanner s'arrête automatiquement</li>
<li>Vendeur sélectionne le matériau trouvé et l'ajoute au devis</li>
</ul>
<p><strong>Exemple 2 : Inventaire des produits</strong> :</p>
<ul>
<li>Admin scanne plusieurs produits pour vérifier leur présence</li>
<li>Chaque scan remplit la recherche et affiche le produit</li>
<li>Permet de valider rapidement la concordance code-barres / produit</li>
</ul>
<h1>==========================================
BIBLIOTHÈQUE QUAGGA</h1>
<p><strong>Qu'est-ce que Quagga ?</strong> :</p>
<ul>
<li>Bibliothèque JavaScript open-source pour scanner codes-barres</li>
<li>Fonctionne dans le navigateur (pas besoin d'app native)</li>
<li>Utilise WebRTC pour accès caméra</li>
<li>Supporte 5+ formats de codes-barres</li>
<li>GitHub : https://github.com/serratus/quaggaJS</li>
</ul>
<p><strong>Formats supportés</strong> :</p>
<ul>
<li>EAN-13 : Codes-barres européens (13 chiffres) - ex: 3760123456789</li>
<li>EAN-8 : Version courte (8 chiffres)</li>
<li>UPC : Codes-barres américains (Universal Product Code)</li>
<li>Code 39 : Format alphanumérique (utilisé industrie)</li>
<li>Code 128 : Format haute densité (logistique, transport)</li>
</ul>
<p><strong>Configuration Quagga</strong> :</p>
<ul>
<li>inputStream : Configuration de la caméra (résolution 640x480, facingMode: environment)</li>
<li>decoder.readers : Liste des formats à reconnaître</li>
<li>target : Élément <video> où afficher le flux</li>
<li>callbacks : onDetected() appelé lors de détection réussie</li>
</ul>
<h1>==========================================
WORKFLOW COMPLET - SCAN DE CODE-BARRES</h1>
<p><strong>Phase 1 : Démarrage</strong> (startScanner)</p>
<ol>
<li>Utilisateur clique bouton &quot;Scanner code-barres&quot;</li>
<li>Récupération éléments DOM (#scanner-container, #scanner-video)</li>
<li>Demande accès caméra via navigator.mediaDevices.getUserMedia :
<ul>
<li>video: { facingMode: 'environment' } (caméra arrière)</li>
<li>Si refusé → error &quot;Accès à la webcam refusé ou indisponible&quot;</li>
</ul>
</li>
<li>Si accordé :
<ul>
<li>Flux vidéo assigné à scannerVideo.srcObject</li>
<li>scannerVideo.play() pour démarrer lecture</li>
</ul>
</li>
<li>Affichage conteneur scanner (#scanner-container) avec display: flex</li>
<li>Vérification présence window.Quagga (bibliothèque chargée)</li>
<li>Initialisation Quagga.init() avec configuration :
<ul>
<li>inputStream : Live, LiveStream, résolution 640x480</li>
<li>decoder : 5 readers (EAN, UPC, Code 39, Code 128)</li>
<li>target : scannerVideo</li>
</ul>
</li>
<li>Si erreur init → stopScanner() + error</li>
<li>Si succès :
<ul>
<li>Quagga.start() pour commencer le scan</li>
<li>this.isInitialized = true</li>
<li>NotificationSystem.success &quot;Scanner démarré&quot;</li>
</ul>
</li>
<li>Configuration callback Quagga.onDetected() :
<ul>
<li>Appelé automatiquement lors de détection d'un code-barres</li>
</ul>
</li>
</ol>
<p><strong>Phase 2 : Détection</strong> (Quagga.onDetected callback)
11. Code-barres détecté automatiquement par Quagga
12. Extraction du code : data.codeResult.code
13. Remplissage champ de recherche (#search-input) avec le code
14. Déclenchement recherche automatique :
- Appelle window.debouncedSearchMaterial() (MaterialsModule)
- Recherche le matériau avec ce code-barres dans le catalogue
15. Arrêt automatique du scanner (stopScanner)
16. Émission événement 'barcode-detected' avec { code }</p>
<p><strong>Phase 3 : Arrêt</strong> (stopScanner)
17. Arrêt Quagga : Quagga.stop()
18. Arrêt flux vidéo :
- scannerVideo.srcObject.getTracks().forEach(track =&gt; track.stop())
- Libère la caméra (important pour permission)
- scannerVideo.srcObject = null
19. Masquage conteneur scanner (#scanner-container) avec display: none
20. Émission événement 'scanner-stopped'
21. NotificationSystem.success &quot;Scanner arrêté&quot;</p>
<h1>==========================================
ÉLÉMENTS DOM</h1>
<p><strong>Conteneur principal</strong> (#scanner-container) :</p>
<ul>
<li>Display : flex (visible) / none (masqué)</li>
<li>Position : Overlay fullscreen recommandé</li>
<li>Contenu : Élément <video> + bouton &quot;Arrêter&quot;</li>
</ul>
<p><strong>Élément vidéo</strong> (#scanner-video) :</p>
<ul>
<li>Tag <video> natif HTML5</li>
<li>srcObject : MediaStream de la caméra</li>
<li>Résolution : 640x480 (configuré dans Quagga)</li>
<li>Autoplay : Oui (via scannerVideo.play())</li>
</ul>
<p><strong>Champ de recherche</strong> (#search-input) :</p>
<ul>
<li>Input text de MaterialsModule</li>
<li>Rempli automatiquement avec le code-barres détecté</li>
<li>Déclenche la recherche via debouncedSearchMaterial()</li>
</ul>
<h1>==========================================
GESTION DES PERMISSIONS CAMÉRA</h1>
<p><strong>Demande de permission</strong> :</p>
<ul>
<li>navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })</li>
<li>Affiche popup native du navigateur &quot;Autoriser l'accès à la caméra ?&quot;</li>
<li>facingMode: 'environment' = Caméra arrière (smartphones)</li>
<li>facingMode: 'user' = Caméra avant (selfie)</li>
</ul>
<p><strong>Gestion du refus</strong> :</p>
<ul>
<li>Si utilisateur refuse → catch error</li>
<li>NotificationSystem.error &quot;Accès à la webcam refusé ou indisponible&quot;</li>
<li>Scanner ne démarre pas</li>
</ul>
<p><strong>Libération de la caméra</strong> :</p>
<ul>
<li>IMPORTANT : Appeler track.stop() sur tous les tracks du MediaStream</li>
<li>Sinon : Caméra reste active (LED allumée, consommation batterie)</li>
<li>stopScanner() libère proprement avec getTracks().forEach(track =&gt; track.stop())</li>
</ul>
<h1>==========================================
ÉVÉNEMENTS ÉMIS</h1>
<p><strong>EventBus interne</strong> :</p>
<ul>
<li>'barcode-detected' : Après détection réussie (avec { code })</li>
<li>'scanner-stopped' : Après arrêt du scanner</li>
</ul>
<p><strong>Utilité</strong> :</p>
<ul>
<li>Autres modules peuvent écouter 'barcode-detected' pour réagir au scan</li>
<li>Ex: LogModule peut logger tous les scans effectués</li>
</ul>
<h1>==========================================
INTÉGRATIONS</h1>
<ul>
<li><strong>MaterialsModule</strong> : Utilise window.debouncedSearchMaterial() pour recherche auto</li>
<li><strong>MaterialsModule</strong> : Remplit #search-input avec le code scanné</li>
<li><strong>Quagga.js</strong> : Bibliothèque externe (chargée via CDN ou bundle)</li>
<li><strong>WebRTC API</strong> : navigator.mediaDevices.getUserMedia pour accès caméra</li>
<li><strong>NotificationSystem</strong> : Feedback utilisateur (success, error)</li>
</ul>
<h1>==========================================
ÉTAT DU MODULE</h1>
<p><strong>this.isInitialized</strong> :</p>
<ul>
<li>Boolean : Scanner Quagga initialisé et actif</li>
<li>true : Scanner en cours (Quagga.start() appelé)</li>
<li>false : Scanner arrêté ou jamais démarré</li>
<li>Utilisé dans stopScanner() pour éviter double-arrêt</li>
</ul>
<h1>==========================================
SÉCURITÉ &amp; BONNES PRATIQUES</h1>
<p><strong>Libération des ressources</strong> :</p>
<ul>
<li>Toujours arrêter le flux vidéo via track.stop()</li>
<li>Éviter les fuites mémoire avec srcObject = null</li>
<li>destroy() appelle stopScanner() pour cleanup complet</li>
</ul>
<p><strong>Gestion des erreurs</strong> :</p>
<ul>
<li>Try/catch autour de getUserMedia (permission refusée)</li>
<li>Try/catch autour de Quagga.init (bibliothèque non chargée)</li>
<li>Arrêt automatique en cas d'erreur (stopScanner)</li>
</ul>
<p><strong>Performance</strong> :</p>
<ul>
<li>Arrêt automatique après détection (évite scan continu inutile)</li>
<li>Résolution 640x480 (bon compromis qualité/performance)</li>
<li>Seulement 5 readers activés (pas tous les formats Quagga)</li>
</ul></div>
        

        
            














<dl class="details">

    
    <dt class="tag-version">Version:</dt>
    <dd class="tag-version"><ul class="dummy"><li>2.0.0</li></ul></dd>
    

    

    

    

    

    

    

    

    
    <dt class="tag-author">Author:</dt>
    <dd class="tag-author">
        <ul>
            <li>AutoCalc OptiDevis</li>
        </ul>
    </dd>
    

    

    

    
    

    

    

    
        <p class="tag-source">
            <a href="modules_scanner_ScannerModule.js.html" class="button">View Source</a>
            <span>
                <a href="modules_scanner_ScannerModule.js.html">modules/scanner/ScannerModule.js</a>, <a href="modules_scanner_ScannerModule.js.html#line1">line 1</a>
            </span>
        </p>
    
</dl>






















        
    
    </div>
    
    
        <h3 class="subsection-title">Extends</h3>

        


    <ul>
        <li><a href="BaseModule.html">BaseModule</a></li>
    </ul>


    

    

    
        <h3 class="subsection-title">Classes</h3>

        <dl>
            <dt><a href="module-ScannerModule-ScannerModule.html">ScannerModule</a></dt>
            <dd></dd>
        </dl>
    

    

    

    

    

    

    

    
</article>

</section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>