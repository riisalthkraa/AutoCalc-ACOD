

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> core/StateManager.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Modules</h3><ul><li><a href="module-AboutModule.html">AboutModule</a></li><li><a href="module-AuthModule.html">AuthModule</a></li><li><a href="module-BackupModule.html">BackupModule</a></li><li><a href="module-ClientsModule.html">ClientsModule</a></li><li><a href="module-ConfigModule.html">ConfigModule</a></li><li><a href="module-DashboardModule.html">DashboardModule</a></li><li><a href="module-DataCache.html">DataCache</a></li><li><a href="module-ExportModule.html">ExportModule</a></li><li><a href="module-FECModule.html">FECModule</a></li><li><a href="module-FollowUpModule.html">FollowUpModule</a></li><li><a href="module-ImportModule.html">ImportModule</a></li><li><a href="module-InvoicesModule.html">InvoicesModule</a></li><li><a href="module-KeyboardShortcutsModule.html">KeyboardShortcutsModule</a></li><li><a href="module-Logger.html">Logger</a></li><li><a href="module-MLService.html">MLService</a></li><li><a href="module-MaterialsModule.html">MaterialsModule</a></li><li><a href="module-NotificationSystem.html">NotificationSystem</a></li><li><a href="module-NotificationSystemV2.html">NotificationSystemV2</a></li><li><a href="module-PDFModule.html">PDFModule</a></li><li><a href="module-QuickAddModule.html">QuickAddModule</a></li><li><a href="module-QuoteBuilderModule.html">QuoteBuilderModule</a></li><li><a href="module-QuotesModule.html">QuotesModule</a></li><li><a href="module-RevenueModule.html">RevenueModule</a></li><li><a href="module-ScannerModule.html">ScannerModule</a></li><li><a href="module-SuppliersModule.html">SuppliersModule</a></li><li><a href="module-TemplatesModule.html">TemplatesModule</a></li><li><a href="module-TourModule.html">TourModule</a></li><li><a href="module-UtilitiesModule.html">UtilitiesModule</a></li><li><a href="module-calculations.html">calculations</a></li><li><a href="module-constants.html">constants</a></li><li><a href="module-formatters.html">formatters</a></li><li><a href="module-helpers.html">helpers</a></li></ul><h3>Classes</h3><ul><li><a href="BaseModule.html">BaseModule</a></li><li><a href="BulkActionsManager.html">BulkActionsManager</a></li><li><a href="CacheKeys.html">CacheKeys</a></li><li><a href="EventBus.html">EventBus</a></li><li><a href="LoadingStateManager.html">LoadingStateManager</a></li><li><a href="ModalHelper.html">ModalHelper</a></li><li><a href="PaginationManager.html">PaginationManager</a></li><li><a href="ServerValidator.html">ServerValidator</a></li><li><a href="StateManager.html">StateManager</a></li><li><a href="TabRefreshManager.html">TabRefreshManager</a></li><li><a href="UndoRedoManager.html">UndoRedoManager</a></li><li><a href="module-AboutModule-AboutModule.html">AboutModule</a></li><li><a href="module-AuthModule-AuthModule.html">AuthModule</a></li><li><a href="module-BackupModule-BackupModule.html">BackupModule</a></li><li><a href="module-ClientsModule-ClientsModule.html">ClientsModule</a></li><li><a href="module-ConfigModule-ConfigModule.html">ConfigModule</a></li><li><a href="module-DashboardModule-DashboardModule.html">DashboardModule</a></li><li><a href="module-ExportModule-ExportModule.html">ExportModule</a></li><li><a href="module-FECModule-FECModule.html">FECModule</a></li><li><a href="module-ImportModule-ImportModule.html">ImportModule</a></li><li><a href="module-InvoicesModule-InvoicesModule.html">InvoicesModule</a></li><li><a href="module-Logger-Logger.html">Logger</a></li><li><a href="module-Logger-ModuleLogger.html">ModuleLogger</a></li><li><a href="module-MaterialsModule-MaterialsModule.html">MaterialsModule</a></li><li><a href="module-PDFModule-PDFModule.html">PDFModule</a></li><li><a href="module-QuickAddModule-QuickAddModule.html">QuickAddModule</a></li><li><a href="module-QuoteBuilderModule-QuoteBuilderModule.html">QuoteBuilderModule</a></li><li><a href="module-QuotesModule-QuotesModule.html">QuotesModule</a></li><li><a href="module-RevenueModule-RevenueModule.html">RevenueModule</a></li><li><a href="module-ScannerModule-ScannerModule.html">ScannerModule</a></li><li><a href="module-SuppliersModule-SuppliersModule.html">SuppliersModule</a></li><li><a href="module-TemplatesModule-TemplatesModule.html">TemplatesModule</a></li><li><a href="module-UtilitiesModule-UtilitiesModule.html">UtilitiesModule</a></li></ul><h3>Global</h3><ul><li><a href="global.html#clear">clear</a></li><li><a href="global.html#crypto">crypto</a></li><li><a href="global.html#emit">emit</a></li><li><a href="global.html#emitSync">emitSync</a></li><li><a href="global.html#off">off</a></li><li><a href="global.html#on">on</a></li><li><a href="global.html#once">once</a></li><li><a href="global.html#validateBeforeAddToQuote">validateBeforeAddToQuote</a></li><li><a href="global.html#validateBeforeExport">validateBeforeExport</a></li><li><a href="global.html#validateBeforeSaveMaterial">validateBeforeSaveMaterial</a></li><li><a href="global.html#validateBeforeSendEmail">validateBeforeSendEmail</a></li><li><a href="global.html#validateHeaderConfig">validateHeaderConfig</a></li><li><a href="global.html#validatePasswordChange">validatePasswordChange</a></li><li><a href="global.html#validateSMTPConfig">validateSMTPConfig</a></li><li><a href="global.html#waitFor">waitFor</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>core/StateManager.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * ========================================
 * STATE MANAGER - Gestionnaire d'état global
 * ========================================
 *
 * Gestion centralisée de l'état de l'application AutoCalc OptiDevis.
 * Remplace les variables globales dispersées pour fournir un point unique
 * de vérité (Single Source of Truth) avec un système de réactivité.
 *
 * Architecture :
 * - Pattern Observer pour la réactivité
 * - Système de souscription/notification
 * - Historique des changements pour le debugging
 * - Support du mode debug avec logging détaillé
 *
 * Responsabilités :
 * - Stocker l'état global de l'application (matériaux, devis, config, etc.)
 * - Notifier les modules des changements d'état via callbacks
 * - Maintenir un historique des modifications (100 derniers changements)
 * - Fournir des méthodes de sauvegarde/restauration de l'état
 * - Gérer la souscription/désinscription aux changements
 *
 * État géré :
 * - Données métier : materials, quoteItems, appConfig
 * - Informations client : clientInfo (nom, email, téléphone, adresse)
 * - État UI : selectedMaterial, currentTab, headerConfig
 * - Gestion devis : currentQuoteId, currentQuoteName, currentQuoteStatus
 * - Gestion factures : currentInvoiceForPayment
 * - Authentification : isAuthenticatedThisSession, isGuestMode, sessionToken
 * - Analytics : materialSearchHistory
 *
 * Pattern Observer :
 * ```javascript
 * // Souscription
 * const unsubscribe = stateManager.subscribe('materials', (newValue, oldValue) => {
 *   console.log('Materials changed:', newValue);
 * });
 *
 * // Modification (déclenche automatiquement les callbacks)
 * stateManager.set('materials', newMaterials);
 *
 * // Désinscription
 * unsubscribe();
 * ```
 *
 * Événements émis :
 * Aucun (utilise des callbacks directs via le système de souscription)
 *
 * Événements écoutés :
 * Aucun (class passive qui répond aux appels directs)
 *
 * @module StateManager
 * @class StateManager
 * @version 1.0.0
 * @author Claude AI - AutoCalc OptiDevis Refactoring
 * @created 2024-10-XX
 */

class StateManager {
  /**
   * Constructeur du StateManager
   * Initialise l'état global avec toutes les clés nécessaires à l'application
   *
   * @constructor
   */
  constructor() {
    /**
     * État centralisé de l'application
     * Toutes les clés sont initialisées avec des valeurs par défaut
     * @type {Object}
     * @private
     */
    this.state = {
      // ==========================================
      // DONNÉES MÉTIER PRINCIPALES
      // ==========================================

      /**
       * Catalogue de matériaux chargé depuis la base de données
       * @type {Material[]}
       */
      materials: [],

      /**
       * Articles ajoutés au devis en cours de construction
       * @type {QuoteItem[]}
       */
      quoteItems: [],

      /**
       * Configuration globale de l'application (SMTP, en-tête, etc.)
       * @type {Object}
       */
      appConfig: {},

      // ==========================================
      // INFORMATIONS DU CLIENT ET DU DEVIS EN COURS
      // ==========================================

      /**
       * Informations du client pour le devis en cours
       * @type {Object}
       * @property {string} name - Nom du client
       * @property {string} phone - Téléphone du client
       * @property {string} email - Email du client
       * @property {string} address - Adresse du client
       * @property {string} quoteDate - Date du devis (format ISO)
       * @property {string} issuer - Nom de l'émetteur du devis
       */
      clientInfo: {
        name: '',
        phone: '',
        email: '',
        address: '',
        quoteDate: new Date().toISOString().split('T')[0],
        issuer: ''
      },

      // ==========================================
      // ÉTAT DE L'INTERFACE UTILISATEUR
      // ==========================================

      /**
       * Matériau actuellement sélectionné dans le catalogue
       * @type {Material|null}
       */
      selectedMaterial: null,

      /**
       * Configuration de l'en-tête (logo, texte, etc.)
       * @type {Object}
       */
      headerConfig: {},

      /**
       * Devis en attente de chargement (ID temporaire)
       * @type {string|null}
       */
      pendingQuoteToLoad: null,

      /**
       * Logo de l'entreprise encodé en base64
       * @type {string|null}
       */
      companyLogoBase64: null,

      // ==========================================
      // GESTION DES DEVIS
      // ==========================================

      /**
       * ID du devis actuellement ouvert/édité
       * @type {string|null}
       */
      currentQuoteId: null,

      /**
       * Nom du devis actuellement ouvert
       * @type {string|null}
       */
      currentQuoteName: null,

      /**
       * Date de création du devis actuel
       * @type {string|null}
       */
      currentQuoteCreatedAt: null,

      /**
       * Statut du devis actuel (brouillon, envoyé, accepté, refusé)
       * @type {string}
       */
      currentQuoteStatus: 'brouillon',

      /**
       * Devis sélectionné pour changement de statut
       * @type {Quote|null}
       */
      currentQuoteForStatus: null,

      /**
       * Devis sélectionné pour transformation en facture
       * @type {Quote|null}
       */
      currentQuoteForInvoice: null,

      // ==========================================
      // GESTION DE LA FACTURATION
      // ==========================================

      /**
       * Facture sélectionnée pour marquage comme payée
       * @type {Invoice|null}
       */
      currentInvoiceForPayment: null,

      // ==========================================
      // DASHBOARD ET GRAPHIQUES
      // ==========================================

      /**
       * Instances des graphiques Chart.js du dashboard admin
       * @type {Object.&lt;string, Chart>}
       */
      adminDashboardCharts: {},

      // ==========================================
      // GESTION DU SCANNER CODE-BARRES
      // ==========================================

      /**
       * Flag indiquant si le scanner Quagga est initialisé
       * @type {boolean}
       */
      isScannerInitialized: false,

      // ==========================================
      // NAVIGATION ET AUTHENTIFICATION
      // ==========================================

      /**
       * Onglet actuellement actif dans l'interface
       * @type {string}
       */
      currentTab: 'search',

      /**
       * Instance du modal Bootstrap pour le mot de passe
       * @type {Object|null}
       */
      passwordModal: null,

      /**
       * ID du matériau en attente de suppression
       * @type {string|null}
       */
      materialToDeleteId: null,

      /**
       * Flag indiquant si le formulaire matériau est en mode édition
       * @type {boolean}
       */
      materialEditMode: false,

      // ==========================================
      // AUTHENTIFICATION ET SÉCURITÉ
      // ==========================================

      /**
       * Flag indiquant si l'utilisateur est authentifié pour cette session
       * @type {boolean}
       */
      isAuthenticatedThisSession: false,

      /**
       * Flag indiquant si l'utilisateur est en mode invité (lecture seule)
       * @type {boolean}
       */
      isGuestMode: false,

      /**
       * Token de session pour les opérations sécurisées
       * @type {string|null}
       */
      sessionToken: null,

      // ==========================================
      // ANALYTICS - TRACKING VENDEUR
      // ==========================================

      /**
       * Historique des recherches de matériaux (analytics vendeur)
       * @type {Array}
       */
      materialSearchHistory: []
    };

    /**
     * Map des listeners pour chaque clé de l'état
     * Structure : Map&lt;string, Set&lt;Function>>
     * @type {Map&lt;string, Set&lt;Function>>}
     * @private
     */
    this.listeners = new Map();

    /**
     * Historique des changements d'état (pour debugging)
     * Chaque entrée contient : timestamp, key, oldValue, newValue
     * @type {Array&lt;Object>}
     * @private
     */
    this.history = [];

    /**
     * Taille maximale de l'historique (FIFO)
     * @type {number}
     * @private
     */
    this.maxHistorySize = 100;

    /**
     * Flag pour activer/désactiver le logging détaillé
     * @type {boolean}
     * @private
     */
    this.debug = false;
  }

  /**
   * Récupère une valeur de l'état global
   *
   * @param {string} key - Clé de l'état à récupérer
   * @returns {*} Valeur associée à la clé, ou undefined si la clé n'existe pas
   *
   * @example
   * const materials = stateManager.get('materials');
   * console.log(materials.length); // Nombre de matériaux
   *
   * @example
   * const isAuthenticated = stateManager.get('isAuthenticatedThisSession');
   * if (isAuthenticated) {
   *   // Afficher les fonctionnalités admin
   * }
   */
  get(key) {
    if (!(key in this.state)) {
      console.warn(`[StateManager] Clé inconnue: ${key}`);
      return undefined;
    }
    return this.state[key];
  }

  /**
   * Définit une valeur dans l'état global et notifie tous les souscripteurs
   *
   * Workflow :
   * 1. Vérifie si la valeur a réellement changé (évite les notifications inutiles)
   * 2. Met à jour l'état
   * 3. Ajoute l'entrée à l'historique des changements
   * 4. Log si le mode debug est activé
   * 5. Notifie tous les callbacks souscrit à cette clé
   *
   * @param {string} key - Clé de l'état à modifier
   * @param {*} value - Nouvelle valeur
   *
   * @example
   * // Mise à jour simple
   * stateManager.set('currentTab', 'catalogue');
   *
   * @example
   * // Les souscripteurs sont automatiquement notifiés
   * stateManager.subscribe('materials', (newMaterials, oldMaterials) => {
   *   console.log(`Matériaux mis à jour: ${oldMaterials.length} → ${newMaterials.length}`);
   * });
   * stateManager.set('materials', newMaterialsList); // Déclenche le callback ci-dessus
   */
  set(key, value) {
    const oldValue = this.state[key];

    // Optimisation : éviter les mises à jour inutiles
    // Si la valeur n'a pas changé, on ne fait rien
    if (oldValue === value) {
      return;
    }

    // Mise à jour de l'état
    this.state[key] = value;

    // Ajouter à l'historique pour le debugging
    this.addToHistory(key, oldValue, value);

    // Logger en mode debug
    if (this.debug) {
      console.log(`[StateManager] ${key}:`, oldValue, '→', value);
    }

    // Notifier tous les souscripteurs de cette clé
    this.notify(key, value, oldValue);
  }

  /**
   * Met à jour plusieurs valeurs de l'état en une seule opération
   * Chaque clé déclenche sa propre notification aux souscripteurs
   *
   * @param {Object} updates - Objet contenant les clés et valeurs à mettre à jour
   *
   * @example
   * stateManager.setMultiple({
   *   currentQuoteId: '12345',
   *   currentQuoteName: 'Devis Rénovation',
   *   currentQuoteStatus: 'brouillon'
   * });
   */
  setMultiple(updates) {
    Object.keys(updates).forEach(key => {
      this.set(key, updates[key]);
    });
  }

  /**
   * Souscrit aux changements d'une clé spécifique de l'état
   * Le callback sera appelé à chaque fois que cette clé est modifiée via set()
   *
   * Pattern Observer : permet de réagir aux changements sans couplage direct
   *
   * @param {string} key - Clé de l'état à surveiller
   * @param {Function} callback - Fonction appelée lors du changement
   *                               Signature: callback(newValue, oldValue, key)
   * @returns {Function} Fonction de désinscription (à appeler pour arrêter d'écouter)
   *
   * @example
   * // Souscription avec désinscription automatique
   * const unsubscribe = stateManager.subscribe('materials', (newMaterials, oldMaterials) => {
   *   console.log(`Nombre de matériaux: ${oldMaterials.length} → ${newMaterials.length}`);
   *   updateUI(newMaterials);
   * });
   *
   * // Plus tard, arrêter d'écouter
   * unsubscribe();
   *
   * @example
   * // Surveiller l'authentification
   * stateManager.subscribe('isAuthenticatedThisSession', (isAuth) => {
   *   if (isAuth) {
   *     showAdminFeatures();
   *   } else {
   *     hideAdminFeatures();
   *   }
   * });
   */
  subscribe(key, callback) {
    // Créer le Set de listeners pour cette clé si inexistant
    if (!this.listeners.has(key)) {
      this.listeners.set(key, new Set());
    }

    // Ajouter le callback au Set
    this.listeners.get(key).add(callback);

    // Retourner une fonction de désinscription pour faciliter le cleanup
    return () => {
      this.unsubscribe(key, callback);
    };
  }

  /**
   * Se désabonne des changements d'une clé spécifique
   * Retire le callback de la liste des souscripteurs
   *
   * @param {string} key - Clé surveillée
   * @param {Function} callback - Fonction à retirer
   *
   * @example
   * const myCallback = (newValue) => console.log(newValue);
   * stateManager.subscribe('materials', myCallback);
   *
   * // Plus tard...
   * stateManager.unsubscribe('materials', myCallback);
   */
  unsubscribe(key, callback) {
    if (!this.listeners.has(key)) {
      return;
    }

    this.listeners.get(key).delete(callback);
  }

  /**
   * Notifie tous les souscripteurs d'un changement d'état
   * Appelé automatiquement par set() - ne devrait pas être appelé manuellement
   *
   * Gestion d'erreurs : si un callback plante, on log l'erreur mais on continue
   * à notifier les autres callbacks (isolation des erreurs)
   *
   * @param {string} key - Clé modifiée
   * @param {*} newValue - Nouvelle valeur
   * @param {*} oldValue - Ancienne valeur
   * @private
   */
  notify(key, newValue, oldValue) {
    if (!this.listeners.has(key)) {
      return;
    }

    // Appeler chaque callback avec try/catch pour isolation des erreurs
    this.listeners.get(key).forEach(callback => {
      try {
        callback(newValue, oldValue, key);
      } catch (error) {
        console.error(`[StateManager] Erreur dans le callback pour ${key}:`, error);
      }
    });
  }

  /**
   * Ajoute un changement à l'historique pour le debugging
   * Utilise un buffer circulaire (FIFO) de taille maxHistorySize
   *
   * @param {string} key - Clé modifiée
   * @param {*} oldValue - Ancienne valeur
   * @param {*} newValue - Nouvelle valeur
   * @private
   */
  addToHistory(key, oldValue, newValue) {
    this.history.push({
      timestamp: Date.now(),
      key,
      oldValue,
      newValue
    });

    // Limiter la taille de l'historique (buffer circulaire)
    if (this.history.length > this.maxHistorySize) {
      this.history.shift(); // Retirer le plus ancien
    }
  }

  /**
   * Récupère l'historique des changements d'état
   * Utile pour le debugging et l'audit
   *
   * @param {number} [limit=20] - Nombre d'entrées à retourner (les plus récentes)
   * @returns {Array&lt;Object>} Historique des changements
   *                          Format: [{timestamp, key, oldValue, newValue}, ...]
   *
   * @example
   * // Afficher les 10 derniers changements
   * const recent = stateManager.getHistory(10);
   * recent.forEach(entry => {
   *   console.log(`${new Date(entry.timestamp).toLocaleTimeString()} - ${entry.key}: ${entry.oldValue} → ${entry.newValue}`);
   * });
   *
   * @example
   * // Tracer les changements d'une clé spécifique
   * const materialChanges = stateManager.getHistory(50)
   *   .filter(entry => entry.key === 'materials');
   */
  getHistory(limit = 20) {
    return this.history.slice(-limit);
  }

  /**
   * Réinitialise une clé à sa valeur initiale (définie dans le constructeur)
   *
   * @param {string} key - Clé à réinitialiser
   *
   * @example
   * // Réinitialiser le devis en cours
   * stateManager.reset('currentQuoteId');
   * stateManager.reset('currentQuoteName');
   * stateManager.reset('quoteItems');
   */
  reset(key) {
    // Récupérer la valeur initiale depuis un StateManager temporaire
    const initialState = new StateManager().state;

    if (key in initialState) {
      this.set(key, initialState[key]);
    }
  }

  /**
   * Réinitialise tout l'état de l'application aux valeurs par défaut
   * Notifie tous les souscripteurs de chaque clé
   *
   * ⚠️ Attention : opération destructrice, à utiliser avec précaution
   *
   * @example
   * // Réinitialiser complètement l'application (par ex. lors de la déconnexion)
   * stateManager.resetAll();
   */
  resetAll() {
    const initialState = new StateManager().state;
    Object.keys(initialState).forEach(key => {
      this.set(key, initialState[key]);
    });
  }

  /**
   * Récupère une copie complète de l'état actuel
   * Retourne une copie shallow (surface) pour éviter les modifications accidentelles
   *
   * @returns {Object} Copie de l'état complet
   *
   * @example
   * // Inspecter l'état complet
   * console.table(stateManager.getAll());
   *
   * @example
   * // Sauvegarder l'état avant une opération risquée
   * const backup = stateManager.getAll();
   * // ... opération risquée ...
   * if (error) {
   *   stateManager.loadState(backup);
   * }
   */
  getAll() {
    return { ...this.state };
  }

  /**
   * Active ou désactive le mode debug
   * En mode debug, chaque changement d'état est loggé dans la console
   *
   * @param {boolean} enabled - true pour activer, false pour désactiver
   *
   * @example
   * // Activer le mode debug en développement
   * if (process.env.NODE_ENV === 'development') {
   *   stateManager.setDebug(true);
   * }
   */
  setDebug(enabled) {
    this.debug = enabled;
    console.log(`[StateManager] Mode debug: ${enabled ? 'ON' : 'OFF'}`);
  }

  /**
   * Obtient des statistiques sur l'état et le système de souscription
   * Utile pour le monitoring et le debugging
   *
   * @returns {Object} Statistiques
   * @returns {number} returns.totalKeys - Nombre total de clés dans l'état
   * @returns {number} returns.totalListeners - Nombre total de callbacks enregistrés
   * @returns {number} returns.historySize - Nombre d'entrées dans l'historique
   * @returns {Array&lt;string>} returns.keys - Liste de toutes les clés
   *
   * @example
   * const stats = stateManager.getStats();
   * console.log(`État: ${stats.totalKeys} clés, ${stats.totalListeners} listeners actifs`);
   */
  getStats() {
    return {
      totalKeys: Object.keys(this.state).length,
      totalListeners: Array.from(this.listeners.values()).reduce((sum, set) => sum + set.size, 0),
      historySize: this.history.length,
      keys: Object.keys(this.state)
    };
  }

  /**
   * Charge un état sauvegardé (restauration depuis localStorage ou fichier)
   * Seules les clés existantes dans l'état actuel sont restaurées
   * Chaque clé restaurée déclenche une notification aux souscripteurs
   *
   * @param {Object} savedState - État sauvegardé à restaurer
   *
   * @example
   * // Restaurer depuis localStorage
   * const saved = JSON.parse(localStorage.getItem('appState'));
   * if (saved) {
   *   stateManager.loadState(saved);
   * }
   *
   * @example
   * // Restaurer depuis un backup
   * const backup = await loadBackupFromServer();
   * stateManager.loadState(backup.state);
   */
  loadState(savedState) {
    Object.keys(savedState).forEach(key => {
      if (key in this.state) {
        this.set(key, savedState[key]);
      }
    });
  }

  /**
   * Sauvegarde l'état actuel pour persistance
   * Peut sauvegarder tout l'état ou seulement des clés spécifiques
   *
   * @param {Array&lt;string>|null} [keysToSave=null] - Clés spécifiques à sauvegarder,
   *                                                  ou null pour tout sauvegarder
   * @returns {Object} État à sauvegarder (peut être sérialisé en JSON)
   *
   * @example
   * // Sauvegarder tout l'état
   * const fullState = stateManager.saveState();
   * localStorage.setItem('appState', JSON.stringify(fullState));
   *
   * @example
   * // Sauvegarder seulement certaines clés (pour optimiser)
   * const essentialState = stateManager.saveState([
   *   'isAuthenticatedThisSession',
   *   'currentQuoteId',
   *   'appConfig'
   * ]);
   * await saveToServer(essentialState);
   */
  saveState(keysToSave = null) {
    // Si aucune clé spécifiée, sauvegarder tout
    if (!keysToSave) {
      return { ...this.state };
    }

    // Sinon, sauvegarder seulement les clés demandées
    const saved = {};
    keysToSave.forEach(key => {
      if (key in this.state) {
        saved[key] = this.state[key];
      }
    });
    return saved;
  }
}

// Export pour utilisation en module ES6
export default StateManager;
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
