

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> modules/scanner/ScannerModule.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Modules</h3><ul><li><a href="module-AboutModule.html">AboutModule</a></li><li><a href="module-AuthModule.html">AuthModule</a></li><li><a href="module-BackupModule.html">BackupModule</a></li><li><a href="module-ClientsModule.html">ClientsModule</a></li><li><a href="module-ConfigModule.html">ConfigModule</a></li><li><a href="module-DashboardModule.html">DashboardModule</a></li><li><a href="module-DataCache.html">DataCache</a></li><li><a href="module-ExportModule.html">ExportModule</a></li><li><a href="module-FECModule.html">FECModule</a></li><li><a href="module-FollowUpModule.html">FollowUpModule</a></li><li><a href="module-ImportModule.html">ImportModule</a></li><li><a href="module-InvoicesModule.html">InvoicesModule</a></li><li><a href="module-KeyboardShortcutsModule.html">KeyboardShortcutsModule</a></li><li><a href="module-Logger.html">Logger</a></li><li><a href="module-MLService.html">MLService</a></li><li><a href="module-MaterialsModule.html">MaterialsModule</a></li><li><a href="module-NotificationSystem.html">NotificationSystem</a></li><li><a href="module-NotificationSystemV2.html">NotificationSystemV2</a></li><li><a href="module-PDFModule.html">PDFModule</a></li><li><a href="module-QuickAddModule.html">QuickAddModule</a></li><li><a href="module-QuoteBuilderModule.html">QuoteBuilderModule</a></li><li><a href="module-QuotesModule.html">QuotesModule</a></li><li><a href="module-RevenueModule.html">RevenueModule</a></li><li><a href="module-ScannerModule.html">ScannerModule</a></li><li><a href="module-SuppliersModule.html">SuppliersModule</a></li><li><a href="module-TemplatesModule.html">TemplatesModule</a></li><li><a href="module-TourModule.html">TourModule</a></li><li><a href="module-UtilitiesModule.html">UtilitiesModule</a></li><li><a href="module-calculations.html">calculations</a></li><li><a href="module-constants.html">constants</a></li><li><a href="module-formatters.html">formatters</a></li><li><a href="module-helpers.html">helpers</a></li></ul><h3>Classes</h3><ul><li><a href="BaseModule.html">BaseModule</a></li><li><a href="BulkActionsManager.html">BulkActionsManager</a></li><li><a href="CacheKeys.html">CacheKeys</a></li><li><a href="EventBus.html">EventBus</a></li><li><a href="LoadingStateManager.html">LoadingStateManager</a></li><li><a href="ModalHelper.html">ModalHelper</a></li><li><a href="PaginationManager.html">PaginationManager</a></li><li><a href="ServerValidator.html">ServerValidator</a></li><li><a href="StateManager.html">StateManager</a></li><li><a href="TabRefreshManager.html">TabRefreshManager</a></li><li><a href="UndoRedoManager.html">UndoRedoManager</a></li><li><a href="module-AboutModule-AboutModule.html">AboutModule</a></li><li><a href="module-AuthModule-AuthModule.html">AuthModule</a></li><li><a href="module-BackupModule-BackupModule.html">BackupModule</a></li><li><a href="module-ClientsModule-ClientsModule.html">ClientsModule</a></li><li><a href="module-ConfigModule-ConfigModule.html">ConfigModule</a></li><li><a href="module-DashboardModule-DashboardModule.html">DashboardModule</a></li><li><a href="module-ExportModule-ExportModule.html">ExportModule</a></li><li><a href="module-FECModule-FECModule.html">FECModule</a></li><li><a href="module-ImportModule-ImportModule.html">ImportModule</a></li><li><a href="module-InvoicesModule-InvoicesModule.html">InvoicesModule</a></li><li><a href="module-Logger-Logger.html">Logger</a></li><li><a href="module-Logger-ModuleLogger.html">ModuleLogger</a></li><li><a href="module-MaterialsModule-MaterialsModule.html">MaterialsModule</a></li><li><a href="module-PDFModule-PDFModule.html">PDFModule</a></li><li><a href="module-QuickAddModule-QuickAddModule.html">QuickAddModule</a></li><li><a href="module-QuoteBuilderModule-QuoteBuilderModule.html">QuoteBuilderModule</a></li><li><a href="module-QuotesModule-QuotesModule.html">QuotesModule</a></li><li><a href="module-RevenueModule-RevenueModule.html">RevenueModule</a></li><li><a href="module-ScannerModule-ScannerModule.html">ScannerModule</a></li><li><a href="module-SuppliersModule-SuppliersModule.html">SuppliersModule</a></li><li><a href="module-TemplatesModule-TemplatesModule.html">TemplatesModule</a></li><li><a href="module-UtilitiesModule-UtilitiesModule.html">UtilitiesModule</a></li></ul><h3>Global</h3><ul><li><a href="global.html#clear">clear</a></li><li><a href="global.html#crypto">crypto</a></li><li><a href="global.html#emit">emit</a></li><li><a href="global.html#emitSync">emitSync</a></li><li><a href="global.html#off">off</a></li><li><a href="global.html#on">on</a></li><li><a href="global.html#once">once</a></li><li><a href="global.html#validateBeforeAddToQuote">validateBeforeAddToQuote</a></li><li><a href="global.html#validateBeforeExport">validateBeforeExport</a></li><li><a href="global.html#validateBeforeSaveMaterial">validateBeforeSaveMaterial</a></li><li><a href="global.html#validateBeforeSendEmail">validateBeforeSendEmail</a></li><li><a href="global.html#validateHeaderConfig">validateHeaderConfig</a></li><li><a href="global.html#validatePasswordChange">validatePasswordChange</a></li><li><a href="global.html#validateSMTPConfig">validateSMTPConfig</a></li><li><a href="global.html#waitFor">waitFor</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>modules/scanner/ScannerModule.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * ========================================
 * SCANNER MODULE - Scanner de codes-barres
 * ========================================
 *
 * Module de gestion du scanner de codes-barres pour AutoCalc OptiDevis.
 * Permet de scanner les codes-barres des matériaux pour accélérer la recherche
 * et l'ajout de produits au catalogue ou aux devis.
 *
 * Architecture :
 * Le module gère un scanner de codes-barres avec :
 * - **Bibliothèque Quagga** : Scanner JavaScript open-source pour codes-barres
 * - **Accès caméra** : navigator.mediaDevices.getUserMedia (WebRTC)
 * - **Détection automatique** : Reconnaissance multi-formats (EAN, UPC, Code 39, Code 128)
 * - **Intégration recherche** : Remplissage auto du champ de recherche matériaux
 * - **Gestion flux vidéo** : Démarrage, arrêt et libération propre des ressources
 *
 * ==========================================
 * CAS D'USAGE TYPIQUES
 * ==========================================
 *
 * **Exemple 1 : Ajout rapide de matériau au devis** :
 * - Vendeur clique bouton "Scanner code-barres"
 * - Scanner démarre avec caméra arrière (facingMode: environment)
 * - Vendeur pointe le produit avec code-barres EAN-13
 * - Détection automatique en ~1 seconde
 * - Code-barres rempli dans champ de recherche
 * - Recherche automatique déclenchée
 * - Scanner s'arrête automatiquement
 * - Vendeur sélectionne le matériau trouvé et l'ajoute au devis
 *
 * **Exemple 2 : Inventaire des produits** :
 * - Admin scanne plusieurs produits pour vérifier leur présence
 * - Chaque scan remplit la recherche et affiche le produit
 * - Permet de valider rapidement la concordance code-barres / produit
 *
 * ==========================================
 * BIBLIOTHÈQUE QUAGGA
 * ==========================================
 *
 * **Qu'est-ce que Quagga ?** :
 * - Bibliothèque JavaScript open-source pour scanner codes-barres
 * - Fonctionne dans le navigateur (pas besoin d'app native)
 * - Utilise WebRTC pour accès caméra
 * - Supporte 5+ formats de codes-barres
 * - GitHub : https://github.com/serratus/quaggaJS
 *
 * **Formats supportés** :
 * - EAN-13 : Codes-barres européens (13 chiffres) - ex: 3760123456789
 * - EAN-8 : Version courte (8 chiffres)
 * - UPC : Codes-barres américains (Universal Product Code)
 * - Code 39 : Format alphanumérique (utilisé industrie)
 * - Code 128 : Format haute densité (logistique, transport)
 *
 * **Configuration Quagga** :
 * - inputStream : Configuration de la caméra (résolution 640x480, facingMode: environment)
 * - decoder.readers : Liste des formats à reconnaître
 * - target : Élément &lt;video> où afficher le flux
 * - callbacks : onDetected() appelé lors de détection réussie
 *
 * ==========================================
 * WORKFLOW COMPLET - SCAN DE CODE-BARRES
 * ==========================================
 *
 * **Phase 1 : Démarrage** (startScanner)
 * 1. Utilisateur clique bouton "Scanner code-barres"
 * 2. Récupération éléments DOM (#scanner-container, #scanner-video)
 * 3. Demande accès caméra via navigator.mediaDevices.getUserMedia :
 *    - video: { facingMode: 'environment' } (caméra arrière)
 *    - Si refusé → error "Accès à la webcam refusé ou indisponible"
 * 4. Si accordé :
 *    - Flux vidéo assigné à scannerVideo.srcObject
 *    - scannerVideo.play() pour démarrer lecture
 * 5. Affichage conteneur scanner (#scanner-container) avec display: flex
 * 6. Vérification présence window.Quagga (bibliothèque chargée)
 * 7. Initialisation Quagga.init() avec configuration :
 *    - inputStream : Live, LiveStream, résolution 640x480
 *    - decoder : 5 readers (EAN, UPC, Code 39, Code 128)
 *    - target : scannerVideo
 * 8. Si erreur init → stopScanner() + error
 * 9. Si succès :
 *    - Quagga.start() pour commencer le scan
 *    - this.isInitialized = true
 *    - NotificationSystem.success "Scanner démarré"
 * 10. Configuration callback Quagga.onDetected() :
 *     - Appelé automatiquement lors de détection d'un code-barres
 *
 * **Phase 2 : Détection** (Quagga.onDetected callback)
 * 11. Code-barres détecté automatiquement par Quagga
 * 12. Extraction du code : data.codeResult.code
 * 13. Remplissage champ de recherche (#search-input) avec le code
 * 14. Déclenchement recherche automatique :
 *     - Appelle window.debouncedSearchMaterial() (MaterialsModule)
 *     - Recherche le matériau avec ce code-barres dans le catalogue
 * 15. Arrêt automatique du scanner (stopScanner)
 * 16. Émission événement 'barcode-detected' avec { code }
 *
 * **Phase 3 : Arrêt** (stopScanner)
 * 17. Arrêt Quagga : Quagga.stop()
 * 18. Arrêt flux vidéo :
 *     - scannerVideo.srcObject.getTracks().forEach(track => track.stop())
 *     - Libère la caméra (important pour permission)
 *     - scannerVideo.srcObject = null
 * 19. Masquage conteneur scanner (#scanner-container) avec display: none
 * 20. Émission événement 'scanner-stopped'
 * 21. NotificationSystem.success "Scanner arrêté"
 *
 * ==========================================
 * ÉLÉMENTS DOM
 * ==========================================
 *
 * **Conteneur principal** (#scanner-container) :
 * - Display : flex (visible) / none (masqué)
 * - Position : Overlay fullscreen recommandé
 * - Contenu : Élément &lt;video> + bouton "Arrêter"
 *
 * **Élément vidéo** (#scanner-video) :
 * - Tag &lt;video> natif HTML5
 * - srcObject : MediaStream de la caméra
 * - Résolution : 640x480 (configuré dans Quagga)
 * - Autoplay : Oui (via scannerVideo.play())
 *
 * **Champ de recherche** (#search-input) :
 * - Input text de MaterialsModule
 * - Rempli automatiquement avec le code-barres détecté
 * - Déclenche la recherche via debouncedSearchMaterial()
 *
 * ==========================================
 * GESTION DES PERMISSIONS CAMÉRA
 * ==========================================
 *
 * **Demande de permission** :
 * - navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
 * - Affiche popup native du navigateur "Autoriser l'accès à la caméra ?"
 * - facingMode: 'environment' = Caméra arrière (smartphones)
 * - facingMode: 'user' = Caméra avant (selfie)
 *
 * **Gestion du refus** :
 * - Si utilisateur refuse → catch error
 * - NotificationSystem.error "Accès à la webcam refusé ou indisponible"
 * - Scanner ne démarre pas
 *
 * **Libération de la caméra** :
 * - IMPORTANT : Appeler track.stop() sur tous les tracks du MediaStream
 * - Sinon : Caméra reste active (LED allumée, consommation batterie)
 * - stopScanner() libère proprement avec getTracks().forEach(track => track.stop())
 *
 * ==========================================
 * ÉVÉNEMENTS ÉMIS
 * ==========================================
 *
 * **EventBus interne** :
 * - 'barcode-detected' : Après détection réussie (avec { code })
 * - 'scanner-stopped' : Après arrêt du scanner
 *
 * **Utilité** :
 * - Autres modules peuvent écouter 'barcode-detected' pour réagir au scan
 * - Ex: LogModule peut logger tous les scans effectués
 *
 * ==========================================
 * INTÉGRATIONS
 * ==========================================
 *
 * - **MaterialsModule** : Utilise window.debouncedSearchMaterial() pour recherche auto
 * - **MaterialsModule** : Remplit #search-input avec le code scanné
 * - **Quagga.js** : Bibliothèque externe (chargée via CDN ou bundle)
 * - **WebRTC API** : navigator.mediaDevices.getUserMedia pour accès caméra
 * - **NotificationSystem** : Feedback utilisateur (success, error)
 *
 * ==========================================
 * ÉTAT DU MODULE
 * ==========================================
 *
 * **this.isInitialized** :
 * - Boolean : Scanner Quagga initialisé et actif
 * - true : Scanner en cours (Quagga.start() appelé)
 * - false : Scanner arrêté ou jamais démarré
 * - Utilisé dans stopScanner() pour éviter double-arrêt
 *
 * ==========================================
 * SÉCURITÉ &amp; BONNES PRATIQUES
 * ==========================================
 *
 * **Libération des ressources** :
 * - Toujours arrêter le flux vidéo via track.stop()
 * - Éviter les fuites mémoire avec srcObject = null
 * - destroy() appelle stopScanner() pour cleanup complet
 *
 * **Gestion des erreurs** :
 * - Try/catch autour de getUserMedia (permission refusée)
 * - Try/catch autour de Quagga.init (bibliothèque non chargée)
 * - Arrêt automatique en cas d'erreur (stopScanner)
 *
 * **Performance** :
 * - Arrêt automatique après détection (évite scan continu inutile)
 * - Résolution 640x480 (bon compromis qualité/performance)
 * - Seulement 5 readers activés (pas tous les formats Quagga)
 *
 * @module ScannerModule
 * @extends BaseModule
 * @version 2.0.0
 * @author AutoCalc OptiDevis
 */

import BaseModule from '../../core/BaseModule.js';
import NotificationSystem from '../../shared/ui/NotificationSystem.js';

class ScannerModule extends BaseModule {
  /**
   * Crée une instance du module Scanner.
   *
   * @param {StateManager} state - Gestionnaire d'état global
   * @param {EventBus} eventBus - Bus d'événements
   */
  constructor(state, eventBus) {
    super('scanner', state, eventBus);

    /**
     * État d'initialisation du scanner Quagga.
     * true = Scanner actif et en cours d'exécution.
     * false = Scanner arrêté ou jamais démarré.
     *
     * @type {boolean}
     * @private
     */
    this.isInitialized = false;

    this.log('ScannerModule instantiated');
  }

  /**
   * Initialise le module Scanner.
   * Expose les fonctions globales pour compatibilité.
   *
   * @async
   * @returns {Promise&lt;void>}
   * @throws {Error} Si l'initialisation échoue
   *
   * @example
   * const scannerModule = new ScannerModule(state, eventBus);
   * await scannerModule.init();
   * // Fonctions globales exposées : startScanner, stopScanner
   */
  async init() {
    try {
      this.log('Initializing ScannerModule...');

      // Exposer les fonctions au scope global
      this.exposeToGlobal({
        startScanner: this.startScanner,
        stopScanner: this.stopScanner
      });

      this.initialized = true;
      this.log('ScannerModule initialized successfully');

    } catch (error) {
      this.error('Error initializing ScannerModule:', error);
      throw error;
    }
  }

  // ==========================================
  // GESTION DU SCANNER
  // ==========================================

  /**
   * Démarre le scanner de codes-barres avec accès caméra et initialisation Quagga.
   * Demande permission caméra, configure le flux vidéo et active la détection de codes-barres.
   *
   * Workflow complet : Voir en-tête du module "WORKFLOW COMPLET - SCAN DE CODE-BARRES"
   *
   * Étapes principales :
   * 1. Récupère #scanner-container et #scanner-video (si absent → error)
   * 2. Demande accès caméra navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
   * 3. Si refusé → NotificationSystem.error + return
   * 4. Si accordé :
   *    - Assigne flux à scannerVideo.srcObject
   *    - Démarre lecture scannerVideo.play()
   *    - Affiche conteneur scanner (display: flex)
   * 5. Vérifie présence window.Quagga (sinon error "Bibliothèque Quagga non chargée")
   * 6. Initialise Quagga.init() avec config :
   *    - inputStream : Live, LiveStream, 640x480, facingMode: environment
   *    - decoder.readers : 5 formats (EAN-13, EAN-8, UPC, Code 39, Code 128)
   *    - target : scannerVideo
   * 7. Si erreur init → stopScanner() + error
   * 8. Si succès :
   *    - Quagga.start()
   *    - this.isInitialized = true
   *    - NotificationSystem.success "Scanner démarré"
   * 9. Configure callback Quagga.onDetected() :
   *    - Extrait code-barres : data.codeResult.code
   *    - Remplit #search-input avec le code
   *    - Déclenche window.debouncedSearchMaterial() (MaterialsModule)
   *    - Arrête scanner automatiquement (stopScanner)
   *    - Émet événement 'barcode-detected' avec { code }
   *
   * Formats de codes-barres supportés :
   * - EAN-13 : Codes européens 13 chiffres (ex: 3760123456789)
   * - EAN-8 : Codes européens 8 chiffres
   * - UPC : Codes américains (Universal Product Code)
   * - Code 39 : Format alphanumérique industrie
   * - Code 128 : Format haute densité logistique
   *
   * Permissions caméra :
   * - facingMode: 'environment' = Caméra arrière (smartphones)
   * - Popup navigateur "Autoriser l'accès à la caméra ?"
   * - Si refusé : Scanner ne démarre pas
   *
   * @public
   * @async
   * @returns {Promise&lt;void>}
   * @fires NotificationSystem#error Si DOM absent, permission refusée ou Quagga non chargé
   * @fires NotificationSystem#success Si scanner démarré avec succès
   * @fires EventBus#barcode-detected Lors de détection réussie d'un code-barres (avec { code })
   *
   * @example
   * // Utilisateur clique "Scanner code-barres"
   * await startScanner();
   * // → Popup permission caméra
   * // → Si accepté : Flux vidéo s'affiche
   * // → Scanner actif, détection automatique en cours
   * // → "Scanner démarré"
   */
  async startScanner() {
    this.log('startScanner called');

    try {
      // Récupérer les éléments DOM
      const scannerContainer = this.getElement('#scanner-container');
      const scannerVideo = this.getElement('#scanner-video');

      if (!scannerContainer || !scannerVideo) {
        this.error('Scanner container or video element not found');
        NotificationSystem.error('Conteneur du scanner ou élément vidéo non trouvé');
        return;
      }

      // Demander l'accès à la caméra en premier
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: 'environment' }
        });
        scannerVideo.srcObject = stream;
        await scannerVideo.play();
        this.log('Camera stream initialized');
      } catch (error) {
        this.error('Error accessing webcam:', error);
        NotificationSystem.error('Accès à la webcam refusé ou indisponible');
        return;
      }

      // Afficher le conteneur du scanner après initialisation de la caméra
      scannerContainer.style.display = 'flex';

      // Initialiser Quagga
      try {
        if (!window.Quagga) {
          throw new Error('Bibliothèque Quagga non chargée');
        }

        await window.Quagga.init({
          inputStream: {
            name: 'Live',
            type: 'LiveStream',
            target: scannerVideo,
            constraints: {
              width: 640,
              height: 480,
              facingMode: 'environment'
            }
          },
          decoder: {
            readers: [
              'code_128_reader',
              'ean_reader',
              'ean_8_reader',
              'code_39_reader',
              'upc_reader'
            ]
          }
        }, (err) => {
          if (err) {
            this.error('Error initializing Quagga:', err);
            NotificationSystem.error(`Erreur d'initialisation du scanner: ${err.message}`);
            this.stopScanner();
            return;
          }

          window.Quagga.start();
          this.isInitialized = true;
          this.log('Scanner started successfully');
          NotificationSystem.success('Scanner démarré');
        });

        // Configurer le détecteur de codes-barres
        window.Quagga.onDetected((data) => {
          const code = data.codeResult.code;
          this.log('Barcode detected:', code);

          // Remplir le champ de recherche avec le code détecté
          const searchInput = this.getElement('#search-input');
          if (searchInput) {
            searchInput.value = code;

            // Déclencher la recherche
            if (typeof window.debouncedSearchMaterial === 'function') {
              window.debouncedSearchMaterial();
            }
          }

          // Arrêter le scanner après détection
          this.stopScanner();

          // Émettre un événement
          this.emitEvent('barcode-detected', { code });
        });

      } catch (error) {
        this.error('Error starting scanner:', error);
        NotificationSystem.error(`Erreur lors du démarrage du scanner: ${error.message}`);
        this.stopScanner();
      }

    } catch (error) {
      this.error('Error in startScanner:', error);
      NotificationSystem.error(`Erreur: ${error.message}`);
    }
  }

  /**
   * Arrête le scanner de codes-barres et libère toutes les ressources.
   * Arrête Quagga, libère le flux vidéo de la caméra et masque le conteneur scanner.
   *
   * Workflow :
   * 1. Si this.isInitialized &amp;&amp; window.Quagga :
   *    - Appelle Quagga.stop()
   *    - Met this.isInitialized = false
   *    - NotificationSystem.success "Scanner arrêté"
   * 2. Récupère scannerVideo (#scanner-video)
   * 3. Si scannerVideo.srcObject existe :
   *    - Appelle track.stop() sur tous les tracks du MediaStream
   *    - IMPORTANT : Libère la caméra (sinon LED reste allumée)
   *    - Met scannerVideo.srcObject = null (évite fuite mémoire)
   * 4. Récupère scannerContainer (#scanner-container)
   * 5. Masque le conteneur : scannerContainer.style.display = 'none'
   * 6. Émet événement 'scanner-stopped'
   *
   * Libération ressources :
   * - track.stop() : Libère caméra (coupe LED, économie batterie)
   * - srcObject = null : Évite fuite mémoire du MediaStream
   * - display = 'none' : Masque UI du scanner
   *
   * Quand appelé :
   * - Manuellement par utilisateur (bouton "Arrêter")
   * - Automatiquement après détection d'un code-barres
   * - Par destroy() lors de la destruction du module
   * - En cas d'erreur durant startScanner()
   *
   * @public
   * @returns {void}
   * @fires NotificationSystem#success Si scanner arrêté avec succès
   * @fires NotificationSystem#error Si conteneur scanner non trouvé
   * @fires EventBus#scanner-stopped Après arrêt complet du scanner
   *
   * @example
   * // Utilisateur clique "Arrêter le scanner"
   * stopScanner();
   * // → Quagga arrêté
   * // → Flux vidéo libéré (caméra éteinte)
   * // → Conteneur masqué
   * // → "Scanner arrêté"
   */
  stopScanner() {
    this.log('stopScanner called');

    try {
      // Arrêter Quagga
      if (this.isInitialized &amp;&amp; window.Quagga) {
        window.Quagga.stop();
        this.isInitialized = false;
        this.log('Quagga stopped');
        NotificationSystem.success('Scanner arrêté');
      }

      // Arrêter le flux vidéo manuellement
      const scannerVideo = this.getElement('#scanner-video');
      if (scannerVideo &amp;&amp; scannerVideo.srcObject) {
        scannerVideo.srcObject.getTracks().forEach(track => track.stop());
        scannerVideo.srcObject = null;
        this.log('Video stream stopped manually');
      }

      // Masquer le conteneur du scanner
      const scannerContainer = this.getElement('#scanner-container');
      if (scannerContainer) {
        scannerContainer.style.display = 'none';
        this.log('Scanner container hidden');
      } else {
        this.error('Scanner container not found in stopScanner');
        NotificationSystem.error('Conteneur du scanner non trouvé');
      }

      this.emitEvent('scanner-stopped');

    } catch (error) {
      this.error('Error stopping scanner:', error);
      NotificationSystem.error(`Erreur lors de l'arrêt du scanner: ${error.message}`);
    }
  }

  /**
   * Détruit le module Scanner et nettoie toutes les ressources.
   * Appelé lors de la destruction du module (fermeture app, changement de page).
   *
   * Workflow :
   * 1. Appelle stopScanner() pour arrêter le scanner et libérer caméra
   * 2. Appelle super.destroy() pour cleanup BaseModule
   *
   * Garantit :
   * - Pas de fuite mémoire (MediaStream libéré)
   * - Pas de caméra active en arrière-plan (track.stop())
   * - Cleanup complet des event listeners (via BaseModule)
   *
   * @public
   * @returns {void}
   *
   * @example
   * // Fermeture de l'application
   * scannerModule.destroy();
   * // → Scanner arrêté si actif
   * // → Caméra libérée
   * // → Ressources nettoyées
   */
  destroy() {
    this.stopScanner();
    super.destroy();
  }
}

export default ScannerModule;
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
