

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> modules/tour/TourModule.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Modules</h3><ul><li><a href="module-AboutModule.html">AboutModule</a></li><li><a href="module-AuthModule.html">AuthModule</a></li><li><a href="module-BackupModule.html">BackupModule</a></li><li><a href="module-ClientsModule.html">ClientsModule</a></li><li><a href="module-ConfigModule.html">ConfigModule</a></li><li><a href="module-DashboardModule.html">DashboardModule</a></li><li><a href="module-DataCache.html">DataCache</a></li><li><a href="module-ExportModule.html">ExportModule</a></li><li><a href="module-FECModule.html">FECModule</a></li><li><a href="module-FollowUpModule.html">FollowUpModule</a></li><li><a href="module-ImportModule.html">ImportModule</a></li><li><a href="module-InvoicesModule.html">InvoicesModule</a></li><li><a href="module-KeyboardShortcutsModule.html">KeyboardShortcutsModule</a></li><li><a href="module-Logger.html">Logger</a></li><li><a href="module-MLService.html">MLService</a></li><li><a href="module-MaterialsModule.html">MaterialsModule</a></li><li><a href="module-NotificationSystem.html">NotificationSystem</a></li><li><a href="module-NotificationSystemV2.html">NotificationSystemV2</a></li><li><a href="module-PDFModule.html">PDFModule</a></li><li><a href="module-QuickAddModule.html">QuickAddModule</a></li><li><a href="module-QuoteBuilderModule.html">QuoteBuilderModule</a></li><li><a href="module-QuotesModule.html">QuotesModule</a></li><li><a href="module-RevenueModule.html">RevenueModule</a></li><li><a href="module-ScannerModule.html">ScannerModule</a></li><li><a href="module-SuppliersModule.html">SuppliersModule</a></li><li><a href="module-TemplatesModule.html">TemplatesModule</a></li><li><a href="module-TourModule.html">TourModule</a></li><li><a href="module-UtilitiesModule.html">UtilitiesModule</a></li><li><a href="module-calculations.html">calculations</a></li><li><a href="module-constants.html">constants</a></li><li><a href="module-formatters.html">formatters</a></li><li><a href="module-helpers.html">helpers</a></li></ul><h3>Classes</h3><ul><li><a href="BaseModule.html">BaseModule</a></li><li><a href="BulkActionsManager.html">BulkActionsManager</a></li><li><a href="CacheKeys.html">CacheKeys</a></li><li><a href="EventBus.html">EventBus</a></li><li><a href="LoadingStateManager.html">LoadingStateManager</a></li><li><a href="ModalHelper.html">ModalHelper</a></li><li><a href="PaginationManager.html">PaginationManager</a></li><li><a href="ServerValidator.html">ServerValidator</a></li><li><a href="StateManager.html">StateManager</a></li><li><a href="TabRefreshManager.html">TabRefreshManager</a></li><li><a href="UndoRedoManager.html">UndoRedoManager</a></li><li><a href="module-AboutModule-AboutModule.html">AboutModule</a></li><li><a href="module-AuthModule-AuthModule.html">AuthModule</a></li><li><a href="module-BackupModule-BackupModule.html">BackupModule</a></li><li><a href="module-ClientsModule-ClientsModule.html">ClientsModule</a></li><li><a href="module-ConfigModule-ConfigModule.html">ConfigModule</a></li><li><a href="module-DashboardModule-DashboardModule.html">DashboardModule</a></li><li><a href="module-ExportModule-ExportModule.html">ExportModule</a></li><li><a href="module-FECModule-FECModule.html">FECModule</a></li><li><a href="module-ImportModule-ImportModule.html">ImportModule</a></li><li><a href="module-InvoicesModule-InvoicesModule.html">InvoicesModule</a></li><li><a href="module-Logger-Logger.html">Logger</a></li><li><a href="module-Logger-ModuleLogger.html">ModuleLogger</a></li><li><a href="module-MaterialsModule-MaterialsModule.html">MaterialsModule</a></li><li><a href="module-PDFModule-PDFModule.html">PDFModule</a></li><li><a href="module-QuickAddModule-QuickAddModule.html">QuickAddModule</a></li><li><a href="module-QuoteBuilderModule-QuoteBuilderModule.html">QuoteBuilderModule</a></li><li><a href="module-QuotesModule-QuotesModule.html">QuotesModule</a></li><li><a href="module-RevenueModule-RevenueModule.html">RevenueModule</a></li><li><a href="module-ScannerModule-ScannerModule.html">ScannerModule</a></li><li><a href="module-SuppliersModule-SuppliersModule.html">SuppliersModule</a></li><li><a href="module-TemplatesModule-TemplatesModule.html">TemplatesModule</a></li><li><a href="module-UtilitiesModule-UtilitiesModule.html">UtilitiesModule</a></li></ul><h3>Global</h3><ul><li><a href="global.html#clear">clear</a></li><li><a href="global.html#crypto">crypto</a></li><li><a href="global.html#emit">emit</a></li><li><a href="global.html#emitSync">emitSync</a></li><li><a href="global.html#off">off</a></li><li><a href="global.html#on">on</a></li><li><a href="global.html#once">once</a></li><li><a href="global.html#validateBeforeAddToQuote">validateBeforeAddToQuote</a></li><li><a href="global.html#validateBeforeExport">validateBeforeExport</a></li><li><a href="global.html#validateBeforeSaveMaterial">validateBeforeSaveMaterial</a></li><li><a href="global.html#validateBeforeSendEmail">validateBeforeSendEmail</a></li><li><a href="global.html#validateHeaderConfig">validateHeaderConfig</a></li><li><a href="global.html#validatePasswordChange">validatePasswordChange</a></li><li><a href="global.html#validateSMTPConfig">validateSMTPConfig</a></li><li><a href="global.html#waitFor">waitFor</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>modules/tour/TourModule.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * ========================================
 * TOUR MODULE - Tour guidÃ© pour nouveaux utilisateurs
 * ========================================
 *
 * Module de tour guidÃ© interactif pour AutoCalc OptiDevis.
 * Permet aux nouveaux utilisateurs de dÃ©couvrir l'application Ã©tape par Ã©tape
 * avec des bulles d'aide contextuelles et une progression sauvegardÃ©e.
 *
 * Architecture :
 * - **Tours thÃ©matiques** : Tour gÃ©nÃ©ral, tour devis, tour factures, etc.
 * - **Bulles contextuelles** : Pointent vers les Ã©lÃ©ments UI avec explications
 * - **Navigation** : Boutons PrÃ©cÃ©dent/Suivant/Terminer
 * - **Progression** : Sauvegarde de l'Ã©tat pour reprendre plus tard
 * - **Mode interactif** : L'utilisateur peut tester pendant le tour
 *
 * Workflow :
 * 1. DÃ©tection nouveau utilisateur â†’ Proposition tour automatique
 * 2. SÃ©lection du tour (gÃ©nÃ©ral, devis, etc.)
 * 3. Navigation Ã©tape par Ã©tape avec bulles
 * 4. Actions guidÃ©es (cliquer, saisir, etc.)
 * 5. Fin du tour â†’ Badge "Tour complÃ©tÃ©"
 *
 * @module TourModule
 * @extends BaseModule
 * @version 1.0.0
 */

import BaseModule from '../../core/BaseModule.js';
import NotificationSystem from '../../shared/ui/NotificationSystem.js';
import { TextFormatter } from '../../shared/utils/formatters.js';

class TourModule extends BaseModule {
  constructor(state, eventBus) {
    super('tour', state, eventBus);

    // Ã‰tat du tour
    this.currentTour = null;
    this.currentStep = 0;
    this.tourActive = false;
    this.completedTours = this.loadCompletedTours();

    // Overlay et Ã©lÃ©ments UI
    this.overlay = null;
    this.tooltip = null;

    // Tours disponibles
    this.tours = this.defineTours();

    this.log('TourModule v1.0 - Initialization');
  }

  /**
   * Initialise le module de tour guidÃ©
   */
  async init() {
    this.log('Initializing TourModule...');

    // CrÃ©er les Ã©lÃ©ments UI
    this.createOverlay();
    this.createTooltip();

    // Exposer les fonctions
    this.exposeToGlobal();

    // VÃ©rifier si c'est un nouveau utilisateur
    this.checkFirstTime();

    // Ajouter bouton d'aide dans l'interface
    this.addHelpButton();

    this.log('âœ“ TourModule initialized');
  }

  /**
   * Expose les fonctions au scope global
   */
  exposeToGlobal() {
    window.tourModule = this;
    window.startTour = (tourName) => this.startTour(tourName);
    window.stopTour = () => this.stopTour();
    window.nextStep = () => this.nextStep();
    window.prevStep = () => this.prevStep();
  }

  /**
   * DÃ©finit tous les tours disponibles
   */
  defineTours() {
    return {
      general: {
        name: 'Tour GÃ©nÃ©ral',
        description: 'DÃ©couvrez toutes les fonctionnalitÃ©s',
        steps: [
          {
            element: null,
            title: 'Bienvenue dans AutoCalc OptiDevis !',
            content: 'Je vais vous guider Ã  travers toutes les fonctionnalitÃ©s de l\'application. Ce tour complet vous montrera comment tirer le meilleur parti du logiciel. Cliquez sur "Suivant" pour commencer.',
            position: 'center'
          },
          {
            element: '#accueil-tab',
            title: 'ðŸ“Š Tableau de Bord',
            content: 'Votre espace de travail principal ! Consultez vos KPIs : devis en attente, crÃ©ations de la semaine, et vos articles les plus recherchÃ©s.',
            position: 'bottom',
            action: () => document.getElementById('accueil-tab')?.click()
          },
          {
            element: '#search-tab',
            title: 'ðŸ” Recherche de MatÃ©riaux',
            content: 'Recherchez rapidement parmi tous vos matÃ©riaux. Utilisez les filtres par type, fournisseur, ou prix pour affiner vos rÃ©sultats.',
            position: 'bottom',
            action: () => document.getElementById('search-tab')?.click()
          },
          {
            element: '#new-quote-tab',
            title: 'ðŸ“ Nouveau Devis',
            content: 'CrÃ©ez vos devis ici ! SÃ©lectionnez un client, ajoutez des matÃ©riaux, et gÃ©nÃ©rez automatiquement un PDF professionnel.',
            position: 'bottom',
            action: () => document.getElementById('new-quote-tab')?.click()
          },
          {
            element: '#quotes-tab',
            title: 'ðŸ“‹ Gestion des Devis',
            content: 'Consultez tous vos devis : en attente, acceptÃ©s, refusÃ©s. Convertissez-les en factures d\'un clic !',
            position: 'bottom',
            action: () => document.getElementById('quotes-tab')?.click()
          },
          {
            element: '#invoices-tab',
            title: 'ðŸ’° Factures',
            content: 'GÃ©rez vos factures, suivez les paiements, et gÃ©nÃ©rez vos PDF de facturation.',
            position: 'bottom',
            action: () => document.getElementById('invoices-tab')?.click()
          },
          {
            element: '#revenue-tab',
            title: 'ðŸ“ˆ CA du Mois',
            content: 'Suivez votre chiffre d\'affaires mensuel, analysez votre rentabilitÃ© et vos performances commerciales.',
            position: 'bottom',
            action: () => document.getElementById('revenue-tab')?.click()
          },
          {
            element: '#admin-tab',
            title: 'ðŸ“¦ Catalogue MatÃ©riaux',
            content: 'GÃ©rez votre catalogue : ajoutez, modifiez, supprimez des matÃ©riaux. Importez vos donnÃ©es depuis Excel !',
            position: 'bottom',
            action: () => document.getElementById('admin-tab')?.click()
          },
          {
            element: '#suppliers-tab',
            title: 'ðŸ­ Fournisseurs',
            content: 'GÃ©rez vos fournisseurs : coordonnÃ©es, conditions commerciales, et catalogue associÃ©.',
            position: 'bottom',
            action: () => document.getElementById('suppliers-tab')?.click()
          },
          {
            element: '#clients-tab',
            title: 'ðŸ‘¥ Clients',
            content: 'Base de donnÃ©es clients complÃ¨te : coordonnÃ©es, historique des devis et factures.',
            position: 'bottom',
            action: () => document.getElementById('clients-tab')?.click()
          },
          {
            element: '#templates-tab',
            title: 'ðŸ“‘ Templates de Devis',
            content: 'CrÃ©ez des modÃ¨les de devis rÃ©utilisables pour vos prestations courantes. Gagnez du temps !',
            position: 'bottom',
            action: () => document.getElementById('templates-tab')?.click()
          },
          {
            element: '#config-tab',
            title: 'âš™ï¸ Configuration',
            content: 'Personnalisez l\'application : thÃ¨me, logo, informations sociÃ©tÃ©, SMTP, relances automatiques...',
            position: 'bottom',
            action: () => document.getElementById('config-tab')?.click()
          },
          {
            element: '#quickAddInput',
            title: 'âš¡ Ajout Rapide (Quick Add)',
            content: 'Tapez en langage naturel : "10 m2 carrelage" ou "5 sacs ciment" pour ajouter rapidement des matÃ©riaux !',
            position: 'top',
            action: () => document.getElementById('search-tab')?.click()
          },
          {
            element: '#helpDropdown',
            title: 'â“ Menu Aide',
            content: 'AccÃ©dez aux tours guidÃ©s, aux raccourcis clavier, et aux paramÃ¨tres de relances.',
            position: 'bottom'
          },
          {
            element: null,
            title: 'âŒ¨ï¸ Raccourcis Clavier',
            content: 'Plus de 30 raccourcis disponibles ! Appuyez sur &lt;kbd>F1&lt;/kbd> ou &lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>/&lt;/kbd> pour les voir.&lt;br>&lt;br>Exemples :&lt;br>â€¢ &lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>Q&lt;/kbd> : Nouveau devis&lt;br>â€¢ &lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>D&lt;/kbd> : Dupliquer&lt;br>â€¢ &lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>&amp;Ã©"\'(&lt;/kbd> : Navigation rapide (AZERTY)',
            position: 'center'
          },
          {
            element: null,
            title: 'ðŸŽ¨ Personnalisation',
            content: '28 thÃ¨mes disponibles, 5 designs de PDF, logo personnalisÃ©... Rendez l\'application unique !',
            position: 'center'
          },
          {
            element: null,
            title: 'ðŸ“¥ Import de DonnÃ©es',
            content: 'Importez vos matÃ©riaux, fournisseurs et clients depuis Excel ou CSV. Mapping automatique des colonnes et templates fournis !',
            position: 'center'
          },
          {
            element: null,
            title: 'âœ… Vous Ãªtes prÃªt !',
            content: 'Vous connaissez maintenant toutes les fonctionnalitÃ©s principales d\'AutoCalc OptiDevis.&lt;br>&lt;br>Pour approfondir un aspect spÃ©cifique, lancez un tour thÃ©matique depuis le menu Aide !&lt;br>&lt;br>Bon travail !',
            position: 'center'
          }
        ]
      },
      devis: {
        name: 'CrÃ©er un Devis',
        description: 'Apprenez Ã  crÃ©er votre premier devis',
        steps: [
          {
            element: '#new-quote-tab',
            title: 'Onglet Nouveau Devis',
            content: 'CommenÃ§ons par cliquer sur l\'onglet Nouveau Devis.',
            position: 'bottom',
            action: () => document.getElementById('new-quote-tab')?.click()
          },
          {
            element: '#client-name',
            title: 'Informations Client',
            content: 'Saisissez le nom de votre client ici.',
            position: 'right'
          },
          {
            element: '#search-tab',
            title: 'Recherche de MatÃ©riaux',
            content: 'Cliquez ici pour rechercher et sÃ©lectionner des matÃ©riaux.',
            position: 'bottom',
            action: () => document.getElementById('search-tab')?.click()
          },
          {
            element: '#material-search-input',
            title: 'Barre de Recherche',
            content: 'Tapez le nom d\'un matÃ©riau pour le rechercher.',
            position: 'bottom'
          },
          {
            element: '#surface',
            title: 'ParamÃ¨tres de Calcul',
            content: 'Entrez la surface, l\'Ã©paisseur ou les unitÃ©s selon le type de calcul.',
            position: 'left'
          },
          {
            element: '#add-to-quote-btn',
            title: 'Ajouter au Devis',
            content: 'Cliquez ici pour ajouter l\'article au devis.',
            position: 'top'
          },
          {
            element: '#quote-table',
            title: 'Tableau du Devis',
            content: 'Vos articles apparaissent ici avec les totaux calculÃ©s automatiquement.',
            position: 'top'
          },
          {
            element: '#save-quote-btn',
            title: 'Sauvegarder',
            content: 'N\'oubliez pas de sauvegarder votre devis !',
            position: 'left'
          }
        ]
      },
      shortcuts: {
        name: 'Raccourcis Clavier',
        description: 'DÃ©couvrez les raccourcis pour gagner du temps',
        steps: [
          {
            element: null,
            title: 'Bienvenue dans le Tour des Raccourcis',
            content: 'AutoCalc OptiDevis dispose de plus de 30 raccourcis clavier pour amÃ©liorer votre productivitÃ©. DÃ©couvrons les plus utiles !',
            position: 'center'
          },
          {
            element: '#helpDropdown',
            title: 'Menu Aide',
            content: 'Ã€ tout moment, cliquez ici ou appuyez sur &lt;kbd>F1&lt;/kbd> pour accÃ©der Ã  l\'aide et aux raccourcis.',
            position: 'bottom'
          },
          {
            element: null,
            title: 'ðŸš€ Navigation Ultra-Rapide',
            content: '&lt;strong>Changez d\'onglet sans la souris :&lt;/strong>&lt;br>&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>&amp;&lt;/kbd> â†’ Accueil&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>Ã©&lt;/kbd> â†’ Recherche&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>"&lt;/kbd> â†’ Nouveau Devis&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>\'&lt;/kbd> â†’ Catalogue&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>(&lt;/kbd> â†’ Configuration&lt;br>&lt;br>&lt;small class="text-muted">Sur clavier AZERTY franÃ§ais&lt;/small>&lt;br>Ou utilisez &lt;kbd>Alt&lt;/kbd>+&lt;kbd>1-9&lt;/kbd> pour les onglets 1 Ã  9',
            position: 'center'
          },
          {
            element: null,
            title: 'âš¡ Actions Rapides',
            content: '&lt;strong>Gain de temps quotidien :&lt;/strong>&lt;br>&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>S&lt;/kbd> â†’ Sauvegarder&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>N&lt;/kbd> â†’ CrÃ©er nouveau (contextuel)&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>D&lt;/kbd> â†’ &lt;strong>Dupliquer&lt;/strong> le document actif&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>P&lt;/kbd> â†’ Imprimer/PDF&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>F&lt;/kbd> â†’ Rechercher',
            position: 'center'
          },
          {
            element: null,
            title: 'ðŸ“‹ Devis &amp; Factures',
            content: '&lt;strong>CrÃ©ez et gÃ©rez vos documents :&lt;/strong>&lt;br>&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>Q&lt;/kbd> â†’ Nouveau devis rapide&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>B&lt;/kbd> â†’ Convertir devis en facture&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>M&lt;/kbd> â†’ Marquer facture payÃ©e&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>I&lt;/kbd> â†’ Aller aux factures',
            position: 'center'
          },
          {
            element: null,
            title: 'ðŸ“¦ Catalogue &amp; DonnÃ©es',
            content: '&lt;strong>Gestion rapide du catalogue :&lt;/strong>&lt;br>&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>Shift&lt;/kbd>+&lt;kbd>M&lt;/kbd> â†’ Nouveau matÃ©riau&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>Shift&lt;/kbd>+&lt;kbd>C&lt;/kbd> â†’ Nouveau client&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>Shift&lt;/kbd>+&lt;kbd>S&lt;/kbd> â†’ Nouveau fournisseur&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>Shift&lt;/kbd>+&lt;kbd>I&lt;/kbd> â†’ Importer donnÃ©es',
            position: 'center'
          },
          {
            element: null,
            title: 'ðŸŽ¯ Command Palette - NOUVEAU !',
            content: '&lt;strong>âŒ¨ï¸ Le raccourci le plus puissant :&lt;/strong>&lt;br>&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>K&lt;/kbd> â†’ &lt;strong>Command Palette&lt;/strong>&lt;br>&lt;br>âœ¨ Recherchez et exÃ©cutez n\'importe quelle action&lt;br>ðŸ“ Navigation ultra-rapide vers n\'importe quel onglet&lt;br>ðŸš€ AccÃ¨s direct aux fonctions&lt;br>&lt;br>&lt;em>Essayez-le maintenant, c\'est magique !&lt;/em>',
            position: 'center'
          },
          {
            element: null,
            title: 'â†©ï¸ Undo/Redo - NOUVEAU !',
            content: '&lt;strong>Annulez vos erreurs instantanÃ©ment :&lt;/strong>&lt;br>&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>Z&lt;/kbd> â†’ &lt;strong>Annuler (Undo)&lt;/strong>&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>Y&lt;/kbd> ou &lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>Shift&lt;/kbd>+&lt;kbd>Z&lt;/kbd> â†’ &lt;strong>RÃ©tablir (Redo)&lt;/strong>&lt;br>&lt;br>âœ… Fonctionne sur tout : matÃ©riaux, clients, fournisseurs, devis, factures&lt;br>ðŸ“œ Historique de 50 actions',
            position: 'center'
          },
          {
            element: null,
            title: 'ðŸ” Recherche Intelligente',
            content: '&lt;strong>Trouvez ce dont vous avez besoin :&lt;/strong>&lt;br>&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>F&lt;/kbd> â†’ Recherche dans l\'onglet actif&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>Shift&lt;/kbd>+&lt;kbd>F&lt;/kbd> â†’ Filtres avancÃ©s&lt;br>&lt;kbd>/&lt;/kbd> â†’ Focus barre de recherche',
            position: 'center'
          },
          {
            element: null,
            title: 'ðŸ› ï¸ Utilitaires',
            content: '&lt;strong>Autres raccourcis pratiques :&lt;/strong>&lt;br>&lt;br>&lt;kbd>F2&lt;/kbd> â†’ &lt;strong>Lancer le tour guidÃ©&lt;/strong>&lt;br>&lt;kbd>F5&lt;/kbd> â†’ Actualiser donnÃ©es&lt;br>&lt;kbd>Delete&lt;/kbd> â†’ Supprimer sÃ©lection&lt;br>&lt;kbd>Escape&lt;/kbd> â†’ Fermer modals&lt;br>&lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>H&lt;/kbd> â†’ Historique',
            position: 'center'
          },
          {
            element: null,
            title: 'ðŸ’¡ Liste ComplÃ¨te',
            content: 'Pour voir la liste complÃ¨te des raccourcis avec descriptions dÃ©taillÃ©es, appuyez sur &lt;kbd>F1&lt;/kbd> ou &lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>/&lt;/kbd> Ã  tout moment.&lt;br>&lt;br>Essayez dÃ¨s maintenant !',
            position: 'center'
          }
        ]
      },
      import: {
        name: 'Import de DonnÃ©es',
        description: 'Importez vos donnÃ©es depuis Excel',
        steps: [
          {
            element: '#admin-tab',
            title: 'Import de Catalogue',
            content: 'Allez dans l\'onglet Catalogue pour importer vos matÃ©riaux.',
            position: 'bottom',
            action: () => document.getElementById('admin-tab')?.click()
          },
          {
            element: 'button[onclick*="openImportModal"]',
            title: 'Bouton Import',
            content: 'Cliquez sur "Importer Catalogue" pour ouvrir la fenÃªtre d\'import.',
            position: 'left'
          },
          {
            element: null,
            title: 'Templates Excel',
            content: 'TÃ©lÃ©chargez d\'abord un template Excel pour voir le format attendu.',
            position: 'center'
          },
          {
            element: null,
            title: 'SÃ©lection du Fichier',
            content: 'SÃ©lectionnez votre fichier Excel ou CSV contenant vos donnÃ©es.',
            position: 'center'
          },
          {
            element: null,
            title: 'Mapping Automatique',
            content: 'L\'application dÃ©tecte automatiquement les colonnes de votre fichier.',
            position: 'center'
          },
          {
            element: null,
            title: 'Import',
            content: 'Lancez l\'import et consultez le rapport pour voir les rÃ©sultats.',
            position: 'center'
          }
        ]
      },
      nouveautes: {
        name: 'ðŸš€ NouveautÃ©s v3.5.0',
        description: 'DÃ©couvrez les nouvelles fonctionnalitÃ©s',
        steps: [
          {
            element: null,
            title: 'ðŸŽ‰ Bienvenue dans la v3.5.0 !',
            content: 'Cette version apporte de nombreuses amÃ©liorations pour vous faire gagner du temps et amÃ©liorer votre productivitÃ©. DÃ©couvrons-les ensemble !',
            position: 'center'
          },
          {
            element: null,
            title: 'âŒ¨ï¸ Command Palette - Ctrl+K',
            content: '&lt;strong>Nouvelle fonctionnalitÃ© phare !&lt;/strong>&lt;br>&lt;br>Appuyez sur &lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>K&lt;/kbd> n\'importe oÃ¹ dans l\'application pour ouvrir la palette de commandes.&lt;br>&lt;br>âœ¨ Recherchez et exÃ©cutez n\'importe quelle action en quelques touches !&lt;br>ðŸ“ Navigation rapide vers n\'importe quel onglet&lt;br>ðŸŽ¯ AccÃ¨s direct aux fonctions&lt;br>&lt;br>Essayez maintenant : appuyez sur &lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>K&lt;/kbd> !',
            position: 'center'
          },
          {
            element: null,
            title: 'â†©ï¸ Undo/Redo System',
            content: '&lt;strong>Annulez vos erreurs en un clic !&lt;/strong>&lt;br>&lt;br>â€¢ &lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>Z&lt;/kbd> : Annuler la derniÃ¨re action&lt;br>â€¢ &lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>Y&lt;/kbd> ou &lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>Shift&lt;/kbd>+&lt;kbd>Z&lt;/kbd> : RÃ©tablir&lt;br>&lt;br>âœ… Fonctionne sur : ajout, modification, suppression de matÃ©riaux, clients, fournisseurs, devis, factures&lt;br>âœ… Historique de 50 actions&lt;br>âœ… Indicateur visuel en temps rÃ©el',
            position: 'center'
          },
          {
            element: '#admin-tab',
            title: 'ðŸ“„ Pagination AvancÃ©e',
            content: 'Tous les tableaux disposent maintenant d\'une pagination avancÃ©e !&lt;br>&lt;br>ðŸ“Š Choisissez le nombre d\'Ã©lÃ©ments par page : 10, 25, 50 ou 100&lt;br>ðŸ”¢ Navigation par numÃ©ros de page&lt;br>âš¡ AmÃ©lioration des performances (10x plus rapide sur gros volumes)&lt;br>&lt;br>Allons voir le catalogue pour tester...',
            position: 'bottom',
            action: () => document.getElementById('admin-tab')?.click()
          },
          {
            element: '#materials-items-per-page',
            title: 'ðŸ”¢ SÃ©lecteur d\'items par page',
            content: 'Ici, vous pouvez choisir combien de matÃ©riaux afficher par page.&lt;br>&lt;br>ðŸ’¡ Astuce : Utilisez 10 pour une vue rapide, ou 100 pour voir plus de donnÃ©es en une fois !',
            position: 'top'
          },
          {
            element: '#materials-pagination-controls',
            title: 'ðŸŽ¯ ContrÃ´les de pagination',
            content: 'Naviguez facilement entre les pages avec :&lt;br>&lt;br>â¬…ï¸ Bouton PrÃ©cÃ©dent&lt;br>ðŸ”¢ NumÃ©ros de page cliquables&lt;br>âž¡ï¸ Bouton Suivant&lt;br>&lt;br>L\'indicateur en bas Ã  gauche vous montre : "Affichage 1-25 sur 93 matÃ©riaux"',
            position: 'top'
          },
          {
            element: '#materials-select-all',
            title: 'â˜‘ï¸ Bulk Operations - SÃ©lection Multiple',
            content: '&lt;strong>Nouvelle fonctionnalitÃ© ultra-puissante !&lt;/strong>&lt;br>&lt;br>âœ… Cochez cette case pour sÃ©lectionner TOUS les matÃ©riaux de la page&lt;br>âœ… Ou cochez les cases individuelles sur chaque ligne&lt;br>ðŸ’¡ Maintenez &lt;kbd>Shift&lt;/kbd> et cliquez pour sÃ©lectionner une plage !',
            position: 'bottom'
          },
          {
            element: '#materials-bulk-actions',
            title: 'ðŸŽ›ï¸ Barre d\'Actions GroupÃ©es',
            content: 'Quand vous sÃ©lectionnez des Ã©lÃ©ments, cette barre apparaÃ®t automatiquement :&lt;br>&lt;br>ðŸ“¥ &lt;strong>Exporter&lt;/strong> : TÃ©lÃ©charge un fichier CSV avec les Ã©lÃ©ments sÃ©lectionnÃ©s&lt;br>ðŸ—‘ï¸ &lt;strong>Supprimer&lt;/strong> : Supprime tous les Ã©lÃ©ments d\'un coup&lt;br>âŒ &lt;strong>Annuler&lt;/strong> : DÃ©sÃ©lectionne tout&lt;br>&lt;br>â±ï¸ &lt;strong>Gain de temps : 90% !&lt;/strong> Plus besoin de supprimer/exporter un par un !',
            position: 'top'
          },
          {
            element: '#clients-tab',
            title: 'ðŸ‘¥ Bulk Operations sur Clients',
            content: 'Les opÃ©rations groupÃ©es fonctionnent aussi sur :&lt;br>&lt;br>âœ… Clients&lt;br>âœ… Fournisseurs&lt;br>âœ… Devis&lt;br>âœ… Factures&lt;br>&lt;br>Allons voir les clients...',
            position: 'bottom',
            action: () => document.getElementById('clients-tab')?.click()
          },
          {
            element: '#clients-select-all',
            title: 'â˜‘ï¸ MÃªme systÃ¨me sur tous les modules',
            content: 'Le systÃ¨me de sÃ©lection multiple fonctionne de la mÃªme maniÃ¨re partout :&lt;br>&lt;br>1ï¸âƒ£ SÃ©lectionnez (case Ã  cocher ou Shift+Click)&lt;br>2ï¸âƒ£ Choisissez une action (Exporter/Supprimer)&lt;br>3ï¸âƒ£ Confirmez&lt;br>4ï¸âƒ£ TerminÃ© !&lt;br>&lt;br>Vous pouvez mÃªme annuler avec &lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>Z&lt;/kbd> !',
            position: 'bottom'
          },
          {
            element: null,
            title: 'ðŸŽ¨ AmÃ©liorations UI/UX',
            content: 'Autres amÃ©liorations visuelles :&lt;br>&lt;br>âœ¨ Barre de sÃ©lection compacte et lisible&lt;br>ðŸŒ— Contraste amÃ©liorÃ© pour mode sombre&lt;br>ðŸ“ Bouton "Tour GuidÃ©" dÃ©placÃ© dans le header&lt;br>ðŸŽ¯ Tooltips sur tous les boutons&lt;br>âš¡ Animations fluides',
            position: 'center'
          },
          {
            element: null,
            title: 'ðŸ“‹ RÃ©capitulatif des NouveautÃ©s',
            content: '&lt;strong>Ce que vous pouvez faire maintenant :&lt;/strong>&lt;br>&lt;br>âŒ¨ï¸ &lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>K&lt;/kbd> : Command Palette (navigation ultra-rapide)&lt;br>â†©ï¸ &lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>Z&lt;/kbd> / &lt;kbd>Ctrl&lt;/kbd>+&lt;kbd>Y&lt;/kbd> : Undo/Redo&lt;br>â˜‘ï¸ SÃ©lection multiple + actions groupÃ©es (export/suppression)&lt;br>ðŸ“„ Pagination : 10/25/50/100 items par page&lt;br>ðŸ”„ Performance 10x amÃ©liorÃ©e&lt;br>&lt;br>&lt;strong>Gain de productivitÃ© estimÃ© : +50% !&lt;/strong>',
            position: 'center'
          },
          {
            element: null,
            title: 'âœ… Vous Ãªtes Ã  jour !',
            content: 'Vous connaissez maintenant toutes les nouveautÃ©s de la version 2.6.5 !&lt;br>&lt;br>ðŸ’¡ &lt;strong>Astuce&lt;/strong> : Consultez les raccourcis clavier (&lt;kbd>F1&lt;/kbd>) pour dÃ©couvrir encore plus de fonctions !&lt;br>&lt;br>ðŸš€ Bon travail et profitez des nouvelles fonctionnalitÃ©s !',
            position: 'center'
          }
        ]
      }
    };
  }

  /**
   * CrÃ©e l'overlay sombre
   */
  createOverlay() {
    // VÃ©rifier si un overlay existe dÃ©jÃ 
    const existing = document.getElementById('tour-overlay');
    if (existing) {
      this.overlay = existing;
      return;
    }

    this.overlay = document.createElement('div');
    this.overlay.id = 'tour-overlay';
    this.overlay.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 9998;
      display: none;
      pointer-events: none;
    `;
    document.body.appendChild(this.overlay);
  }

  /**
   * CrÃ©e la bulle de tooltip
   */
  createTooltip() {
    this.tooltip = document.createElement('div');
    this.tooltip.id = 'tour-tooltip';
    this.tooltip.style.cssText = `
      position: fixed;
      background: white;
      border-radius: 8px;
      padding: 20px;
      max-width: 400px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      z-index: 10000;
      display: none;
    `;
    this.tooltip.innerHTML = `
      &lt;div class="tour-header">
        &lt;h5 id="tour-title">&lt;/h5>
        &lt;button class="btn-close" onclick="tourModule.stopTour()">&lt;/button>
      &lt;/div>
      &lt;div id="tour-content">&lt;/div>
      &lt;div class="tour-footer d-flex justify-content-between align-items-center mt-3">
        &lt;span id="tour-progress" class="text-muted">&lt;/span>
        &lt;div>
          &lt;button class="btn btn-sm btn-secondary me-2" onclick="tourModule.prevStep()">PrÃ©cÃ©dent&lt;/button>
          &lt;button class="btn btn-sm btn-primary" onclick="tourModule.nextStep()">Suivant&lt;/button>
        &lt;/div>
      &lt;/div>
    `;
    document.body.appendChild(this.tooltip);
  }

  /**
   * VÃ©rifie si c'est la premiÃ¨re fois
   */
  checkFirstTime() {
    const hasSeenTour = localStorage.getItem('tour_seen');
    if (!hasSeenTour) {
      setTimeout(() => {
        this.showWelcome();
      }, 2000);
    }
  }

  /**
   * Affiche l'Ã©cran de bienvenue
   */
  showWelcome() {
    // Supprimer les anciennes modals de bienvenue d'abord
    document.querySelectorAll('.tour-welcome-modal').forEach(m => m.remove());

    const modal = document.createElement('div');
    modal.className = 'tour-welcome-modal';
    modal.innerHTML = `
      &lt;div class="modal fade show" style="display: block; background: rgba(0,0,0,0.5);">
        &lt;div class="modal-dialog modal-dialog-centered">
          &lt;div class="modal-content">
            &lt;div class="modal-header bg-primary text-white">
              &lt;h5 class="modal-title">ðŸ‘‹ Bienvenue dans AutoCalc OptiDevis !&lt;/h5>
            &lt;/div>
            &lt;div class="modal-body">
              &lt;p>C'est votre premiÃ¨re visite ! Voulez-vous dÃ©couvrir l'application avec un tour guidÃ© ?&lt;/p>
              &lt;p class="text-muted">Cela ne prendra que 2 minutes et vous aidera Ã  maÃ®triser rapidement l'application.&lt;/p>
            &lt;/div>
            &lt;div class="modal-footer">
              &lt;button class="btn btn-secondary" onclick="this.closest('.tour-welcome-modal').remove(); localStorage.setItem('tour_seen', 'skipped');">
                Plus tard
              &lt;/button>
              &lt;button class="btn btn-primary" onclick="this.closest('.tour-welcome-modal').remove(); tourModule.startTour('general');">
                Commencer le tour
              &lt;/button>
            &lt;/div>
          &lt;/div>
        &lt;/div>
      &lt;/div>
    `;
    document.body.appendChild(modal);
  }

  /**
   * Ajoute le bouton d'aide dans l'UI
   * Note: Le bouton est maintenant dans le header (index.html), cette fonction n'est plus utilisÃ©e
   */
  addHelpButton() {
    // DÃ©sactivÃ© - le bouton est maintenant intÃ©grÃ© dans le header Ã  cÃ´tÃ© de "Aide"
    // const helpButton = document.createElement('button');
    // helpButton.className = 'btn btn-sm btn-outline-primary position-fixed';
    // helpButton.style.cssText = 'top: 80px; right: 20px; z-index: 1000;';
    // helpButton.innerHTML = 'â“ Tour GuidÃ©';
    // helpButton.onclick = () => this.showTourMenu();
    // document.body.appendChild(helpButton);
  }

  /**
   * Affiche le menu des tours
   */
  showTourMenu() {
    // Supprimer les anciennes modals d'abord
    document.querySelectorAll('.tour-menu-modal').forEach(m => m.remove());

    const tours = Object.entries(this.tours).map(([key, tour]) => {
      const completed = this.completedTours.includes(key);
      return `
        &lt;div class="list-group-item d-flex justify-content-between align-items-center">
          &lt;div>
            &lt;h6>${tour.name} ${completed ? 'âœ…' : ''}&lt;/h6>
            &lt;small class="text-muted">${tour.description}&lt;/small>
          &lt;/div>
          &lt;button class="btn btn-sm btn-primary" onclick="tourModule.startTour('${key}')">
            ${completed ? 'Refaire' : 'Commencer'}
          &lt;/button>
        &lt;/div>
      `;
    }).join('');

    const modal = document.createElement('div');
    modal.className = 'tour-menu-modal';
    modal.innerHTML = `
      &lt;div class="modal fade show" style="display: block; background: rgba(0,0,0,0.5);">
        &lt;div class="modal-dialog modal-dialog-centered">
          &lt;div class="modal-content">
            &lt;div class="modal-header bg-primary text-white">
              &lt;h5 class="modal-title">ðŸŽ¯ Tours GuidÃ©s&lt;/h5>
              &lt;button class="btn-close btn-close-white" onclick="this.closest('.tour-menu-modal').remove();">&lt;/button>
            &lt;/div>
            &lt;div class="modal-body p-0">
              &lt;div class="list-group list-group-flush">
                ${tours}
              &lt;/div>
            &lt;/div>
          &lt;/div>
        &lt;/div>
      &lt;/div>
    `;
    document.body.appendChild(modal);
  }

  /**
   * DÃ©marre un tour
   */
  startTour(tourName) {
    const tour = this.tours[tourName];
    if (!tour) {
      NotificationSystem.error('Tour non trouvÃ©');
      return;
    }

    // Si un tour est dÃ©jÃ  actif, l'arrÃªter d'abord
    if (this.tourActive) {
      this.stopTour();
    }

    // Fermer les modals de tour existantes
    document.querySelectorAll('.tour-menu-modal, .tour-welcome-modal').forEach(m => m.remove());

    this.currentTour = tour;
    this.currentStep = 0;
    this.tourActive = true;

    // Afficher l'overlay
    this.overlay.style.display = 'block';
    this.tooltip.style.display = 'block';

    // Commencer la premiÃ¨re Ã©tape
    this.showStep();

    NotificationSystem.success(`Tour "${tour.name}" dÃ©marrÃ©`);
  }

  /**
   * Affiche une Ã©tape du tour
   */
  showStep() {
    if (!this.tourActive || !this.currentTour) return;

    const step = this.currentTour.steps[this.currentStep];
    if (!step) {
      this.completeTour();
      return;
    }

    // Mettre Ã  jour le contenu
    // Note: step.title uses textContent (safe), step.content uses innerHTML
    // step.content is currently static HTML (defined in defineTours())
    // If tours become dynamic/user-editable, use DOMPurify.sanitize() here
    document.getElementById('tour-title').textContent = step.title;
    document.getElementById('tour-content').innerHTML = step.content;
    document.getElementById('tour-progress').textContent =
      `Ã‰tape ${this.currentStep + 1}/${this.currentTour.steps.length}`;

    // Mise Ã  jour des boutons
    const prevBtn = this.tooltip.querySelector('.btn-secondary');
    const nextBtn = this.tooltip.querySelector('.btn-primary');

    prevBtn.style.display = this.currentStep > 0 ? 'inline-block' : 'none';
    nextBtn.textContent = this.currentStep === this.currentTour.steps.length - 1 ? 'Terminer' : 'Suivant';

    // Positionner la bulle
    this.positionTooltip(step);

    // ExÃ©cuter l'action si prÃ©sente
    if (step.action) {
      step.action();
    }

    // Highlight l'Ã©lÃ©ment
    this.highlightElement(step.element);
  }

  /**
   * Positionne la bulle prÃ¨s de l'Ã©lÃ©ment
   */
  positionTooltip(step) {
    if (step.position === 'center' || !step.element) {
      // Centrer la bulle
      this.tooltip.style.top = '50%';
      this.tooltip.style.left = '50%';
      this.tooltip.style.transform = 'translate(-50%, -50%)';
      return;
    }

    const element = document.querySelector(step.element);
    if (!element) {
      this.positionTooltip({ position: 'center' });
      return;
    }

    const rect = element.getBoundingClientRect();
    const tooltipRect = this.tooltip.getBoundingClientRect();

    let top = 0, left = 0;

    switch (step.position) {
      case 'top':
        top = rect.top - tooltipRect.height - 10;
        left = rect.left + (rect.width - tooltipRect.width) / 2;
        break;
      case 'bottom':
        top = rect.bottom + 10;
        left = rect.left + (rect.width - tooltipRect.width) / 2;
        break;
      case 'left':
        top = rect.top + (rect.height - tooltipRect.height) / 2;
        left = rect.left - tooltipRect.width - 10;
        break;
      case 'right':
        top = rect.top + (rect.height - tooltipRect.height) / 2;
        left = rect.right + 10;
        break;
    }

    // S'assurer que la bulle reste visible
    top = Math.max(10, Math.min(top, window.innerHeight - tooltipRect.height - 10));
    left = Math.max(10, Math.min(left, window.innerWidth - tooltipRect.width - 10));

    this.tooltip.style.top = top + 'px';
    this.tooltip.style.left = left + 'px';
    this.tooltip.style.transform = 'none';
  }

  /**
   * Met en surbrillance l'Ã©lÃ©ment actuel
   */
  highlightElement(selector) {
    // Retirer les anciens highlights
    document.querySelectorAll('.tour-highlight').forEach(el => {
      el.classList.remove('tour-highlight');
      el.style.position = '';
      el.style.zIndex = '';
    });

    if (!selector) return;

    const element = document.querySelector(selector);
    if (element) {
      element.classList.add('tour-highlight');
      element.style.position = 'relative';
      element.style.zIndex = '9999';

      // Scroll vers l'Ã©lÃ©ment si nÃ©cessaire
      element.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }

  /**
   * Ã‰tape suivante
   */
  nextStep() {
    if (this.currentStep &lt; this.currentTour.steps.length - 1) {
      this.currentStep++;
      this.showStep();
    } else {
      this.completeTour();
    }
  }

  /**
   * Ã‰tape prÃ©cÃ©dente
   */
  prevStep() {
    if (this.currentStep > 0) {
      this.currentStep--;
      this.showStep();
    }
  }

  /**
   * ArrÃªte le tour
   */
  stopTour() {
    this.tourActive = false;
    this.currentTour = null;
    this.currentStep = 0;

    // Cacher les Ã©lÃ©ments
    this.overlay.style.display = 'none';
    this.tooltip.style.display = 'none';

    // Retirer les highlights
    document.querySelectorAll('.tour-highlight').forEach(el => {
      el.classList.remove('tour-highlight');
      el.style.position = '';
      el.style.zIndex = '';
    });

    NotificationSystem.info('Tour arrÃªtÃ©');
  }

  /**
   * Termine le tour avec succÃ¨s
   */
  completeTour() {
    // Marquer comme complÃ©tÃ©
    const tourKey = Object.keys(this.tours).find(key =>
      this.tours[key] === this.currentTour
    );

    if (tourKey &amp;&amp; !this.completedTours.includes(tourKey)) {
      this.completedTours.push(tourKey);
      this.saveCompletedTours();
    }

    // Sauvegarder que l'utilisateur a vu un tour
    localStorage.setItem('tour_seen', 'completed');

    // Afficher le message de fin
    NotificationSystem.success('ðŸŽ‰ Tour complÃ©tÃ© ! Vous Ãªtes prÃªt Ã  utiliser l\'application.');

    // ArrÃªter le tour
    this.stopTour();
  }

  /**
   * Charge les tours complÃ©tÃ©s
   */
  loadCompletedTours() {
    const saved = localStorage.getItem('completed_tours');
    return saved ? JSON.parse(saved) : [];
  }

  /**
   * Sauvegarde les tours complÃ©tÃ©s
   */
  saveCompletedTours() {
    localStorage.setItem('completed_tours', JSON.stringify(this.completedTours));
  }

  /**
   * Nettoie le module
   */
  destroy() {
    this.stopTour();
    this.overlay?.remove();
    this.tooltip?.remove();
    super.destroy();
  }
}

// Ajouter les styles CSS
const style = document.createElement('style');
style.textContent = `
  .tour-highlight {
    box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7) !important;
    border-radius: 4px !important;
  }

  #tour-tooltip {
    animation: tourPulse 1s ease-in-out;
  }

  @keyframes tourPulse {
    0% { transform: scale(0.95); opacity: 0; }
    50% { transform: scale(1.02); }
    100% { transform: scale(1); opacity: 1; }
  }

  #tour-tooltip .tour-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
  }

  #tour-tooltip h5 {
    margin: 0;
    color: #333;
  }

  #tour-content {
    color: #666;
    line-height: 1.6;
  }

  #tour-content kbd {
    background: #e0e0e0;
    border: 1px solid #999;
    border-radius: 4px;
    padding: 3px 8px;
    font-size: 13px;
    font-family: 'Courier New', monospace;
    font-weight: 600;
    color: #333;
    box-shadow: 0 2px 2px rgba(0,0,0,0.1);
    display: inline-block;
    min-width: 20px;
    text-align: center;
  }
`;
document.head.appendChild(style);

export default TourModule;</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
