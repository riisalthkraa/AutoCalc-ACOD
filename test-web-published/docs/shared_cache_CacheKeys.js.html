

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> shared/cache/CacheKeys.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Modules</h3><ul><li><a href="module-AboutModule.html">AboutModule</a></li><li><a href="module-AuthModule.html">AuthModule</a></li><li><a href="module-BackupModule.html">BackupModule</a></li><li><a href="module-ClientsModule.html">ClientsModule</a></li><li><a href="module-ConfigModule.html">ConfigModule</a></li><li><a href="module-DashboardModule.html">DashboardModule</a></li><li><a href="module-DataCache.html">DataCache</a></li><li><a href="module-ExportModule.html">ExportModule</a></li><li><a href="module-FECModule.html">FECModule</a></li><li><a href="module-FollowUpModule.html">FollowUpModule</a></li><li><a href="module-ImportModule.html">ImportModule</a></li><li><a href="module-InvoicesModule.html">InvoicesModule</a></li><li><a href="module-KeyboardShortcutsModule.html">KeyboardShortcutsModule</a></li><li><a href="module-Logger.html">Logger</a></li><li><a href="module-MLService.html">MLService</a></li><li><a href="module-MaterialsModule.html">MaterialsModule</a></li><li><a href="module-NotificationSystem.html">NotificationSystem</a></li><li><a href="module-NotificationSystemV2.html">NotificationSystemV2</a></li><li><a href="module-PDFModule.html">PDFModule</a></li><li><a href="module-QuickAddModule.html">QuickAddModule</a></li><li><a href="module-QuoteBuilderModule.html">QuoteBuilderModule</a></li><li><a href="module-QuotesModule.html">QuotesModule</a></li><li><a href="module-RevenueModule.html">RevenueModule</a></li><li><a href="module-ScannerModule.html">ScannerModule</a></li><li><a href="module-SuppliersModule.html">SuppliersModule</a></li><li><a href="module-TemplatesModule.html">TemplatesModule</a></li><li><a href="module-TourModule.html">TourModule</a></li><li><a href="module-UtilitiesModule.html">UtilitiesModule</a></li><li><a href="module-calculations.html">calculations</a></li><li><a href="module-constants.html">constants</a></li><li><a href="module-formatters.html">formatters</a></li><li><a href="module-helpers.html">helpers</a></li></ul><h3>Classes</h3><ul><li><a href="BaseModule.html">BaseModule</a></li><li><a href="BulkActionsManager.html">BulkActionsManager</a></li><li><a href="CacheKeys.html">CacheKeys</a></li><li><a href="EventBus.html">EventBus</a></li><li><a href="LoadingStateManager.html">LoadingStateManager</a></li><li><a href="ModalHelper.html">ModalHelper</a></li><li><a href="PaginationManager.html">PaginationManager</a></li><li><a href="ServerValidator.html">ServerValidator</a></li><li><a href="StateManager.html">StateManager</a></li><li><a href="TabRefreshManager.html">TabRefreshManager</a></li><li><a href="UndoRedoManager.html">UndoRedoManager</a></li><li><a href="module-AboutModule-AboutModule.html">AboutModule</a></li><li><a href="module-AuthModule-AuthModule.html">AuthModule</a></li><li><a href="module-BackupModule-BackupModule.html">BackupModule</a></li><li><a href="module-ClientsModule-ClientsModule.html">ClientsModule</a></li><li><a href="module-ConfigModule-ConfigModule.html">ConfigModule</a></li><li><a href="module-DashboardModule-DashboardModule.html">DashboardModule</a></li><li><a href="module-ExportModule-ExportModule.html">ExportModule</a></li><li><a href="module-FECModule-FECModule.html">FECModule</a></li><li><a href="module-ImportModule-ImportModule.html">ImportModule</a></li><li><a href="module-InvoicesModule-InvoicesModule.html">InvoicesModule</a></li><li><a href="module-Logger-Logger.html">Logger</a></li><li><a href="module-Logger-ModuleLogger.html">ModuleLogger</a></li><li><a href="module-MaterialsModule-MaterialsModule.html">MaterialsModule</a></li><li><a href="module-PDFModule-PDFModule.html">PDFModule</a></li><li><a href="module-QuickAddModule-QuickAddModule.html">QuickAddModule</a></li><li><a href="module-QuoteBuilderModule-QuoteBuilderModule.html">QuoteBuilderModule</a></li><li><a href="module-QuotesModule-QuotesModule.html">QuotesModule</a></li><li><a href="module-RevenueModule-RevenueModule.html">RevenueModule</a></li><li><a href="module-ScannerModule-ScannerModule.html">ScannerModule</a></li><li><a href="module-SuppliersModule-SuppliersModule.html">SuppliersModule</a></li><li><a href="module-TemplatesModule-TemplatesModule.html">TemplatesModule</a></li><li><a href="module-UtilitiesModule-UtilitiesModule.html">UtilitiesModule</a></li></ul><h3>Global</h3><ul><li><a href="global.html#clear">clear</a></li><li><a href="global.html#crypto">crypto</a></li><li><a href="global.html#emit">emit</a></li><li><a href="global.html#emitSync">emitSync</a></li><li><a href="global.html#off">off</a></li><li><a href="global.html#on">on</a></li><li><a href="global.html#once">once</a></li><li><a href="global.html#validateBeforeAddToQuote">validateBeforeAddToQuote</a></li><li><a href="global.html#validateBeforeExport">validateBeforeExport</a></li><li><a href="global.html#validateBeforeSaveMaterial">validateBeforeSaveMaterial</a></li><li><a href="global.html#validateBeforeSendEmail">validateBeforeSendEmail</a></li><li><a href="global.html#validateHeaderConfig">validateHeaderConfig</a></li><li><a href="global.html#validatePasswordChange">validatePasswordChange</a></li><li><a href="global.html#validateSMTPConfig">validateSMTPConfig</a></li><li><a href="global.html#waitFor">waitFor</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>shared/cache/CacheKeys.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * ========================================
 * CACHE KEYS - Clés centralisées pour DataCache
 * ========================================
 *
 * Classe utilitaire pour gérer les clés de cache de manière centralisée.
 * Fournit des constantes typées et des méthodes d'invalidation intelligente.
 *
 * Architecture :
 * - **Constantes statiques** : Clés de cache typées et autocomplétées
 * - **Invalidation intelligente** : Invalidation automatique des caches liés
 * - **Relations entre entités** : Gestion des dépendances de cache
 * - **Type safety** : Évite les erreurs de typo dans les clés
 *
 * ==========================================
 * PROBLÈME RÉSOLU
 * ==========================================
 *
 * **Avant CacheKeys** :
 * - Clés en dur dispersées dans tous les modules ("materials", "suppliers", etc.)
 * - Risque de typo (DataCache.invalidate('matreials'))
 * - Invalidation manuelle et incohérente
 * - Pas de gestion des dépendances
 *
 * **Après CacheKeys** :
 * - Clés centralisées et typées
 * - Autocomplete dans l'IDE
 * - Invalidation intelligente des caches liés
 * - Relations explicites entre entités
 *
 * ==========================================
 * RELATIONS ENTRE CACHES
 * ==========================================
 *
 * **Exemple de dépendances** :
 * - Modification de materials → invalide quotes, invoices (car ils contiennent des prix)
 * - Modification de suppliers → invalide materials (car liés par supplierId)
 * - Modification de quotes → invalide invoices (car factures dérivent des devis)
 *
 * Ces relations permettent l'invalidation automatique en cascade.
 *
 * ==========================================
 * UTILISATION
 * ==========================================
 *
 * @example
 * // AVANT (risque de typo)
 * DataCache.invalidate('materials');
 * DataCache.invalidate('quotes'); // Oubli d'invalider invoices !
 *
 * @example
 * // APRÈS (sûr et intelligent)
 * import CacheKeys from './CacheKeys.js';
 * CacheKeys.invalidate(CacheKeys.MATERIALS);
 * // → Invalide automatiquement materials, quotes ET invoices
 *
 * @example
 * // Invalider toutes les caches
 * CacheKeys.invalidateAll();
 *
 * @example
 * // Vérifier si une clé existe
 * if (CacheKeys.isValidKey('materials')) {
 *   console.log('Clé valide');
 * }
 *
 * @class CacheKeys
 * @version 1.0.0
 * @author AutoCalc OptiDevis
 */

import DataCache from '../ui/DataCache.js';

class CacheKeys {
  // ==========================================
  // CONSTANTES DE CLÉS DE CACHE
  // ==========================================

  /**
   * Clé cache pour la liste des matériaux.
   * TTL par défaut : 5 minutes
   * @constant {string}
   */
  static MATERIALS = 'materials';

  /**
   * Clé cache pour la liste des fournisseurs.
   * TTL par défaut : 5 minutes
   * @constant {string}
   */
  static SUPPLIERS = 'suppliers';

  /**
   * Clé cache pour la liste des devis.
   * TTL par défaut : 5 minutes
   * @constant {string}
   */
  static QUOTES = 'quotes';

  /**
   * Clé cache pour la liste des factures.
   * TTL par défaut : 5 minutes
   * @constant {string}
   */
  static INVOICES = 'invoices';

  /**
   * Clé cache pour la liste des templates de devis.
   * TTL par défaut : 5 minutes
   * @constant {string}
   */
  static TEMPLATES = 'templates';

  /**
   * Clé cache pour les données de configuration.
   * TTL par défaut : 5 minutes
   * @constant {string}
   */
  static CONFIG = 'config';

  /**
   * Clé cache pour les statistiques du dashboard.
   * TTL par défaut : 5 minutes
   * @constant {string}
   */
  static DASHBOARD_STATS = 'dashboard_stats';

  /**
   * Clé cache pour les données de revenus.
   * TTL par défaut : 5 minutes
   * @constant {string}
   */
  static REVENUE_DATA = 'revenue_data';

  // ==========================================
  // RELATIONS ENTRE ENTITÉS
  // ==========================================

  /**
   * Définit les relations de dépendance entre les caches.
   * Lorsqu'une clé est invalidée, toutes ses dépendances sont aussi invalidées.
   *
   * Structure :
   * - clé : Entité principale
   * - valeur : Array de clés dépendantes
   *
   * @constant {Object.&lt;string, string[]>}
   * @private
   */
  static RELATIONS = {
    // Matériaux : modifie les devis, factures et dashboard
    [this.MATERIALS]: [this.QUOTES, this.INVOICES, this.DASHBOARD_STATS, this.REVENUE_DATA],

    // Fournisseurs : modifie les matériaux (relation supplier_id)
    [this.SUPPLIERS]: [this.MATERIALS],

    // Devis : modifie les factures (car factures dérivent des devis)
    [this.QUOTES]: [this.INVOICES, this.DASHBOARD_STATS, this.REVENUE_DATA],

    // Factures : modifie le dashboard et revenus
    [this.INVOICES]: [this.DASHBOARD_STATS, this.REVENUE_DATA],

    // Templates : aucune dépendance
    [this.TEMPLATES]: [],

    // Config : peut affecter tous les modules
    [this.CONFIG]: [this.DASHBOARD_STATS],

    // Dashboard : aucune dépendance
    [this.DASHBOARD_STATS]: [],

    // Revenue : aucune dépendance
    [this.REVENUE_DATA]: []
  };

  // ==========================================
  // MÉTHODES D'INVALIDATION
  // ==========================================

  /**
   * Invalide une clé de cache ET ses dépendances.
   * Utilise les relations définies dans RELATIONS pour invalidation en cascade.
   *
   * Workflow :
   * 1. Invalide la clé principale
   * 2. Récupère les dépendances depuis RELATIONS
   * 3. Invalide chaque dépendance récursivement
   *
   * @static
   * @param {string} key - Clé de cache à invalider (utiliser les constantes CacheKeys.*)
   * @returns {void}
   *
   * @example
   * // Invalide materials + quotes + invoices + dashboard_stats + revenue_data
   * CacheKeys.invalidate(CacheKeys.MATERIALS);
   *
   * @example
   * // Invalide uniquement templates (aucune dépendance)
   * CacheKeys.invalidate(CacheKeys.TEMPLATES);
   */
  static invalidate(key) {
    if (!key) {
      console.warn('[CacheKeys] Tentative d\'invalidation avec clé vide');
      return;
    }

    // Invalider la clé principale
    DataCache.invalidate(key);
    console.log(`[CacheKeys] Cache invalidé: ${key}`);

    // Invalider les dépendances
    const dependencies = this.RELATIONS[key] || [];
    if (dependencies.length > 0) {
      console.log(`[CacheKeys] Invalidation des dépendances de ${key}:`, dependencies);
      dependencies.forEach(dep => {
        DataCache.invalidate(dep);
      });
    }
  }

  /**
   * Invalide uniquement la clé spécifiée, SANS ses dépendances.
   * Utile pour invalidations ciblées.
   *
   * @static
   * @param {string} key - Clé de cache à invalider
   * @returns {void}
   *
   * @example
   * // Invalide uniquement dashboard_stats, sans toucher aux autres caches
   * CacheKeys.invalidateOnly(CacheKeys.DASHBOARD_STATS);
   */
  static invalidateOnly(key) {
    if (!key) {
      console.warn('[CacheKeys] Tentative d\'invalidation avec clé vide');
      return;
    }

    DataCache.invalidate(key);
    console.log(`[CacheKeys] Cache invalidé (sans dépendances): ${key}`);
  }

  /**
   * Invalide toutes les clés de cache définies.
   * Équivalent à un "clear all caches".
   *
   * @static
   * @returns {void}
   *
   * @example
   * // Lors d'une déconnexion ou reset de l'application
   * CacheKeys.invalidateAll();
   */
  static invalidateAll() {
    const allKeys = [
      this.MATERIALS,
      this.SUPPLIERS,
      this.QUOTES,
      this.INVOICES,
      this.TEMPLATES,
      this.CONFIG,
      this.DASHBOARD_STATS,
      this.REVENUE_DATA
    ];

    allKeys.forEach(key => {
      DataCache.invalidate(key);
    });

    console.log('[CacheKeys] Tous les caches ont été invalidés');
  }

  /**
   * Invalide plusieurs clés de cache en une seule opération.
   * Plus efficace que de multiples appels à invalidate().
   *
   * @static
   * @param {string[]} keys - Array de clés à invalider
   * @returns {void}
   *
   * @example
   * // Invalider plusieurs caches après import de données
   * CacheKeys.invalidateMultiple([
   *   CacheKeys.MATERIALS,
   *   CacheKeys.SUPPLIERS,
   *   CacheKeys.QUOTES
   * ]);
   */
  static invalidateMultiple(keys) {
    if (!Array.isArray(keys) || keys.length === 0) {
      console.warn('[CacheKeys] invalidateMultiple appelé avec array vide ou invalide');
      return;
    }

    const uniqueKeys = new Set();

    // Collecter toutes les clés à invalider (avec dépendances)
    keys.forEach(key => {
      uniqueKeys.add(key);
      const dependencies = this.RELATIONS[key] || [];
      dependencies.forEach(dep => uniqueKeys.add(dep));
    });

    // Invalider toutes les clés collectées
    uniqueKeys.forEach(key => {
      DataCache.invalidate(key);
    });

    console.log(`[CacheKeys] ${uniqueKeys.size} caches invalidés:`, Array.from(uniqueKeys));
  }

  // ==========================================
  // MÉTHODES UTILITAIRES
  // ==========================================

  /**
   * Vérifie si une clé est une clé de cache valide.
   *
   * @static
   * @param {string} key - Clé à vérifier
   * @returns {boolean} true si la clé est valide, false sinon
   *
   * @example
   * CacheKeys.isValidKey('materials'); // true
   * CacheKeys.isValidKey('invalid_key'); // false
   */
  static isValidKey(key) {
    const validKeys = [
      this.MATERIALS,
      this.SUPPLIERS,
      this.QUOTES,
      this.INVOICES,
      this.TEMPLATES,
      this.CONFIG,
      this.DASHBOARD_STATS,
      this.REVENUE_DATA
    ];

    return validKeys.includes(key);
  }

  /**
   * Retourne toutes les clés de cache définies.
   *
   * @static
   * @returns {string[]} Array de toutes les clés
   *
   * @example
   * const allKeys = CacheKeys.getAllKeys();
   * console.log('Clés de cache disponibles:', allKeys);
   */
  static getAllKeys() {
    return [
      this.MATERIALS,
      this.SUPPLIERS,
      this.QUOTES,
      this.INVOICES,
      this.TEMPLATES,
      this.CONFIG,
      this.DASHBOARD_STATS,
      this.REVENUE_DATA
    ];
  }

  /**
   * Retourne les dépendances d'une clé de cache.
   *
   * @static
   * @param {string} key - Clé de cache
   * @returns {string[]} Array des clés dépendantes
   *
   * @example
   * const deps = CacheKeys.getDependencies(CacheKeys.MATERIALS);
   * // → ['quotes', 'invoices', 'dashboard_stats', 'revenue_data']
   */
  static getDependencies(key) {
    return this.RELATIONS[key] || [];
  }

  /**
   * Affiche un rapport de l'état actuel du cache.
   * Utile pour debugging.
   *
   * @static
   * @returns {void}
   *
   * @example
   * CacheKeys.printCacheReport();
   * // Console output:
   * // [CacheKeys] État du cache:
   * // - materials: ✓ (cached)
   * // - suppliers: ✗ (not cached)
   * // ...
   */
  static printCacheReport() {
    console.log('[CacheKeys] État du cache:');

    this.getAllKeys().forEach(key => {
      const cached = DataCache.get(key);
      const status = cached ? '✓ (cached)' : '✗ (not cached)';
      console.log(`  - ${key}: ${status}`);
    });
  }
}

// Export pour utilisation dans les modules
export default CacheKeys;
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
